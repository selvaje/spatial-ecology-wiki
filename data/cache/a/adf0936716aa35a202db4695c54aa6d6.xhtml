
<h1 class="sectionedit1" id="species_distribution_modeling_with_swedish_wetland_vegetation">Species Distribution Modeling with Swedish Wetland Vegetation</h1>
<div class="level1">

<p>
Helen Moor, Stockholm Resilience Centre, Stockholm University <a href="http://www.stockholmresilience.org/contact/staff/moor.5.416c425f13e06f977b15b7c.html" class="urlextern" target="blanc" title="http://www.stockholmresilience.org/contact/staff/moor.5.416c425f13e06f977b15b7c.html" rel="nofollow noopener">contact</a>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Species Distribution Modeling with Swedish Wetland Vegetation&quot;,&quot;hid&quot;:&quot;species_distribution_modeling_with_swedish_wetland_vegetation&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-236&quot;} -->
<h2 class="sectionedit2" id="introduction">INTRODUCTION</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;INTRODUCTION&quot;,&quot;hid&quot;:&quot;introduction&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;237-262&quot;} -->
<h3 class="sectionedit3" id="general_framework_of_the_analysis">General framework of the analysis</h3>
<div class="level3">

<p>
Using species distribution modeling (MaxEnt, as appropriate for occurrence only data, <a href="http://onlinelibrary.wiley.com/doi/10.1111/j.2041-210X.2010.00036.x/full" class="urlextern" target="blanc" title="http://onlinelibrary.wiley.com/doi/10.1111/j.2041-210X.2010.00036.x/full" rel="nofollow noopener">Elith et al. 2010</a>), we aim to predict the future distribution of the 100 functionally most important wetland species across Sweden. This projection will afterwards be used to assess potential future changes in regional species pool composition (focus on Norrstörm Drainage Basin, central Sweden), and concurrent effects on trait distributions for proposed effect traits. Ultimately, we will qualitatively discuss climate change impact on regional ecosystem service potential via species composition and trait distribution change (see e.g. <a href="http://onlinelibrary.wiley.com/doi/10.1111/j.1365-2745.2010.01753.x/full" class="urlextern" target="blanc" title="http://onlinelibrary.wiley.com/doi/10.1111/j.1365-2745.2010.01753.x/full" rel="nofollow noopener">Lavorel et al. 2011</a>).
</p>

<p>
keywords: SDM, MaxEnt, functional traits, wetlands, vegetation, ecosystem services
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;General framework of the analysis&quot;,&quot;hid&quot;:&quot;general_framework_of_the_analysis&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:3,&quot;range&quot;:&quot;263-1195&quot;} -->
<h3 class="sectionedit4" id="project_objectives">Project objectives</h3>
<div class="level3">

<p>
Here the key objective is to process spatial data (vector and raster) from several sources to create a GRASS database. From that, ultimately create an input raster stack (with common projection, extent, resolution) to be used for species distribution modeling (using MaxEnt). Also, to practice the use and integration of bash, gdal/ogr, grass, and R.
</p>

<p>
If time, also 1) create pH raster from point data, predicting from soil/bedrock data (using GWR or Random Forests); 2) run MaxEnt on occurrence point data.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Project objectives&quot;,&quot;hid&quot;:&quot;project_objectives&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:4,&quot;range&quot;:&quot;1196-1734&quot;} -->
<h2 class="sectionedit5" id="metadata">METADATA</h2>
<div class="level2">

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;METADATA&quot;,&quot;hid&quot;:&quot;metadata&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:5,&quot;range&quot;:&quot;1735-1756&quot;} -->
<h3 class="sectionedit6" id="vector_data">Vector data</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> Sweden outline (e.g. available from <a href="http://www.gadm.org" class="urlextern" target="blanc" title="http://www.gadm.org" rel="nofollow noopener">GADM</a>)</div>
</li>
<li class="level1"><div class="li"> Norrström Drainage Basin (NDB) outline</div>
</li>
<li class="level1"><div class="li">  Soil and Bedrock; CRS: Sweref99 TM (EPSG:3006); format: shp; available from <a href="http://www.sgu.se/sgu/sv/produkter-tjanster/databaser/" class="urlextern" target="blanc" title="http://www.sgu.se/sgu/sv/produkter-tjanster/databaser/" rel="nofollow noopener">Geological Survey of Sweden</a></div>
</li>
<li class="level1"><div class="li"> pH point data; CRS: RT90 and Sweref99 TM; format: .csv; inbuilt coordinate error 1000m; potentially available upon request; original source: <a href="http://www.slu.se/en/collaborative-centres-and-projects/swedish-national-forest-inventory/" class="urlextern" target="blanc" title="http://www.slu.se/en/collaborative-centres-and-projects/swedish-national-forest-inventory/" rel="nofollow noopener">Swedish National Forest Inventory</a></div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Vector data&quot;,&quot;hid&quot;:&quot;vector_data&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:6,&quot;range&quot;:&quot;1757-2336&quot;} -->
<h3 class="sectionedit7" id="raster_data">Raster data</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> Worldclim current: Tmin, Tmax, Prec, Bioclimatic Variables; Resolution: 30 arc sec; CRS: WGS84 (EPSG:4326); format .bil; available: <a href="http://www.worldclim.org/current" class="urlextern" target="blanc" title="http://www.worldclim.org/current" rel="nofollow noopener"> Climate current</a></div>
</li>
<li class="level1"><div class="li"> Worldclim future (HadFGEM2-AO, 2070, rcp60): Tmin, Tmax, Prec, Bioclimatic Variables; Resolution: 30 arc sec; CRS: WGS84 (EPSG:4326); format .bil; available: <a href="http://www.worldclim.org/cmip5_30s" class="urlextern" target="blanc" title="http://www.worldclim.org/cmip5_30s" rel="nofollow noopener"> Climate 2070</a></div>
</li>
<li class="level1"><div class="li"> Heightmap (DEM) Sweden; Resolution: 50m, CRS: Sweref99 TM (EPSG:3006); format: .tif; downloaded via SU licence; original source: <a href="http://www.lantmateriet.se/Kartor-och-geografisk-information/Hojddata/GSD-Hojddata-grid-50-/" class="urlextern" target="blanc" title="http://www.lantmateriet.se/Kartor-och-geografisk-information/Hojddata/GSD-Hojddata-grid-50-/" rel="nofollow noopener">Lantmäteriet Heightmap</a></div>
</li>
<li class="level1"><div class="li"> CORINE Landcover; Resolution: 100 m; CRS: EPSG:3035; format: .tif; available from  <a href="http://www.eea.europa.eu/data-and-maps/data/corine-land-cover-2006-raster-2" class="urlextern" target="blanc" title="http://www.eea.europa.eu/data-and-maps/data/corine-land-cover-2006-raster-2" rel="nofollow noopener">EEA</a></div>
</li>
<li class="level1"><div class="li"></div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Raster data&quot;,&quot;hid&quot;:&quot;raster_data&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:7,&quot;range&quot;:&quot;2337-3192&quot;} -->
<h3 class="sectionedit8" id="other_data_sources">Other data sources</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> Species point occurrence data, from Swedish National Wetland inventory (Våtmarksinventeringen); from local sqlite-database, but data now available at <a href="http://www.gbif.se/ipt/resource.do?r=nv-vmi" class="urlextern" target="blanc" title="http://www.gbif.se/ipt/resource.do?r=nv-vmi" rel="nofollow noopener"> GBIF</a></div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Other data sources&quot;,&quot;hid&quot;:&quot;other_data_sources&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:8,&quot;range&quot;:&quot;3193-3430&quot;} -->
<h2 class="sectionedit9" id="method">METHOD</h2>
<div class="level2">

<p>
Bash script including GRASS commands. The script:
</p>
<ul>
<li class="level1"><div class="li"> downloads data from publicly available sources (where applicable)</div>
</li>
<li class="level1"><div class="li"> edits the downloaded data</div>
</li>
<li class="level1"><div class="li"> imports the data into GRASS</div>
</li>
<li class="level1"><div class="li"> further processes data in GRASS (e.g. calculates slope, aspect, twi from DEM)</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;METHOD&quot;,&quot;hid&quot;:&quot;method&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:9,&quot;range&quot;:&quot;3431-3715&quot;} -->
<h2 class="sectionedit10" id="computational_implementation">Computational implementation</h2>
<div class="level2">

<p>
A Grass GISdatabase is first created manually in QGis. Once the database is established, the script downloads and edits data to import into the location europeWGS84, then creates a new location swedenSWEREF and proceeds to import data into this location.
<br/>

Note: wget is not standard for MacOSX; see <a href="http://coolestguidesontheplanet.com/install-and-configure-wget-on-os-x/" class="urlextern" target="blanc" title="http://coolestguidesontheplanet.com/install-and-configure-wget-on-os-x/" rel="nofollow noopener">here</a> for how to install it. Else: use curl.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Computational implementation&quot;,&quot;hid&quot;:&quot;computational_implementation&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:10,&quot;range&quot;:&quot;3716-4178&quot;} -->
<h3 class="sectionedit11" id="worldclim_data_-_grass_database_-_location_europe">Worldclim data - Grass database - Location Europe</h3>
<div class="level3">
<dl class="code">
<dt><a href="/dokuwiki/doku.php?do=export_code&amp;id=wikistudholland:utwente_helen&amp;codeblock=0" title="Download Snippet" class="mediafile mf_sh">- buildgrassdb.sh</a></dt>
<dd><pre class="code bash"><span class="co0">#!/usr/bin/bash</span>
<span class="co0">######################################################################################### </span>
<span class="co0"># Author Helen Moor</span>
<span class="co0"># Purpose: download and reformat worldclim climate data and other spatial data, </span>
<span class="co0"># to compile a GRASS GIS database for Europe (Worldclim) and Sweden (all data)</span>
<span class="co0"># adapted to MacOSX 9, MacBook</span>
<span class="co0">#########################################################################################</span>
&nbsp;
&nbsp;
<span class="co0">#### 1. Create GRASS database</span>
<span class="co0">## prepare GRASS:</span>
<span class="co0"># MacOS 9: to be able to open grass in commandline, first:</span>
<span class="co0"># - add to .bash-profile: </span>
<span class="co0">#	export PATH=&quot;/usr/X11R6/bin:$PATH&quot;</span>
<span class="co0">#	alias grass=&quot;open -a GRASS-6.4.app&quot;</span>
<span class="co0"># - open GRASS in existing GISDATABASE, and type the following to set -text to default: </span>
<span class="co0">#	g.gui -un gui=text</span>
&nbsp;
&nbsp;
<span class="co0">##################################################################################</span>
&nbsp;
<span class="co0">#### 2. Get data and import data into Grassdb:</span>
&nbsp;
<span class="co0">######### Location EUROPE (for Worldclim data only)</span>
<span class="co0"># enter grass in GISDATABASE: GRASSDB, Location: europeWGS84, MAPSET:PERMANENT</span>
grass ~<span class="sy0">/</span>Documents<span class="sy0">/</span>GISdata<span class="sy0">/</span>GRASSDB<span class="sy0">/</span>europeWGS84<span class="sy0">/</span>PERMANENT
<span class="co0"># check:</span>
g.gisenv
g.region <span class="re5">-p</span> <span class="co0"># extent is europe (set up in qgis)</span>
<span class="co0"># change resolution to 30 arcsecs:</span>
g.region <span class="re2">nsres</span>=<span class="nu0">0</span>:00:<span class="nu0">30</span> <span class="re2">ewres</span>=<span class="nu0">0</span>:00:<span class="nu0">30</span>  
&nbsp;
<span class="co0">#############################################</span>
<span class="co0">######### WORLDCLIM DATA </span>
<span class="co0"># download, unzip and save raster data from worldclim </span>
<span class="co0"># (.bil, 30 arc sec resolution, epsg 4326):</span>
&nbsp;
<span class="co0"># cd to input working directory:</span>
<span class="kw3">cd</span> ~<span class="sy0">/</span>Documents<span class="sy0">/</span>GISdata<span class="sy0">/</span>Worldclim
&nbsp;
<span class="co0"># create folders to hold downloaded data:</span>
<span class="kw2">mkdir</span> worldclim_current_tmp  worldclim_future_tmp
&nbsp;
<span class="co0">######### CURRENT CONDITIONS:</span>
<span class="co0">#####  1. download 5 zip files for current climate: tmin, tmax, prec, bio1-9, bio10-19</span>
<span class="kw3">cd</span> ~<span class="sy0">/</span>Documents<span class="sy0">/</span>GISdata<span class="sy0">/</span>Worldclim<span class="sy0">/</span>worldclim_current_tmp
&nbsp;
<span class="co0">## download, unzip, fix header, remove .zip:</span>
&nbsp;
<span class="kw1">for</span> layer <span class="kw1">in</span> tmin tmax prec bio1-<span class="nu0">9</span> bio10-<span class="nu0">19</span>; <span class="kw1">do</span>	
	curl <span class="re5">-L</span> <span class="re5">-O</span> <span class="st0">&quot;http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/grid/cur/&quot;</span><span class="re1">$layer</span><span class="st0">&quot;_30s_bil.zip&quot;</span>  
	<span class="kw2">unzip</span> <span class="re1">$layer</span><span class="st0">&quot;_30s_bil&quot;</span> 
&nbsp;
	<span class="co0"># if else statement for different filenaming with respect to zipfilename</span>
	<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es2">$layer</span>&quot;</span> == tmin <span class="br0">&#93;</span> <span class="sy0">||</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es2">$layer</span>&quot;</span> == tmax <span class="br0">&#93;</span> <span class="sy0">||</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es2">$layer</span>&quot;</span> == prec <span class="br0">&#93;</span> ; <span class="kw1">then</span> 
&nbsp;
	<span class="co0"># fix the problem with the missing header: </span>
        <span class="co0"># (http://duncanjg.wordpress.com/2010/08/09/import-worldclim-data-into-grass/):</span>
		<span class="kw1">for</span> i <span class="kw1">in</span> $<span class="br0">&#40;</span><span class="kw2">seq</span> <span class="nu0">1</span> <span class="nu0">12</span><span class="br0">&#41;</span>; <span class="kw1">do</span> 
			<span class="kw3">echo</span> <span class="re5">-e</span> <span class="st0">&quot;PIXELTYPE     SIGNEDINT<span class="es1">\r</span>&quot;</span> <span class="sy0">&gt;&gt;</span><span class="re1">$layer</span><span class="st0">&quot;_&quot;</span><span class="re1">$i</span>.hdr; <span class="co0"># append &quot;PIXELTYPE SIGNEDINT&quot; to each hdr file</span>
		<span class="kw1">done</span> 
&nbsp;
	<span class="kw1">elif</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es2">$layer</span>&quot;</span> == bio1-<span class="nu0">9</span> <span class="br0">&#93;</span>; <span class="kw1">then</span>
		<span class="kw1">for</span> i <span class="kw1">in</span> $<span class="br0">&#40;</span><span class="kw2">seq</span> <span class="nu0">1</span> <span class="nu0">9</span><span class="br0">&#41;</span>; <span class="kw1">do</span> 
			<span class="kw3">echo</span> <span class="re5">-e</span> <span class="st0">&quot;PIXELTYPE     SIGNEDINT<span class="es1">\r</span>&quot;</span> <span class="sy0">&gt;&gt;</span><span class="st0">&quot;bio_&quot;</span><span class="re1">$i</span>.hdr;
		<span class="kw1">done</span> 
	<span class="kw1">else</span>
		<span class="kw1">for</span> i <span class="kw1">in</span> $<span class="br0">&#40;</span><span class="kw2">seq</span> <span class="nu0">10</span> <span class="nu0">19</span><span class="br0">&#41;</span>; <span class="kw1">do</span> 
			<span class="kw3">echo</span> <span class="re5">-e</span> <span class="st0">&quot;PIXELTYPE     SIGNEDINT<span class="es1">\r</span>&quot;</span> <span class="sy0">&gt;&gt;</span><span class="st0">&quot;bio_&quot;</span><span class="re1">$i</span>.hdr;
		<span class="kw1">done</span> 
&nbsp;
	<span class="kw1">fi</span>	
	<span class="kw2">rm</span> <span class="re1">$layer</span><span class="st0">&quot;_30s_bil.zip&quot;</span>
<span class="kw1">done</span>
&nbsp;
<span class="co0"># check what is there:</span>
gdalinfo <span class="re1">$layer</span><span class="st0">&quot;_1.bil&quot;</span>
&nbsp;
<span class="co0">##### 2. cut all .bil files to europe extent (same as in location europeWGS84); output as Gtiff </span>
&nbsp;
<span class="kw1">for</span> layer <span class="kw1">in</span> tmin tmax prec bio; <span class="kw1">do</span>	
	<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es2">$layer</span>&quot;</span> == bio <span class="br0">&#93;</span>; <span class="kw1">then</span>
		<span class="kw1">for</span> i <span class="kw1">in</span> $<span class="br0">&#40;</span><span class="kw2">seq</span> <span class="nu0">1</span> <span class="nu0">19</span><span class="br0">&#41;</span>; <span class="kw1">do</span>
			gdalwarp <span class="re5">-te</span> -<span class="nu0">25.1</span> <span class="nu0">34.9</span> <span class="nu0">35</span> <span class="nu0">71.3</span> <span class="re1">$layer</span><span class="st0">&quot;_&quot;</span><span class="re1">$i</span>.bil eu_<span class="re1">$layer</span><span class="st0">&quot;_&quot;</span><span class="re1">$i</span>.tif
		<span class="kw1">done</span>
	<span class="kw1">else</span> 
		<span class="kw1">for</span> i <span class="kw1">in</span> $<span class="br0">&#40;</span><span class="kw2">seq</span> <span class="nu0">1</span> <span class="nu0">12</span><span class="br0">&#41;</span>; <span class="kw1">do</span>
			gdalwarp <span class="re5">-te</span> -<span class="nu0">25.1</span> <span class="nu0">34.9</span> <span class="nu0">35</span> <span class="nu0">71.3</span> <span class="re1">$layer</span><span class="st0">&quot;_&quot;</span><span class="re1">$i</span>.bil eu_<span class="re1">$layer</span><span class="st0">&quot;_&quot;</span><span class="re1">$i</span>.tif
		<span class="kw1">done</span>
	<span class="kw1">fi</span>
<span class="kw1">done</span>
&nbsp;
<span class="co0"># check:</span>
gdalinfo <span class="st0">&quot;eu_&quot;</span><span class="re1">$layer</span><span class="st0">&quot;_1.tif&quot;</span>  
&nbsp;
<span class="co0">## remove original bil/hdr files:</span>
<span class="kw2">rm</span> <span class="sy0">*</span>.hdr; <span class="kw2">rm</span> <span class="sy0">*</span>.bil
&nbsp;
<span class="co0">##### 3. import the tifs into GRASS</span>
&nbsp;
<span class="co0"># tmin, tmax, prec: 12 files for 12 months</span>
<span class="kw1">for</span> layer <span class="kw1">in</span> tmin tmax prec bio; <span class="kw1">do</span>	
	<span class="kw1">for</span> i <span class="kw1">in</span> $<span class="br0">&#40;</span><span class="kw2">seq</span> <span class="nu0">1</span> <span class="nu0">12</span><span class="br0">&#41;</span>; <span class="kw1">do</span> r.in.gdal <span class="re5">-o</span> <span class="re2">input</span>=eu_<span class="re1">$layer</span><span class="st0">&quot;_&quot;</span><span class="re1">$i</span>.tif <span class="re2">output</span>=<span class="re1">$layer</span><span class="re1">$i</span>; <span class="kw1">done</span>
<span class="kw1">done</span>
<span class="co0"># biovars: 19 files</span>
<span class="re2">layer</span>=bio
<span class="kw1">for</span> i <span class="kw1">in</span> $<span class="br0">&#40;</span><span class="kw2">seq</span> <span class="nu0">1</span> <span class="nu0">19</span><span class="br0">&#41;</span>; <span class="kw1">do</span> r.in.gdal <span class="re5">-o</span> <span class="re2">input</span>=eu_<span class="re1">$layer</span><span class="st0">&quot;_&quot;</span><span class="re1">$i</span>.tif <span class="re2">output</span>=<span class="re1">$layer</span><span class="re1">$i</span>; <span class="kw1">done</span>
&nbsp;
<span class="co0"># check:</span>
g.list <span class="re2">type</span>=rast
r.info <span class="re2">map</span>=tmin1
&nbsp;
&nbsp;
<span class="co0">######### FUTURE CONDITIONS:</span>
<span class="co0"># Climate scenario: 2070 (70), GCM: HadGEM2-AO (HD), RCP: rcp60 (60)</span>
<span class="co0"># cd to folder for future:</span>
<span class="kw3">cd</span> ~<span class="sy0">/</span>Documents<span class="sy0">/</span>GISdata<span class="sy0">/</span>Worldclim<span class="sy0">/</span>worldclim_future_tmp<span class="sy0">/</span>
<span class="kw2">mkdir</span> <span class="re5">-p</span> europetmp 
&nbsp;
<span class="co0">##### 1. download and unzip (these files are in .tif already; type=float32)</span>
&nbsp;
<span class="kw1">for</span> layer <span class="kw1">in</span> tn tx <span class="kw2">pr</span> bi; <span class="kw1">do</span>	
	curl <span class="re5">-L</span> <span class="re5">-O</span> <span class="st0">&quot;http://biogeo.ucdavis.edu/data/climate/cmip5/30s/hd60&quot;</span><span class="re1">$layer</span><span class="st0">&quot;70.zip&quot;</span>
	<span class="kw2">unzip</span> <span class="st0">&quot;hd60&quot;</span><span class="re1">$layer</span><span class="st0">&quot;70.zip&quot;</span>
	<span class="kw2">rm</span> <span class="st0">&quot;hd60&quot;</span><span class="re1">$layer</span><span class="st0">&quot;70.zip&quot;</span>
	<span class="co0"># clip to Europe extent</span>
	<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="st0">&quot;<span class="es2">$layer</span>&quot;</span> == bi <span class="br0">&#93;</span> ; <span class="kw1">then</span>  
		<span class="kw1">for</span> i <span class="kw1">in</span> $<span class="br0">&#40;</span><span class="kw2">seq</span> <span class="nu0">1</span> <span class="nu0">19</span><span class="br0">&#41;</span>; <span class="kw1">do</span>
			gdalwarp <span class="re5">-te</span> -<span class="nu0">25.1</span> <span class="nu0">34.9</span> <span class="nu0">35</span> <span class="nu0">71.3</span> <span class="st0">&quot;hd60&quot;</span><span class="re1">$layer</span><span class="st0">&quot;70&quot;</span><span class="re1">$i</span><span class="st0">&quot;.tif&quot;</span> europetmp<span class="sy0">/</span><span class="st0">&quot;eu_hd60&quot;</span><span class="re1">$layer</span><span class="st0">&quot;70&quot;</span><span class="re1">$i</span><span class="st0">&quot;.tif&quot;</span>
		<span class="kw1">done</span>
	<span class="kw1">else</span>
		<span class="kw1">for</span> i <span class="kw1">in</span> $<span class="br0">&#40;</span><span class="kw2">seq</span> <span class="nu0">1</span> <span class="nu0">12</span><span class="br0">&#41;</span>; <span class="kw1">do</span>
			gdalwarp <span class="re5">-te</span> -<span class="nu0">25.1</span> <span class="nu0">34.9</span> <span class="nu0">35</span> <span class="nu0">71.3</span> <span class="st0">&quot;hd60&quot;</span><span class="re1">$layer</span><span class="st0">&quot;70&quot;</span><span class="re1">$i</span><span class="st0">&quot;.tif&quot;</span> europetmp<span class="sy0">/</span><span class="st0">&quot;eu_hd60&quot;</span><span class="re1">$layer</span><span class="st0">&quot;70&quot;</span><span class="re1">$i</span><span class="st0">&quot;.tif&quot;</span>
		<span class="kw1">done</span>
	<span class="kw1">fi</span>
	<span class="kw2">rm</span> <span class="st0">&quot;hd60&quot;</span><span class="re1">$layer</span><span class="st0">&quot;70&quot;</span><span class="sy0">*</span>.tif  <span class="co0"># clean up on the go</span>
<span class="kw1">done</span>
&nbsp;
<span class="co0">## remove original bil/hdr files:</span>
<span class="kw2">rm</span> <span class="sy0">*</span>.hdr; <span class="kw2">rm</span> <span class="sy0">*</span>.bil
&nbsp;
<span class="co0">##### 2. import the tifs into GRASS</span>
&nbsp;
<span class="co0"># tmin, tmax, prec: 12 files for 12 months </span>
<span class="kw1">for</span> layer <span class="kw1">in</span> tn tx <span class="kw2">pr</span>; <span class="kw1">do</span>	
	<span class="kw1">for</span> i <span class="kw1">in</span> $<span class="br0">&#40;</span><span class="kw2">seq</span> <span class="nu0">1</span> <span class="nu0">12</span><span class="br0">&#41;</span>; <span class="kw1">do</span> r.in.gdal <span class="re5">-o</span> <span class="re2">input</span>=europetmp<span class="sy0">/</span>eu_hd60<span class="re1">$layer</span><span class="st0">&quot;70&quot;</span><span class="re1">$i</span>.tif <span class="re2">output</span>=70hd60<span class="re1">$layer</span><span class="re1">$i</span>; <span class="kw1">done</span>
<span class="kw1">done</span>
<span class="co0"># biovars: 19 files</span>
<span class="re2">layer</span>=bi
<span class="kw1">for</span> i <span class="kw1">in</span> $<span class="br0">&#40;</span><span class="kw2">seq</span> <span class="nu0">1</span> <span class="nu0">19</span><span class="br0">&#41;</span>; <span class="kw1">do</span> r.in.gdal <span class="re5">-o</span> <span class="re2">input</span>=europetmp<span class="sy0">/</span>eu_hd60<span class="re1">$layer</span><span class="st0">&quot;70&quot;</span><span class="re1">$i</span>.tif <span class="re2">output</span>=70hd60<span class="re1">$layer</span><span class="re1">$i</span>; <span class="kw1">done</span>
&nbsp;
<span class="co0"># check:</span>
g.list <span class="re2">type</span>=rast
r.info <span class="re2">map</span>=tmin1</pre>
</dd></dl>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Worldclim data - Grass database - Location Europe&quot;,&quot;hid&quot;:&quot;worldclim_data_-_grass_database_-_location_europe&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:11,&quot;range&quot;:&quot;4179-9074&quot;} -->
<h3 class="sectionedit12" id="create_new_location_for_sweden">Create new Location for Sweden</h3>
<div class="level3">

<p>
The script continues to create a new location for Sweden (extent follows a polygon outline of Sweden). 
Resolution is set to 50m, corresponding to highest resolution of all input rasters. 
Projection Sweref99TM (EPSG:3006). Note: grass does not know EPSG:3006, but recognises equivalence to UTM33N, EPSG:32633, and stores data using this CRS.
</p>
<dl class="code">
<dt><a href="/dokuwiki/doku.php?do=export_code&amp;id=wikistudholland:utwente_helen&amp;codeblock=1" title="Download Snippet" class="mediafile mf_sh">- buildgrassdb_continued.sh</a></dt>
<dd><pre class="code bash">&nbsp;
<span class="co0">#############################################</span>
<span class="co0">######### create new Location: SWEDEN</span>
&nbsp;
&nbsp;
<span class="co0">### 1. create new location:</span>
<span class="co0"># IMPORTANT: set resolution for region to 50 m from start </span>
<span class="co0"># (else: on the fly nearest neighbour resampling)</span>
<span class="co0"># easiest with an input raster: </span>
<span class="co0"># use gdal to clip and reproject one of my inputs to Sweden:</span>
&nbsp;
<span class="co0"># get poly outline of Sweden:</span>
<span class="co0">#curl -L -O &quot;http://biogeo.ucdavis.edu/data/gadm2/shp/SWE_adm.zip&quot;</span>
<span class="co0"># or use own:</span>
ogrinfo <span class="re5">-so</span> <span class="re5">-al</span> ~<span class="sy0">/</span>Documents<span class="sy0">/</span>GISdata<span class="sy0">/</span>Sweden_outline<span class="sy0">/</span>Sweden_WGS84.shp
&nbsp;
<span class="co0">## clip one of the Europe rasters to this outline:</span>
<span class="kw3">cd</span> ~<span class="sy0">/</span>Documents<span class="sy0">/</span>GISdata<span class="sy0">/</span>Worldclim<span class="sy0">/</span>worldclim_current_tmp
<span class="kw2">mkdir</span> swedentmp
<span class="co0"># clip European extent to outline of Sweden only (using polygon outline) </span>
<span class="co0"># AND reproject to Sweref99TM (epsg3006) AND resample to 50m resolution:</span>
gdalwarp <span class="re5">-dstnodata</span> <span class="re5">-9999</span> -t_srs EPSG:<span class="nu0">3006</span> <span class="re5">-tr</span> <span class="nu0">50</span> <span class="nu0">50</span> <span class="re5">-cutline</span> \
~<span class="sy0">/</span>Documents<span class="sy0">/</span>GISdata<span class="sy0">/</span>Sweden_outline<span class="sy0">/</span>Sweden_WGS84.shp -crop_to_cutline \
eu_tmin_1.tif swedentmp<span class="sy0">/</span>swe_templ.tif
&nbsp;
gdalinfo swedentmp<span class="sy0">/</span>swe_templ.tif 
&nbsp;
<span class="co0"># create new location from this raster in existing GRASSDB: </span>
r.in.gdal <span class="re2">input</span>=~<span class="sy0">/</span>Documents<span class="sy0">/</span>GISdata<span class="sy0">/</span>Worldclim<span class="sy0">/</span>worldclim_current_tmp<span class="sy0">/</span>swedentmp<span class="sy0">/</span>swe_templ.tif <span class="re2">output</span>=swe_templ <span class="re2">location</span>=swedenSWEREF <span class="re5">--overwrite</span> 
&nbsp;
<span class="co0"># switch to new location:</span>
g.mapset <span class="re2">mapset</span>=PERMANENT <span class="re2">location</span>=swedenSWEREF <span class="re2">gisdbase</span>=~<span class="sy0">/</span>Documents<span class="sy0">/</span>GISdata<span class="sy0">/</span>GRASSDB
&nbsp;
<span class="co0"># remove the raster used for creating location (in grass and on HD):</span>
g.remove <span class="re2">rast</span>=swe_templ 
<span class="kw2">rm</span> swedentmp<span class="sy0">/</span>swe_templ.tif
&nbsp;
<span class="co0"># switch to new location: not sure this works</span>
<span class="co0"># g.gisenv set=&quot;LOCATION_NAME=swedenSWEREF&quot; ### seems to work, but prompt still says euopreWGS84</span>
<span class="co0"># exit grass: (safer)</span>
<span class="kw3">exit</span></pre>
</dd></dl>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Create new Location for Sweden&quot;,&quot;hid&quot;:&quot;create_new_location_for_sweden&quot;,&quot;codeblockOffset&quot;:1,&quot;secid&quot;:12,&quot;range&quot;:&quot;9075-11099&quot;} -->
<h3 class="sectionedit13" id="worldclim_sweden">Worldclim Sweden</h3>
<div class="level3">

<p>
Continue to populate the new location with data for Sweden. First: Worldclim data:
</p>
<dl class="code">
<dt><a href="/dokuwiki/doku.php?do=export_code&amp;id=wikistudholland:utwente_helen&amp;codeblock=2" title="Download Snippet" class="mediafile mf_sh">- buildgrassdb_continued.sh</a></dt>
<dd><pre class="code bash">&nbsp;
<span class="co0">#############################################</span>
<span class="co0">### BUILD UP DATABASE FOR SWEDEN:</span>
&nbsp;
<span class="co0">#  reopen GRASS in swedenSWEREF location, mapset PERMANENT:</span>
grass ~<span class="sy0">/</span>Documents<span class="sy0">/</span>GISdata<span class="sy0">/</span>GRASSDB<span class="sy0">/</span>swedenSWEREF<span class="sy0">/</span>PERMANENT
&nbsp;
<span class="co0">########## WORLDCLIM - import to grass</span>
<span class="co0">## CURRENT:</span>
<span class="kw3">cd</span> ~<span class="sy0">/</span>Documents<span class="sy0">/</span>GISdata<span class="sy0">/</span>Worldclim<span class="sy0">/</span>worldclim_current_tmp<span class="sy0">/</span>
<span class="kw2">mkdir</span> <span class="re5">-p</span> swedentmp  
&nbsp;
<span class="co0"># import all clipped and reprojected rasters into grass:</span>
&nbsp;
<span class="kw1">for</span> layer <span class="kw1">in</span> tmin tmax prec; <span class="kw1">do</span>
	<span class="kw1">for</span> i <span class="kw1">in</span> $<span class="br0">&#40;</span><span class="kw2">seq</span> <span class="nu0">1</span> <span class="nu0">12</span><span class="br0">&#41;</span>; <span class="kw1">do</span>
	<span class="co0"># clip European extent to outline of Sweden only (using polygon outline) </span>
        <span class="co0"># AND reproject to Sweref99TM (epsg3006):</span>
	gdalwarp <span class="re5">-dstnodata</span> <span class="re5">-9999</span> -t_srs EPSG:<span class="nu0">3006</span> \
          <span class="re5">-cutline</span> ~<span class="sy0">/</span>Documents<span class="sy0">/</span>GISdata<span class="sy0">/</span>Sweden_outline<span class="sy0">/</span>Sweden_WGS84.shp -crop_to_cutline \
          <span class="st0">&quot;eu_&quot;</span><span class="re1">$layer</span><span class="st0">&quot;_&quot;</span><span class="re1">$i</span><span class="st0">&quot;.tif&quot;</span> swedentmp<span class="sy0">/</span>swe_<span class="re1">$layer</span><span class="re1">$i</span>.tif
	<span class="co0">## import to GRASS</span>
	r.in.gdal <span class="re2">input</span>=~<span class="sy0">/</span>Documents<span class="sy0">/</span>GISdata<span class="sy0">/</span>Worldclim<span class="sy0">/</span>worldclim_current_tmp<span class="sy0">/</span>swedentmp<span class="sy0">/</span><span class="st0">&quot;swe_&quot;</span><span class="re1">$layer</span><span class="re1">$i</span><span class="st0">&quot;.tif&quot;</span> <span class="re2">output</span>=<span class="st0">&quot;swe_&quot;</span><span class="re1">$layer</span><span class="re1">$i</span> <span class="re5">--overwrite</span>
	<span class="kw1">done</span>
<span class="kw1">done</span>
&nbsp;
<span class="re2">layer</span>=bio
<span class="kw1">for</span> i <span class="kw1">in</span> $<span class="br0">&#40;</span><span class="kw2">seq</span> <span class="nu0">1</span> <span class="nu0">19</span><span class="br0">&#41;</span>; <span class="kw1">do</span>
	<span class="co0"># clip European extent to outline of Sweden only (using polygon outline) </span>
        <span class="co0"># AND reproject to Sweref99TM (epsg3006):</span>
	gdalwarp <span class="re5">-dstnodata</span> <span class="re5">-9999</span> -t_srs EPSG:<span class="nu0">3006</span> <span class="re5">-cutline</span> ~<span class="sy0">/</span>Documents<span class="sy0">/</span>GISdata<span class="sy0">/</span>Sweden_outline<span class="sy0">/</span>Sweden_WGS84.shp \
          -crop_to_cutline <span class="st0">&quot;eu_&quot;</span><span class="re1">$layer</span><span class="st0">&quot;_&quot;</span><span class="re1">$i</span><span class="st0">&quot;.tif&quot;</span> swedentmp<span class="sy0">/</span>swe_<span class="re1">$layer</span><span class="re1">$i</span>.tif
	<span class="co0">## import to GRASS:</span>
	r.in.gdal <span class="re2">input</span>=~<span class="sy0">/</span>Documents<span class="sy0">/</span>GISdata<span class="sy0">/</span>Worldclim<span class="sy0">/</span>worldclim_current_tmp<span class="sy0">/</span>swedentmp<span class="sy0">/</span><span class="st0">&quot;swe_&quot;</span><span class="re1">$layer</span><span class="re1">$i</span><span class="st0">&quot;.tif&quot;</span> <span class="re2">output</span>=<span class="st0">&quot;swe_&quot;</span><span class="re1">$layer</span><span class="re1">$i</span> <span class="re5">--overwrite</span>
<span class="kw1">done</span>
&nbsp;
<span class="co0"># remove the tif files:</span>
<span class="co0">#rm -r swedentmp</span>
<span class="co0">#rm -r europetmp</span>
&nbsp;
<span class="co0">## FUTURE:</span>
<span class="kw3">cd</span> ~<span class="sy0">/</span>Documents<span class="sy0">/</span>GISdata<span class="sy0">/</span>Worldclim<span class="sy0">/</span>worldclim_future_tmp<span class="sy0">/</span>
<span class="kw2">mkdir</span> <span class="re5">-p</span> swedentmp
&nbsp;
<span class="kw1">for</span> layer <span class="kw1">in</span> tn tx <span class="kw2">pr</span>; <span class="kw1">do</span>
	<span class="kw1">for</span> i <span class="kw1">in</span> $<span class="br0">&#40;</span><span class="kw2">seq</span> <span class="nu0">1</span> <span class="nu0">12</span><span class="br0">&#41;</span>; <span class="kw1">do</span>
	<span class="co0"># clip European extent to outline of Sweden only (using polygon outline) </span>
        <span class="co0"># AND reproject to Sweref99TM (epsg3006)</span>
	gdalwarp <span class="re5">-dstnodata</span> <span class="re5">-9999</span> -t_srs EPSG:<span class="nu0">3006</span> <span class="re5">-cutline</span> ~<span class="sy0">/</span>Documents<span class="sy0">/</span>GISdata<span class="sy0">/</span>Sweden_outline<span class="sy0">/</span>Sweden_WGS84.shp \
          -crop_to_cutline europetmp<span class="sy0">/</span><span class="st0">&quot;eu_hd60&quot;</span><span class="re1">$layer</span><span class="st0">&quot;70&quot;</span><span class="re1">$i</span><span class="st0">&quot;.tif&quot;</span> swedentmp<span class="sy0">/</span><span class="st0">&quot;swe_70hd60&quot;</span><span class="re1">$layer</span><span class="re1">$i</span>.tif
	<span class="co0">## import to GRASS</span>
	r.in.gdal <span class="re2">input</span>=~<span class="sy0">/</span>Documents<span class="sy0">/</span>GISdata<span class="sy0">/</span>Worldclim<span class="sy0">/</span>worldclim_future_tmp<span class="sy0">/</span>swedentmp<span class="sy0">/</span><span class="st0">&quot;swe_70hd60&quot;</span><span class="re1">$layer</span><span class="re1">$i</span><span class="st0">&quot;.tif&quot;</span> \                
          <span class="re2">output</span>=<span class="st0">&quot;swe_70hd60&quot;</span><span class="re1">$layer</span><span class="re1">$i</span> <span class="re5">--overwrite</span>
	<span class="kw1">done</span>
<span class="kw1">done</span>
&nbsp;
<span class="re2">layer</span>=bi
<span class="kw1">for</span> i <span class="kw1">in</span> $<span class="br0">&#40;</span><span class="kw2">seq</span> <span class="nu0">1</span> <span class="nu0">19</span><span class="br0">&#41;</span>; <span class="kw1">do</span>
	<span class="co0"># clip European extent to outline of Sweden only (using polygon outline) </span>
        <span class="co0"># AND reproject to Sweref99TM (epsg3006):</span>
	gdalwarp <span class="re5">-dstnodata</span> <span class="re5">-9999</span> -t_srs EPSG:<span class="nu0">3006</span> <span class="re5">-cutline</span> ~<span class="sy0">/</span>Documents<span class="sy0">/</span>GISdata<span class="sy0">/</span>Sweden_outline<span class="sy0">/</span>Sweden_WGS84.shp \
          -crop_to_cutline europetmp<span class="sy0">/</span><span class="st0">&quot;eu_hd60&quot;</span><span class="re1">$layer</span><span class="st0">&quot;70&quot;</span><span class="re1">$i</span><span class="st0">&quot;.tif&quot;</span> swedentmp<span class="sy0">/</span><span class="st0">&quot;swe_70hd60&quot;</span><span class="re1">$layer</span><span class="re1">$i</span>.tif
	<span class="co0">## import to GRASS:</span>
	r.in.gdal <span class="re2">input</span>=~<span class="sy0">/</span>Documents<span class="sy0">/</span>GISdata<span class="sy0">/</span>Worldclim<span class="sy0">/</span>worldclim_future_tmp<span class="sy0">/</span>swedentmp<span class="sy0">/</span><span class="st0">&quot;swe_70hd60&quot;</span><span class="re1">$layer</span><span class="re1">$i</span><span class="st0">&quot;.tif&quot;</span> \ 
           <span class="re2">output</span>=<span class="st0">&quot;swe_70hd60&quot;</span><span class="re1">$layer</span><span class="re1">$i</span> <span class="re5">--overwrite</span>
<span class="kw1">done</span>
&nbsp;
<span class="co0"># remove the tif files:</span>
<span class="co0">#rm -r swedentmp</span>
<span class="co0">#rm -r europetmp</span></pre>
</dd></dl>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Worldclim Sweden&quot;,&quot;hid&quot;:&quot;worldclim_sweden&quot;,&quot;codeblockOffset&quot;:2,&quot;secid&quot;:13,&quot;range&quot;:&quot;11100-14042&quot;} -->
<h3 class="sectionedit14" id="land_cover_data">Land cover data</h3>
<div class="level3">

<p>
Continue to populate the new location with additional data for Sweden (continue working in GRASS). Second: CORINE land cover data:
</p>
<dl class="code">
<dt><a href="/dokuwiki/doku.php?do=export_code&amp;id=wikistudholland:utwente_helen&amp;codeblock=3" title="Download Snippet" class="mediafile mf_sh">- buildgrassdb_continued.sh</a></dt>
<dd><pre class="code bash">&nbsp;
&nbsp;
<span class="co0">################################################</span>
<span class="co0"># OTHER DATASETS to add to Sweden:</span>
<span class="co0">################################################</span>
<span class="co0">######### CORINE landcover 100x100m from EEA, </span>
<span class="co0"># epsg3035 Type=Byte (44 categories, with color table)</span>
&nbsp;
<span class="kw3">cd</span> ~<span class="sy0">/</span>Documents<span class="sy0">/</span>GISdata<span class="sy0">/</span>EEA_CORINE<span class="sy0">/</span>
curl <span class="re5">-L</span> <span class="re5">-O</span> <span class="st0">&quot;http://www.eea.europa.eu/data-and-maps/data/corine-land-cover-2006-raster-2/clc-2006-100m/g100_06.zip&quot;</span> <span class="co0"># needs -L to follow links in case file has been moved</span>
<span class="kw2">unzip</span> g100_06.zip
gdalinfo g100_06_version2011<span class="sy0">/</span>g100_06.tif <span class="co0"># Europe, proj ETRS_1989_LAEA (epsg3035), 100m, colour table </span>
&nbsp;
<span class="co0">## reproject, clip, and import for Sweden:</span>
<span class="kw3">cd</span> g100_06_version2011<span class="sy0">/</span>
<span class="co0"># clip European extent to outline of Sweden only (using polygon outline) </span>
<span class="co0"># AND reproject to Sweref99TM (epsg3006):</span>
gdalwarp <span class="re5">-dstnodata</span> <span class="re5">-9999</span> -t_srs EPSG:<span class="nu0">3006</span> <span class="re5">-cutline</span> ~<span class="sy0">/</span>Documents<span class="sy0">/</span>GISdata<span class="sy0">/</span>Sweden_outline<span class="sy0">/</span>Sweden_WGS84.shp \
  -crop_to_cutline g100_06.tif swe_CORINE_100m.tif
<span class="co0">## import to GRASS</span>
r.in.gdal <span class="re2">input</span>=~<span class="sy0">/</span>Documents<span class="sy0">/</span>GISdata<span class="sy0">/</span>EEA_CORINE<span class="sy0">/</span>g100_06_version2011<span class="sy0">/</span>swe_CORINE_100m.tif \
  <span class="re2">output</span>=CORINE_EEA <span class="re5">--overwrite</span></pre>
</dd></dl>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Land cover data&quot;,&quot;hid&quot;:&quot;land_cover_data&quot;,&quot;codeblockOffset&quot;:3,&quot;secid&quot;:14,&quot;range&quot;:&quot;14043-15297&quot;} -->
<h3 class="sectionedit15" id="soil_and_bedrock_types">Soil and bedrock types</h3>
<div class="level3">

<p>
Continue to populate the new location with additional data for Sweden (continue working in GRASS). Third: categorical soil type data (SGU):
</p>
<dl class="code">
<dt><a href="/dokuwiki/doku.php?do=export_code&amp;id=wikistudholland:utwente_helen&amp;codeblock=4" title="Download Snippet" class="mediafile mf_sh">- buildgrassdb_continued.sh</a></dt>
<dd><pre class="code bash">&nbsp;
<span class="co0">#################################################</span>
<span class="co0">######### SOIL DATA SGU  </span>
<span class="co0"># vector data, Sweref99TM</span>
<span class="kw3">cd</span> ~<span class="sy0">/</span>Documents<span class="sy0">/</span>GISdata<span class="sy0">/</span>SGU2013<span class="sy0">/</span>SGU2014<span class="sy0">/</span>
&nbsp;
<span class="co0"># download and unzip:</span>
<span class="kw1">for</span> name <span class="kw1">in</span> jord berggrund; <span class="kw1">do</span>
curl <span class="re5">-L</span> <span class="re5">-O</span> http:<span class="sy0">//</span>www.sgu.se<span class="sy0">/</span>dokument<span class="sy0">/</span>service_sgu_publ<span class="sy0">/</span><span class="re1">$name</span><span class="st0">&quot;1M.zip&quot;</span>
<span class="kw2">unzip</span> <span class="re1">$name</span><span class="st0">&quot;1M.zip&quot;</span> <span class="co0"># unzips into folder</span>
<span class="kw1">done</span>
&nbsp;
<span class="co0"># rasterize : (are already in Sweref, 1:1M)</span>
gdal_rasterize <span class="re5">-a</span> JG2 -a_nodata <span class="re5">-9999</span> <span class="re5">-tr</span> <span class="nu0">1000.0</span> <span class="nu0">1000.0</span> <span class="re5">-l</span> jona_jg2 \
  <span class="re5">-ot</span> Int32 jord<span class="sy0">/</span>data<span class="sy0">/</span>jona_jg2.shp jord<span class="sy0">/</span>data<span class="sy0">/</span>soil1km.tif
gdal_rasterize <span class="re5">-a</span> BRG -a_nodata <span class="re5">-9999</span> <span class="re5">-tr</span> <span class="nu0">1000.0</span> <span class="nu0">1000.0</span> <span class="re5">-l</span> berggrundsytor \
  <span class="re5">-ot</span> Int32 berggrund<span class="sy0">/</span>berggrundsytor.shp berggrund<span class="sy0">/</span>bedrock1km.tif
&nbsp;
<span class="co0"># clip to Sweden outline:</span>
gdalwarp <span class="re5">-dstnodata</span> <span class="re5">-9999</span> -t_srs EPSG:<span class="nu0">3006</span> <span class="re5">-cutline</span> ~<span class="sy0">/</span>Documents<span class="sy0">/</span>GISdata<span class="sy0">/</span>Sweden_outline<span class="sy0">/</span>Sweden_WGS84.shp \
  -crop_to_cutline jord<span class="sy0">/</span>data<span class="sy0">/</span>soil1km.tif jord<span class="sy0">/</span>data<span class="sy0">/</span>soil1km_cropped.tif
gdalwarp <span class="re5">-dstnodata</span> <span class="re5">-9999</span> -t_srs EPSG:<span class="nu0">3006</span> <span class="re5">-cutline</span> ~<span class="sy0">/</span>Documents<span class="sy0">/</span>GISdata<span class="sy0">/</span>Sweden_outline<span class="sy0">/</span>Sweden_WGS84.shp \
  -crop_to_cutline berggrund<span class="sy0">/</span>bedrock1km.tif berggrund<span class="sy0">/</span>bedrock1km_cropped.tif
&nbsp;
<span class="co0"># clean up:</span>
<span class="kw2">rm</span> jord<span class="sy0">/</span>data<span class="sy0">/</span>soil1km.tif
<span class="kw2">rm</span> berggrund<span class="sy0">/</span>bedrock1km.tif
&nbsp;
<span class="co0">## create new mapset within swedenSWEREF: SGUsoil </span>
<span class="co0"># (switches there automatically accord. to g.gisenv but not the prompt)</span>
&nbsp;
g.mapset <span class="re5">-c</span> <span class="re2">mapset</span>=SGUsoil <span class="re2">location</span>=swedenSWEREF <span class="re2">gisdbase</span>=~<span class="sy0">/</span>Documents<span class="sy0">/</span>GISdata<span class="sy0">/</span>GRASSDB
&nbsp;
<span class="co0"># switch to new mapset: (&quot;a fairly radical maneuvre&quot;)</span>
<span class="co0">#g.mapset mapset=SGUsoil</span>
<span class="co0"># or exit and re-enter, to be on safe side:</span>
<span class="kw3">exit</span>
grass ~<span class="sy0">/</span>Documents<span class="sy0">/</span>GISdata<span class="sy0">/</span>GRASSDB<span class="sy0">/</span>swedenSWEREF<span class="sy0">/</span>SGUsoil
&nbsp;
<span class="kw3">cd</span> ~<span class="sy0">/</span>Documents<span class="sy0">/</span>GISdata<span class="sy0">/</span>SGU2013<span class="sy0">/</span>SGU2014<span class="sy0">/</span>
&nbsp;
<span class="co0"># import rasterized and clipped tifs to grass:</span>
r.in.gdal <span class="re2">input</span>=jord<span class="sy0">/</span>data<span class="sy0">/</span>soil1km_cropped.tif <span class="re2">output</span>=SGU_soil_1km
r.in.gdal <span class="re2">input</span>=berggrund<span class="sy0">/</span>bedrock1km_cropped.tif <span class="re2">output</span>=SGU_bedrock_1km
&nbsp;
<span class="kw3">exit</span></pre>
</dd></dl>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Soil and bedrock types&quot;,&quot;hid&quot;:&quot;soil_and_bedrock_types&quot;,&quot;codeblockOffset&quot;:4,&quot;secid&quot;:15,&quot;range&quot;:&quot;15298-17231&quot;} -->
<h3 class="sectionedit16" id="vector_data1">Vector data</h3>
<div class="level3">

<p>
Continue to populate the new location with additional data for Sweden (continue working in GRASS). Fourth: vector data (outlines of Sweden and the Norrström Drainage Basin):
</p>
<dl class="code">
<dt><a href="/dokuwiki/doku.php?do=export_code&amp;id=wikistudholland:utwente_helen&amp;codeblock=5" title="Download Snippet" class="mediafile mf_sh">- buildgrassdb_continued.sh</a></dt>
<dd><pre class="code bash">&nbsp;
<span class="co0">#########################################################################################</span>
<span class="co0">######### VECTOR DATA Sweden and Norrstrom drainage basin:</span>
grass ~<span class="sy0">/</span>Documents<span class="sy0">/</span>GISdata<span class="sy0">/</span>GRASSDB<span class="sy0">/</span>swedenSWEREF<span class="sy0">/</span>PERMANENT
&nbsp;
<span class="co0">##import vector sweden outline into grass</span>
v.in.ogr <span class="re5">-oe</span> <span class="re2">dsn</span>=~<span class="sy0">/</span>Documents<span class="sy0">/</span>GISdata<span class="sy0">/</span>Sweden_outline<span class="sy0">/</span>Sweden_SWEREF99.shp <span class="re2">output</span>=vect_swe_boundary
g.list <span class="re2">type</span>=vect  <span class="co0"># worked</span>
v.info <span class="re2">map</span>=vect_swe_boundary
&nbsp;
<span class="co0">## and Norrstrom outline:</span>
v.in.ogr <span class="re5">-oe</span> <span class="re2">dsn</span>=~<span class="sy0">/</span>Documents<span class="sy0">/</span>GISdata<span class="sy0">/</span>NDB<span class="sy0">/</span>NDB_border.shp <span class="re2">output</span>=vect_NDB_boundary</pre>
</dd></dl>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Vector data&quot;,&quot;hid&quot;:&quot;vector_data1&quot;,&quot;codeblockOffset&quot;:5,&quot;secid&quot;:16,&quot;range&quot;:&quot;17232-17992&quot;} -->
<h3 class="sectionedit17" id="digital_elevation_model">Digital Elevation Model</h3>
<div class="level3">

<p>
Continue to populate the new location with additional data for Sweden (continue working in GRASS). Fifth: Digital Elevation Model (DEM) of Sweden, resolution 50m, Sweref99TM. From the DEM, calculate additional rasters of aspect, slope, and topographic wetness index (twi) in GRASS:
</p>
<dl class="code">
<dt><a href="/dokuwiki/doku.php?do=export_code&amp;id=wikistudholland:utwente_helen&amp;codeblock=6" title="Download Snippet" class="mediafile mf_sh">- buildgrassdb_continued.sh</a></dt>
<dd><pre class="code bash">&nbsp;
<span class="co0">#########################################################################################</span>
<span class="co0">#########  DEM 50m res, from Lantmateriet:</span>
<span class="co0">#grass ~/Documents/GISdata/GRASSDB/swedenSWEREF/PERMANENT</span>
&nbsp;
<span class="kw3">cd</span> ~<span class="sy0">/</span>Documents<span class="sy0">/</span>GISdata<span class="sy0">/</span>SwedenDEM_Lantmateriet_Andrew<span class="sy0">/</span>
gdalinfo SwedenDEM50mSWEREF.tif  <span class="co0"># epsg 3006, 50mx50m, from tiles, </span>
<span class="co0"># slightly larger than the vector outline (should be masked by region)</span>
&nbsp;
<span class="co0"># import:</span>
r.in.gdal <span class="re2">input</span>=~<span class="sy0">/</span>Documents<span class="sy0">/</span>GISdata<span class="sy0">/</span>SwedenDEM_Lantmateriet_Andrew<span class="sy0">/</span>SwedenDEM50mSWEREF.tif <span class="re2">output</span>=DEM_50M
&nbsp;
<span class="co0">## create new mapset for work with DEM: (switches automatically to new)</span>
g.mapset <span class="re5">-c</span> <span class="re2">mapset</span>=DEMwork <span class="re2">location</span>=swedenSWEREF <span class="re2">gisdbase</span>=~<span class="sy0">/</span>Documents<span class="sy0">/</span>GISdata<span class="sy0">/</span>GRASSDB
&nbsp;
<span class="co0"># copy DEM into working mapset DEMwork:  #not required, have access to PERMANENT</span>
<span class="co0"># g.copy rast='DEM_50M@PERMANENT',DEM_50M # NOT NECESSARY, can use any raster in location</span>
&nbsp;
<span class="co0">## from DEM, calculate slope, aspect and topographic wetness index: </span>
&nbsp;
<span class="co0"># slope (degrees) and aspect (E N W S): </span>
r.slope.aspect <span class="re5">-a</span> <span class="re2">elevation</span>=DEM_50M <span class="re2">slope</span>=DEM50M_slope <span class="re2">aspect</span>=DEM50M_aspect
&nbsp;
<span class="co0"># topographic wetness index (ln(a/tan(beta)):</span>
r.topidx <span class="re2">input</span>=DEM_50M <span class="re2">output</span>=DEM50M_twi
&nbsp;
<span class="co0">## :this took a long time, fills up memory and slows down exponentially;</span>
<span class="co0">## tried using GNU parallel (installed via homebrew), but aborted after warning</span>
<span class="co0">#parallel r.topidx input=DEM_50M output=DEM50M_twi</span>
&nbsp;
&nbsp;
<span class="co0"># export all 3 rasters as tif:</span>
<span class="co0">#cd ~/Documents/GISdata/SwedenDEM_Lantmateriet_Andrew/</span>
<span class="kw2">mkdir</span> <span class="re5">-p</span> derived<span class="sy0">/</span>
&nbsp;
<span class="co0"># note: had to add createopt=&quot;TFW=YES&quot; to export readable tifs </span>
&nbsp;
<span class="kw1">for</span> layer <span class="kw1">in</span> aspect slope twi; <span class="kw1">do</span>
r.out.gdal <span class="re2">input</span>=DEM50M_<span class="re1">$layer</span> <span class="re2">format</span>=GTiff <span class="re2">type</span>=Float32 <span class="re2">output</span>=DEM50m_<span class="re1">$layer</span>.tif <span class="re2">nodata</span>=-<span class="nu0">9999</span> <span class="re2">createopt</span>=<span class="st0">&quot;TFW=YES&quot;</span> 
&nbsp;
<span class="co0"># the GTiff output from GRASS has dimensions 0x0, only readable because of TFW file; </span>
<span class="co0"># therefore warp into proper tif, cut to polygon and give it some metatdata:</span>
gdalwarp <span class="re5">-dstnodata</span> <span class="re5">-9999</span> -s_srs EPSG:<span class="nu0">32633</span> -t_srs EPSG:<span class="nu0">3006</span> <span class="re5">-ot</span> Float32 <span class="re5">-dstnodata</span> <span class="re5">-9999</span> <span class="re5">-tr</span> <span class="nu0">50</span> <span class="nu0">50</span> \
  <span class="re5">-cutline</span> ~<span class="sy0">/</span>Documents<span class="sy0">/</span>GISdata<span class="sy0">/</span>Sweden_outline<span class="sy0">/</span>Sweden_WGS84.shp -crop_to_cutline DEM50m_<span class="re1">$layer</span>.tif \
   derived<span class="sy0">/</span>DEM50m_<span class="re1">$layer</span>.tif
<span class="kw2">rm</span> DEM50m_<span class="re1">$layer</span>.tif; <span class="kw2">rm</span> DEM50m_<span class="re1">$layer</span>.tfw
<span class="kw1">done</span>
&nbsp;
<span class="co0">#########################################################################################</span></pre>
</dd></dl>

<p>
To be able to use bedrock types as input to a random forest model, reclassify the raster. Originally contains 146 classes, but the randomForest function (in R package randomForest) cannot handle &gt;32 levels of categorical data. 
</p>

<p>
Reclassification was done manually via the following steps:
</p>
<ul>
<li class="level1"><div class="li"> load original shape file into QGis</div>
</li>
<li class="level1"><div class="li"> export attribute table as csv</div>
</li>
</ul>

<p>
Using the following R script:
</p>
<ul>
<li class="level1"><div class="li"> import the csv</div>
</li>
<li class="level1"><div class="li"> subset to unique categories, and export the csv</div>
</li>
<li class="level1"><div class="li"> manually create aggregate classes and add to csv (OpenOffice) </div>
</li>
<li class="level1"><div class="li"> re-import edited csv and create reclassification matrix from it</div>
</li>
<li class="level1"><div class="li"> reclassify the raster</div>
</li>
<li class="level1"><div class="li"> export as tif</div>
</li>
</ul>

<p>
Finally add to the GRASS database.
</p>
<dl class="code">
<dt><a href="/dokuwiki/doku.php?do=export_code&amp;id=wikistudholland:utwente_helen&amp;codeblock=7" title="Download Snippet" class="mediafile mf_r">- reclassifyBedrock.R</a></dt>
<dd><pre class="code R"># in QGis, exported attribute table of shape file to csv file.
&nbsp;
# upload this csv :
rocks &lt;- read.csv(file=&quot;~/Documents/GISdata/SGU2013/SGU2014/berggrund/berggrundsytor.csv&quot;)
&nbsp;
# what's in it?:
names(rocks) # BRG is code, Lithology is label
&nbsp;
# subset to code and label:
rocks &lt;- rocks[,c(1,3)]
&nbsp;
# subset to unique values:
rocks &lt;- unique(rocks)
&nbsp;
# sort alphabetically:
rocks &lt;- with(rocks,  rocks[order(LITHOLOGY) , ])
&nbsp;
# export table to csv::
write.csv(rocks, file=&quot;~/Documents/GISdata/SGU2013/SGU2014/berggrund/categories.csv&quot;, row.names=F)
&nbsp;
# manually add aggregated classes - numbered and with label - in OpenOffice,
# then reload:
rocks &lt;- read.csv(file=&quot;~/Documents/GISdata/SGU2013/SGU2014/berggrund/categories.csv&quot;)
&nbsp;
# make rcl matrix: col1 &quot;is&quot;, col2 &quot;becomes&quot;:
reclass &lt;- as.matrix(rocks[,c(1,2)])
&nbsp;
# cd to dir with raster file, and reclassify original tif based on rcl:
setwd(&quot;~/Documents/GISdata/ph_predictors_sweref_50m&quot;)
reclassify(rock, reclass, filename='rock_reclassified')
&nbsp;
system('ls') # written to .gri file - cannot use gdalwarp (unknown format)
&nbsp;
# load that instead of old rock layer, to export then as tif:
rock &lt;- raster(&quot;~/Documents/GISdata/ph_predictors_sweref_50m/rock_reclassified.gri&quot;)
&nbsp;
# check values:
as.matrix(table(values(rock))) # classes 1:15 plus 999 for unknown
&nbsp;
# make factor to work with it in R:
#rock &lt;- as.factor(rock)
&nbsp;
# export the reclassified raster to tif:
writeRaster(rock, &quot;rock_reclassified.tif&quot;, format=&quot;GTiff&quot;)
&nbsp;
# check if it worked:
system('gdalinfo rock_reclassified.tif')
&nbsp;
# clean up:
rm(rocks, reclass)</pre>
</dd></dl>

<p>
Add the reclassified bedrock raster to the GRASS database:
</p>
<dl class="code">
<dt><a href="/dokuwiki/doku.php?do=export_code&amp;id=wikistudholland:utwente_helen&amp;codeblock=8" title="Download Snippet" class="mediafile mf_sh">- addBedrock_reclass.sh</a></dt>
<dd><pre class="code bash">&nbsp;
<span class="kw3">cd</span> ~<span class="sy0">/</span>Documents<span class="sy0">/</span>GISdata<span class="sy0">/</span>ph_predictors_sweref_50m<span class="sy0">/</span>
&nbsp;
<span class="co0"># warp to Sweref, data type: Int32</span>
gdalwarp <span class="re5">-dstnodata</span> <span class="nu0">0</span> -t_srs EPSG:<span class="nu0">3006</span> <span class="re5">-ot</span> Int32 <span class="re5">-tr</span> <span class="nu0">50</span> <span class="nu0">50</span> rock_reclassified.tif rock_reclassified_sweref.tif
&nbsp;
<span class="co0"># import to GRASS, swedenSWEREF, SGUsoil:</span>
grass ~<span class="sy0">/</span>Documents<span class="sy0">/</span>GISdata<span class="sy0">/</span>GRASSDB<span class="sy0">/</span>swedenSWEREF<span class="sy0">/</span>SGUsoil
&nbsp;
r.in.gdal <span class="re2">input</span>=~<span class="sy0">/</span>Documents<span class="sy0">/</span>GISdata<span class="sy0">/</span>ph_predictors_sweref_50m<span class="sy0">/</span>rock_reclassified_sweref.tif \ 
  <span class="re2">output</span>=SGU_bedrock_1km_reclassed
&nbsp;
<span class="kw3">exit</span></pre>
</dd></dl>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Digital Elevation Model&quot;,&quot;hid&quot;:&quot;digital_elevation_model&quot;,&quot;codeblockOffset&quot;:6,&quot;secid&quot;:17,&quot;range&quot;:&quot;17993-23345&quot;} -->
<h3 class="sectionedit18" id="noter_for_spatial_data">Note: R for spatial data</h3>
<div class="level3">

<p>
4 different ways of loading raster data into R. From my experience, option Nr 4 is by far the best.
</p>
<dl class="code">
<dt><a href="/dokuwiki/doku.php?do=export_code&amp;id=wikistudholland:utwente_helen&amp;codeblock=9" title="Download Snippet" class="mediafile mf_r">- loadRaster.R</a></dt>
<dd><pre class="code R">##### 1. directly from GRASS:----------------------------------------------------
## in terminal, start grass:
# grass ~/Documents/GISdata/GRASSDB/swedenSWEREF/SGUsoil/
## open R from within a running GRASS session:
# open -a RStudio.app &amp;
&nbsp;
library(spgrass6)
&nbsp;
# allows the use of grass commands from within R:
system('g.list type=rast')
&nbsp;
## read grass raster: readRAST6()
&nbsp;
soil1 &lt;- readRAST6(vname=&quot;SGU_soil_1km&quot;)    
&nbsp;
# takes longer than loading from a file 
# returns large SpatialGridDataFrame (eats up memory)
&nbsp;
# vname can be vector of multiple files, 
# cat=&quot;SGU_soil_1km&quot; should allow factor, but gives error for integer
&nbsp;
system('exit')
&nbsp;
&nbsp;
##### 2. indirectly from GRASS:-------------------------------------------------------
&nbsp;
library(raster)
&nbsp;
### raster()- from cellhd in grass db: 
soil2 = raster(&quot;~/Documents/GISdata/GRASSDB/swedenSWEREF/SGUsoil/cellhd/SGU_soil_1km&quot;)
&nbsp;
# error - doesnt recognize file format
&nbsp;
&nbsp;
##### 3. rgdal via tif:---------------------------------------------------------------
&nbsp;
library(rgdal)
&nbsp;
### readGDAL(): 
soil3 &lt;- readGDAL(fname=&quot;~/Documents/GISdata/ph_predictors_sweref_50m/SGU_soil_50m.tif&quot;)
&nbsp;
# returns large SpatialGridDataFrame (eats up memory)
# speed similar to readRAST6()
&nbsp;
&nbsp;
##### 4. raster() via tif: ---------------------------------------------------------------
&nbsp;
library(raster)
&nbsp;
### raster():
soil &lt;- raster(&quot;~/Documents/GISdata/ph_predictors_sweref_50m/SGU_soil_50m.tif&quot;, values=T) 
&nbsp;
# uses very little memory - creates link to raster, virtual representation</pre>
</dd></dl>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Note: R for spatial data&quot;,&quot;hid&quot;:&quot;noter_for_spatial_data&quot;,&quot;codeblockOffset&quot;:9,&quot;secid&quot;:18,&quot;range&quot;:&quot;23346-25026&quot;} -->
<h2 class="sectionedit19" id="results">RESULTS</h2>
<div class="level2">

<p>
A neat GRASSDATABASE - stores a huge amount of raster data in just 5 <abbr title="Gigabyte">GB</abbr>, and is easily copy-pasted between machines. 
</p>

<p>
<a href="http://spatial-ecology.net/dokuwiki/lib/exe/fetch.php?media=wikistudholland:grassdblayout.png" class="urlextern" target="blanc" title="http://spatial-ecology.net/dokuwiki/lib/exe/fetch.php?media=wikistudholland:grassdblayout.png" rel="nofollow noopener">http://spatial-ecology.net/dokuwiki/lib/exe/fetch.php?media=wikistudholland:grassdblayout.png</a>
</p>

<p>
<em>2 DO: create input raster stack to MaxEnt; run MaxEnt on all predictors</em>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;RESULTS&quot;,&quot;hid&quot;:&quot;results&quot;,&quot;codeblockOffset&quot;:10,&quot;secid&quot;:19,&quot;range&quot;:&quot;25027-&quot;} -->