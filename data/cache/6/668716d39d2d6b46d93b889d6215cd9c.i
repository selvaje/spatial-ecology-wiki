a:98:{i:0;a:3:{i:0;s:14:"document_start";i:1;a:0:{}i:2;i:0;}i:1;a:3:{i:0;s:6:"header";i:1;a:3:{i:0;s:68:"Understanding Autoecology & Synecology to model species distribution";i:1;i:2;i:2;i:1;}i:2;i:1;}i:2;a:3:{i:0;s:12:"section_open";i:1;a:1:{i:0;i:2;}i:2;i:1;}i:3;a:3:{i:0;s:6:"p_open";i:1;a:0:{}i:2;i:1;}i:4;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:175:"The main aim of this page is to show how to retrieve environmental information at point level and build up a table useful to identify  Autoecology and Synecology of a species.";}i:2;i:83;}i:5;a:3:{i:0;s:7:"p_close";i:1;a:0:{}i:2;i:258;}i:6;a:3:{i:0;s:10:"listu_open";i:1;a:0:{}i:2;i:258;}i:7;a:3:{i:0;s:13:"listitem_open";i:1;a:1:{i:0;i:1;}i:2;i:258;}i:8;a:3:{i:0;s:16:"listcontent_open";i:1;a:0:{}i:2;i:258;}i:9;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:118:" Autoecology: the branch of ecology which deals with individual species and their reactions to environmental factors. ";}i:2;i:264;}i:10;a:3:{i:0;s:12:"externallink";i:1;a:2:{i:0;s:28:"http://www.everythingbio.com";i:1;s:7:"sources";}i:2;i:382;}i:11;a:3:{i:0;s:17:"listcontent_close";i:1;a:0:{}i:2;i:422;}i:12;a:3:{i:0;s:14:"listitem_close";i:1;a:0:{}i:2;i:422;}i:13;a:3:{i:0;s:13:"listitem_open";i:1;a:1:{i:0;i:1;}i:2;i:422;}i:14;a:3:{i:0;s:16:"listcontent_open";i:1;a:0:{}i:2;i:422;}i:15;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:143:" Synecology : The branch of ecology which deals with the distribution, abundance, demography, and interactions between coexisting populations. ";}i:2;i:427;}i:16;a:3:{i:0;s:17:"listcontent_close";i:1;a:0:{}i:2;i:570;}i:17;a:3:{i:0;s:14:"listitem_close";i:1;a:0:{}i:2;i:570;}i:18;a:3:{i:0;s:11:"listu_close";i:1;a:0:{}i:2;i:570;}i:19;a:3:{i:0;s:6:"p_open";i:1;a:0:{}i:2;i:570;}i:20;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:59:"As an example we show a typical pattern of 3 plant species.";}i:2;i:572;}i:21;a:3:{i:0;s:6:"plugin";i:1;a:4:{i:0;s:19:"markdowku_linebreak";i:1;a:3:{i:0;s:3:"  
";i:1;i:5;i:2;i:631;}i:2;i:5;i:3;s:3:"  
";}i:2;i:631;}i:22;a:3:{i:0;s:9:"linebreak";i:1;a:0:{}i:2;i:634;}i:23;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:1:"
";}i:2;i:636;}i:24;a:3:{i:0;s:13:"internalmedia";i:1;a:7:{i:0;s:27:":wiki:synecology_cembro.png";i:1;N;i:2;N;i:3;s:3:"600";i:4;N;i:5;s:5:"cache";i:6;s:7:"details";}i:2;i:637;}i:25;a:3:{i:0;s:9:"linebreak";i:1;a:0:{}i:2;i:672;}i:26;a:3:{i:0;s:7:"p_close";i:1;a:0:{}i:2;i:674;}i:27;a:3:{i:0;s:6:"p_open";i:1;a:0:{}i:2;i:674;}i:28;a:3:{i:0;s:9:"linebreak";i:1;a:0:{}i:2;i:677;}i:29;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:138:"
Autoecology and synecology of Pinus cembra, according to bioclimatic variables and to the distribution of Larix decidua and Picea abies  ";}i:2;i:679;}i:30;a:3:{i:0;s:12:"externallink";i:1;a:2:{i:0;s:86:"http://www.spatial-ecology.net/giuseppe/publications/1-s2.0-S0378112709007257-main.pdf";i:1;s:28:" (S. Casalegno et. al. 2010)";}i:2;i:817;}i:31;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:4:". ( ";}i:2;i:938;}i:32;a:3:{i:0;s:12:"externallink";i:1;a:2:{i:0;s:66:"http://spatial-ecology.net/dokuwiki/doku.php?id=wiki:pcem_syneco_r";i:1;s:7:" script";}i:2;i:942;}i:33;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:1:")";}i:2;i:1020;}i:34;a:3:{i:0;s:7:"p_close";i:1;a:0:{}i:2;i:1021;}i:35;a:3:{i:0;s:13:"section_close";i:1;a:0:{}i:2;i:1024;}i:36;a:3:{i:0;s:6:"header";i:1;a:3:{i:0;s:31:"Autoecology of Solitary Tinamou";i:1;i:2;i:2;i:1024;}i:2;i:1024;}i:37;a:3:{i:0;s:12:"section_open";i:1;a:1:{i:0;i:2;}i:2;i:1024;}i:38;a:3:{i:0;s:6:"p_open";i:1;a:0:{}i:2;i:1024;}i:39;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:4:"The ";}i:2;i:1069;}i:40;a:3:{i:0;s:12:"externallink";i:1;a:2:{i:0;s:45:"http://en.wikipedia.org/wiki/Solitary_Tinamou";i:1;s:18:" Solitary Tinamou ";}i:2;i:1073;}i:41;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:43:" is a bird that is living in South America.";}i:2;i:1143;}i:42;a:3:{i:0;s:9:"linebreak";i:1;a:0:{}i:2;i:1186;}i:43;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:34:"
Points data can be download from ";}i:2;i:1188;}i:44;a:3:{i:0;s:12:"externallink";i:1;a:2:{i:0;s:31:"http://ebird.org/content/ebird/";i:1;s:7:" ebird ";}i:2;i:1222;}i:45;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:5:" and ";}i:2;i:1266;}i:46;a:3:{i:0;s:12:"externallink";i:1;a:2:{i:0;s:20:"http://www.gbif.org/";i:1;s:5:" gbif";}i:2;i:1271;}i:47;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:171:". Moreover, in Map Of Life there are dataset of presence and absence in National Parks. 
We will use these points to extract environment variable values as in this picture";}i:2;i:1303;}i:48;a:3:{i:0;s:9:"linebreak";i:1;a:0:{}i:2;i:1474;}i:49;a:3:{i:0;s:7:"p_close";i:1;a:0:{}i:2;i:1477;}i:50;a:3:{i:0;s:10:"table_open";i:1;a:3:{i:0;i:1;i:1;i:1;i:2;i:1478;}i:2;i:1477;}i:51;a:3:{i:0;s:13:"tablerow_open";i:1;a:0:{}i:2;i:1477;}i:52;a:3:{i:0;s:14:"tablecell_open";i:1;a:3:{i:0;i:1;i:1;N;i:2;i:1;}i:2;i:1477;}i:53;a:3:{i:0;s:13:"internalmedia";i:1;a:7:{i:0;s:13:":wiki:gis.jpg";i:1;N;i:2;N;i:3;s:3:"350";i:4;N;i:5;s:5:"cache";i:6;s:7:"details";}i:2;i:1479;}i:54;a:3:{i:0;s:15:"tablecell_close";i:1;a:0:{}i:2;i:1500;}i:55;a:3:{i:0;s:14:"tablerow_close";i:1;a:0:{}i:2;i:1505;}i:56;a:3:{i:0;s:11:"table_close";i:1;a:1:{i:0;i:1505;}i:2;i:1505;}i:57;a:3:{i:0;s:13:"section_close";i:1;a:0:{}i:2;i:1508;}i:58;a:3:{i:0;s:6:"header";i:1;a:3:{i:0;s:35:"Prepare the data before import in R";i:1;i:4;i:2;i:1508;}i:2;i:1508;}i:59;a:3:{i:0;s:12:"section_open";i:1;a:1:{i:0;i:4;}i:2;i:1508;}i:60;a:3:{i:0;s:4:"code";i:1;a:3:{i:0;s:83:"
cp  -r  /home/user/Dropbox/itc2013/Solitary_Tinamou  /home/user/ost4sem/exercise/
";i:1;s:4:"bash";i:2;N;}i:2;i:1559;}i:61;a:3:{i:0;s:6:"p_open";i:1;a:0:{}i:2;i:1559;}i:62;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:145:"The following code focus in data download and data preparation. You may skip this part because the data has been already downloaded and unzipped.";}i:2;i:1657;}i:63;a:3:{i:0;s:6:"plugin";i:1;a:4:{i:0;s:19:"markdowku_linebreak";i:1;a:3:{i:0;s:3:"  
";i:1;i:5;i:2;i:1802;}i:2;i:5;i:3;s:3:"  
";}i:2;i:1802;}i:64;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:0:"";}i:2;i:1805;}i:65;a:3:{i:0;s:7:"p_close";i:1;a:0:{}i:2;i:1811;}i:66;a:3:{i:0;s:4:"code";i:1;a:3:{i:0;s:1007:"

# see the text data file 
# cd /home/user/ost4sem/exercise/Solitary_Tinamou/pointdata/
# more ebd_soltin1_relAug-2013.txt
# select the the column 21 LATITUDE and 22 LONGITUDE 
# awk -F  "\t" '{  print $21 ,  $22 }'   ebd_soltin1_relAug-2013.txt > lat_long_ebd.txt

# download WorldCom data 
# the WorldCom data have been already downloaded and stored in this directory /home/user/ost4sem/exercise/Solitary_Tinamou/worldclim

# wget http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/tmean_34_tif.zip 
# wget http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/tmax_34_tif.zip 
# wget http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/tmin_34_tif.zip 
# wget http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/alt_34_tif.zip 
# wget http://biogeo.ucdavis.edu/data/climate/worldclim/1_4/tiles/cur/prec_34_tif.zip 

# unzipped the dataset
# unzip alt_34_tif.zip
# unzip prec_34_tif.zip
# unzip tmax_34_tif.zip
# unzip tmean_34_tif.zip
# unzip tmin_34_tif.zip

";i:1;s:4:"bash";i:2;N;}i:2;i:1811;}i:67;a:3:{i:0;s:6:"p_open";i:1;a:0:{}i:2;i:1811;}i:68;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:302:"Before to start R navigate in the /home/user/ost4sem/exercise/Solitary_Tinamou/* directories and open the file with the different software that we present so far: openev , qgis , more for txt file. 
Try to use as much as possible the terminal to navigate in the directories and for opening the software";}i:2;i:2833;}i:69;a:3:{i:0;s:6:"plugin";i:1;a:4:{i:0;s:19:"markdowku_linebreak";i:1;a:3:{i:0;s:4:"   
";i:1;i:5;i:2;i:3135;}i:2;i:5;i:3;s:4:"   
";}i:2;i:3135;}i:70;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:0:"";}i:2;i:3139;}i:71;a:3:{i:0;s:7:"p_close";i:1;a:0:{}i:2;i:3140;}i:72;a:3:{i:0;s:13:"section_close";i:1;a:0:{}i:2;i:3140;}i:73;a:3:{i:0;s:6:"header";i:1;a:3:{i:0;s:17:"Install library R";i:1;i:4;i:2;i:3140;}i:2;i:3140;}i:74;a:3:{i:0;s:12:"section_open";i:1;a:1:{i:0;i:4;}i:2;i:3140;}i:75;a:3:{i:0;s:6:"p_open";i:1;a:0:{}i:2;i:3140;}i:76;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:99:"Check if you have the following library are installed and if not installed them by starting R with ";}i:2;i:3166;}i:77;a:3:{i:0;s:13:"emphasis_open";i:1;a:0:{}i:2;i:3265;}i:78;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:4:"sudo";}i:2;i:3267;}i:79;a:3:{i:0;s:14:"emphasis_close";i:1;a:0:{}i:2;i:3271;}i:80;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:23:" right in the terminal.";}i:2;i:3273;}i:81;a:3:{i:0;s:7:"p_close";i:1;a:0:{}i:2;i:3296;}i:82;a:3:{i:0;s:4:"code";i:1;a:3:{i:0;s:8:"
sudo R
";i:1;s:4:"bash";i:2;N;}i:2;i:3303;}i:83;a:3:{i:0;s:4:"code";i:1;a:3:{i:0;s:137:"
install.packages("dismo")
install.packages("XML")
install.packages("maptools")
install.packages("rgeos")
install.packages("rasterVis")

";i:1;s:1:"r";i:2;N;}i:2;i:3331;}i:84;a:3:{i:0;s:13:"section_close";i:1;a:0:{}i:2;i:3480;}i:85;a:3:{i:0;s:6:"header";i:1;a:3:{i:0;s:7:"Start R";i:1;i:4;i:2;i:3480;}i:2;i:3480;}i:86;a:3:{i:0;s:12:"section_open";i:1;a:1:{i:0;i:4;}i:2;i:3480;}i:87;a:3:{i:0;s:6:"p_open";i:1;a:0:{}i:2;i:3480;}i:88;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:118:"From this point you can open in Rstudio following script /home/user/ost4sem/exercise/Solitary_Tinamou/script/Tinamou.R";}i:2;i:3497;}i:89;a:3:{i:0;s:7:"p_close";i:1;a:0:{}i:2;i:3615;}i:90;a:3:{i:0;s:4:"code";i:1;a:3:{i:0;s:7038:"
library(raster)
library (dismo)
library (XML)
library (rgeos)
library (maptools)
library(sp)
library(rasterVis)
library(rgdal)
library(car)

## download point data of occurrences from the Global Biodiversity Information Facility (GBIF) dataset 
gbif_points = gbif('Tinamus' , 'solitarius' , download=T , geo=T)
gbif_points=gbif_points[!is.na(gbif_points$lat),]

## import the ebird points
ebird = read.table("/home/user/ost4sem/exercise/Solitary_Tinamou/pointdata/lat_long_ebd.txt" ,header = TRUE  )

## import a presence-absence dataset from parks
parks = read.table ("/home/user/ost4sem/exercise/Solitary_Tinamou/pointdata/Tinamus_solitarius_rowids.asc" , header = TRUE  )

## import expert range
tin_range=readOGR("/home/user/ost4sem/exercise/Solitary_Tinamou/shp/iucn_birds_proj.shp","iucn_birds_proj")
tin_range=spTransform(tin_range,CRS("+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"))

## Make some pseudo-absences
pa=as.data.frame(coordinates(spsample(tin_range,70,type="random")))

## Build a combined dataset (with source, presence/absence, and coordinates)
points=rbind.data.frame(
  data.frame(src="gbif",obs=1,lat=gbif_points$lat,lon=gbif_points$lon),
  data.frame(src="ebird",obs=1,lat=ebird$LATITUDE,lon=ebird$LONGITUDE),
  data.frame(src="parks",obs=parks$presence,lat=parks$st_y,lon=parks$st_x),  
  data.frame(src="psuedo",obs=0,lat=pa$y,lon=pa$x)  
  )
## turn it into a spatial dataframe and define projection
coordinates(points)=c('lon','lat')
projection(points)="+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"

## Create a combined src_presence field for easy plotting
points$type=paste(points$src,points$obs,sep="_")

##import a world country boundary to ground the map
World  = readShapePoly ("/home/user/ost4sem/exercise/Solitary_Tinamou/shp/world_country_admin_boundary_shapefile_with_fips_codes.shp")
projection(World)="+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"

## check out the data
spplot(points,zcol="type",pch=1:5,col.regions=c("red","red","black","red","black"))+
  layer(sp.polygons( World))# ,xlim=c(-80 , -15) , ylim=c(-40,-5) ) ;

### uh oh, there are some records out in the ocean (typical GBIF!)
### There are several ways to handle this, one is to clip by the 'expert' range of the species.

## plot it again with the range
spplot(points,zcol="type",pch=1:5,col.regions=c("red","red","black","red","black"))+
  layer(sp.polygons( World))+
  layer(sp.polygons(tin_range,fill="grey"),under=T)

## So there are a few points just outside the range, but those in the ocean are most likely wrong.  
## Let's add the distance to the range polygon as a way to filter the observations:
## First we need a equidistant projection to do the calculation
dproj=CRS("+proj=eqc +lat_ts=0 +lat_0=0 +lon_0=0 +x_0=0 +y_0=0 +a=6371007 +b=6371007 +units=m +no_defs") 
points$dist=gDistance(spTransform(points,dproj),spTransform(tin_range,dproj),byid=T)[1,]
## that adds 'distance' (in meters) from each point to the polygon, check out the values:
hist(points$dist/1000,xlab="km to expert range")
## so some points are > 2000km from the range, let's drop any more than 10km
points=points[points$dist<10000,]

## plot it again with the range
spplot(points,zcol="type",pch=1:5,col.regions=c("red","red","black","red","black"))+
  layer(sp.polygons( World))+
  layer(sp.polygons(tin_range,fill="grey"),under=T)
## that looks better.



## plot it again adding psuedo-absences
spplot(points,zcol="type",pch=1:5,col.regions=c("red","red","black","red","black"))+
  layer(sp.polygons( World))+
  layer(sp.polygons(tin_range,fill="grey"),under=T)+
  layer(sp.points(pa,col="purple"))

## that looks better.


################################################################################
## Import some evironmental data (Climate & NPP) and align it to a common grid
env=stack(list.files(path = "/home/user/ost4sem/exercise/Solitary_Tinamou/worldclim/", pattern="*.tif$" , full.names = TRUE ))
## do some renaming for convenience
names(env)=sub("_34","",names(env))
names(env)[names(env)=="MOD17A3_Science_NPP_mean_00_12_clip"]="npp"
## set missing value in npp
NAvalue(env[["npp"]])=65535

## get total % forest
forest=sum(env[[grep("consensus",names(env))]])
names(forest)="forest"
## add forest into the env stack
env=stack(env,forest)

##  List all available environmental data
names(env)

## See how the points compare to altitude
var="prec12"
levelplot(env[[var]],col.regions=terrain.colors(20),margin=F)+
  layer(sp.polygons(tin_range))+
  layer(sp.points(points[points$obs==0,],col="black"))+ #add absences
  layer(sp.points(points[points$obs==1,],col="red"))    #add presences


## variable selection is tricky business and we're not going to dwell on it here...  
## we'll use the following variables
vars=c("tmean12","prec12","npp","alt","forest")
## look at the environmental variability
plot(env[[vars]])

## add the environmental data to each point
pointsd=extract(env[[vars]],points,sp=T)

## now check out some bivariate plots
## feel free to explore other variables

xyplot(npp~alt,groups=type,data=pointsd@data,auto.key=T)+
  layer(panel.ellipse(x,y,groups=pointsd$type,subscripts=T,level=.68))

xyplot(tmean12~prec12,groups=type,data=pointsd@data,auto.key=T)+
  layer(panel.ellipse(x,y,groups=pointsd$type,subscripts=T,level=.68))

xyplot(npp~forest,groups=type,data=pointsd@data,auto.key=T)+
  layer(panel.ellipse(x,y,groups=pointsd$type,subscripts=T,level=.68))

## Fit a very simple GLM to the data
m1=glm(obs~tmean12+prec12+npp+alt+forest,data=pointsd@data)
## Show the model summary
summary(m1)

## Use the model to predict p(presence) for all sites
pred=predict(env[[vars]],m1)

## Plot the predictions
levelplot(pred,col.regions=rainbow(20,start=.2,end=.9),margin=F)+
  layer(sp.polygons(tin_range,lwd=2))+
  layer(sp.points(points[points$obs==0,],col="black",cex=2,lwd=4))+ #add absences
  layer(sp.points(points[points$obs==1,],col="red",cex=2,lwd=4))    #add presences


## perhaps we should mask the predictions to the expert range
pred2=mask(pred,tin_range)

levelplot(pred2,col.regions=rainbow(20,start=.2,end=.9),margin=F)+
  layer(sp.polygons( World))+
  layer(sp.polygons(tin_range,lwd=2))+
  layer(sp.points(points[points$obs==0,],col="black",cex=2,lwd=4))+ #add absences
  layer(sp.points(points[points$obs==1,],col="red",cex=2,lwd=4))    #add presences

## quick accuracy assessment
predpoints=extract(pred,points,sp=T)
boxplot(layer~obs,data=predpoints@data,ylab="Estimated Propability of Occurrence",xlab="Observed Presence/Absence")

## to exclude the 'psuedo-absence' points, add this: [pointsd$type!="psuedo",]
## after pointsd@data

## what if we only used percent forest?
boxplot(forest~obs,data=pointsd@data,ylab="Percent Forest",xlab="Observed Presence/Absence")

##########################
## the polygons of the parks (and the associate presence/absence status) is available in 
## /home/user/ost4sem/exercise/Solitary_Tinamou/shp/protected_areas
## How would you use these polygons rather than the point data?
## check out the help for the extract function.

";i:1;s:1:"r";i:2;N;}i:2;i:3622;}i:91;a:3:{i:0;s:6:"p_open";i:1;a:0:{}i:2;i:3622;}i:92;a:3:{i:0;s:13:"internalmedia";i:1;a:7:{i:0;s:15:":wiki:prdPM.png";i:1;s:0:"";i:2;N;i:3;s:3:"600";i:4;N;i:5;s:5:"cache";i:6;s:7:"details";}i:2;i:10672;}i:93;a:3:{i:0;s:5:"cdata";i:1;a:1:{i:0;s:1:"
";}i:2;i:10696;}i:94;a:3:{i:0;s:13:"internalmedia";i:1;a:7:{i:0;s:16:":wiki:prdfad.png";i:1;s:0:"";i:2;N;i:3;s:3:"600";i:4;N;i:5;s:5:"cache";i:6;s:7:"details";}i:2;i:10697;}i:95;a:3:{i:0;s:7:"p_close";i:1;a:0:{}i:2;i:10722;}i:96;a:3:{i:0;s:13:"section_close";i:1;a:0:{}i:2;i:10724;}i:97;a:3:{i:0;s:12:"document_end";i:1;a:0:{}i:2;i:10724;}}