
<h1 class="sectionedit1" id="from_field_samples_to_maps">From field samples to Maps</h1>
<div class="level1">

<p>
To monitor agricultural productivity and soil parameters or map our site for planning new landscape improvements we can use low cost technology.
<a href="http://www.ianrpubs.unl.edu/live/ec154/build/ec154.pdf" class="urlextern" target="blanc" title="http://www.ianrpubs.unl.edu/live/ec154/build/ec154.pdf" rel="nofollow noopener"> Soil sampling for precision farming and permaculture site planning</a> can be carried out on a regular grid sampling pattern. We are looking at collecting representative samples of the heterogeneity of our site. As a general rule, more spatially heterogeneous is the pattern we are interested in mapping, the more points we would need to acquire. On the other side, if this high heterogeneity is strongly correlate with a soil parameter which we have accurate map, we would need few key samples to precisely map the target feature.<br/>

As an example, if we have a high correlation between a long history of agricultural practices (or soil solope) on our site and the soil carbon content of soils, we would need few points describing the correlation between soil carbon content and agricultural land cover type (or soil slope) to precisely describe the heterogeneity of soil carbon in our field.
</p>

<p>
For our study case we are going to map two key ecological patterns in our farm site:
</p>
<ul>
<li class="level1"><div class="li"> <a href="http://education.usgs.gov/lessons/soil.pdf" class="urlextern" target="blanc" title="http://education.usgs.gov/lessons/soil.pdf" rel="nofollow noopener"> Top soil depth </a> by measuring the depth of the horizon A. </div>
</li>
<li class="level1"><div class="li"> Flood prone areas - detecting paddles after rain events.</div>
</li>
</ul>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;From field samples to Maps&quot;,&quot;hid&quot;:&quot;from_field_samples_to_maps&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;1-1395&quot;} -->
<h2 class="sectionedit2" id="field_sampling">Field Sampling</h2>
<div class="level2">

<p>
<strong>Top soil organic depth: </strong><br/>

Our field sampling design is organized on a regular grid of core samples extracted north to south every 80m distance and east west distanced of 45m.
<a href="/dokuwiki/lib/exe/detail.php?id=sitedesign%3Asite_fieldsample&amp;media=sitedesign:soil_sample_design.png" class="media" title="sitedesign:soil_sample_design.png"><img src="/dokuwiki/lib/exe/fetch.php?media=sitedesign:soil_sample_design.png" class="mediacenter" alt="" /></a><br/>

Over this grid, we geolocate sampling location geographic coordinates using smarth phones GPS dig the soil and look at coulor / soil texture changes from dark black to yellow clay and also looking at the absence of rooth systems in the clay <a href="http://education.usgs.gov/lessons/soil.pdf" class="urlextern" target="blanc" title="http://education.usgs.gov/lessons/soil.pdf" rel="nofollow noopener"> horizon B</a>.
</p>

<p>
<strong>Flood prone areas</strong><br/>

While collecting data from the top soil depth, if any water accumulation paddles are detected, they are geolocated using smarth phones GPS, and we measure the rough x-y-z dimension of paddles.<br/>

</p>

<p>
The csv database we acquire looks as follow:<br/>

</p>
<div class="table sectionedit3"><table class="inline">
	<thead>
	<tr class="row0">
		<th class="col0">id</th><th class="col1">soil depth</th><th class="col2">lat</th><th class="col3">long</th><th class="col4">site info</th><th class="col5">group</th>
	</tr>
	</thead>
	<tr class="row1">
		<td class="col0">1</td><td class="col1">8</td><td class="col2">39.861975</td><td class="col3">-94.376532</td><td class="col4">sparse veg low â€“ Asteraceae</td><td class="col5">1</td>
	</tr>
	<tr class="row2">
		<td class="col0">..</td><td class="col1">..</td><td class="col2">..</td><td class="col3">..</td><td class="col4">..</td><td class="col5">..</td>
	</tr>
</table></div>
<!-- EDIT{&quot;target&quot;:&quot;table&quot;,&quot;name&quot;:&quot;&quot;,&quot;hid&quot;:&quot;table&quot;,&quot;secid&quot;:3,&quot;range&quot;:&quot;2216-2335&quot;} -->
<p>
<br/>

</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Field Sampling&quot;,&quot;hid&quot;:&quot;field_sampling&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;1396-2338&quot;} -->
<h2 class="sectionedit4" id="mapping">Mapping</h2>
<div class="level2">

</div>

<h4 id="from_a_text_table_to_a_vector_file">From a text table to a vector file</h4>
<div class="level4">

<p>
First we need to import our text file database (comma separated value <em>.csv</em> file format is good) into Qgis using the <a href="/dokuwiki/lib/exe/detail.php?id=sitedesign%3Asite_fieldsample&amp;media=sitedesign:add_delimeter.png" class="media" title="sitedesign:add_delimeter.png"><img src="/dokuwiki/lib/exe/fetch.php?w=25&amp;tok=32f730&amp;media=sitedesign:add_delimeter.png" class="media" alt="" width="25" /></a> <strong>Add delimiter Text layer</strong> option. As parameters we need to select:
</p>
<ul>
<li class="level1"><div class="li"> Comma separated file type</div>
</li>
<li class="level1"><div class="li"> First record has field names (we have an file header)</div>
</li>
<li class="level1"><div class="li"> Geometry definition is point</div>
</li>
<li class="level1"><div class="li"> define X-field as longitude</div>
</li>
<li class="level1"><div class="li"> Define Y-field as latitude</div>
</li>
</ul>

<p>
Output vector maps can be coded according to the soil depth or the group of people sampling in the field.<br/>

<a href="/dokuwiki/lib/exe/detail.php?id=sitedesign%3Asite_fieldsample&amp;media=sitedesign:sampling_chores.png" class="media" title="sitedesign:sampling_chores.png"><img src="/dokuwiki/lib/exe/fetch.php?w=150&amp;tok=f6455c&amp;media=sitedesign:sampling_chores.png" class="media" alt="" width="150" /></a><a href="/dokuwiki/lib/exe/detail.php?id=sitedesign%3Asite_fieldsample&amp;media=sitedesign:samplingchore_legend.png" class="media" title="sitedesign:samplingchore_legend.png"><img src="/dokuwiki/lib/exe/fetch.php?w=150&amp;tok=491d10&amp;media=sitedesign:samplingchore_legend.png" class="media" alt="" width="150" /></a><a href="/dokuwiki/lib/exe/detail.php?id=sitedesign%3Asite_fieldsample&amp;media=sitedesign:soil_depth_samples.png" class="media" title="sitedesign:soil_depth_samples.png"><img src="/dokuwiki/lib/exe/fetch.php?w=150&amp;tok=f2a2cf&amp;media=sitedesign:soil_depth_samples.png" class="mediaright" alt="" width="150" /></a><a href="/dokuwiki/lib/exe/detail.php?id=sitedesign%3Asite_fieldsample&amp;media=sitedesign:legend_soil_sample_depth.png" class="media" title="sitedesign:legend_soil_sample_depth.png"><img src="/dokuwiki/lib/exe/fetch.php?w=150&amp;tok=8584d6&amp;media=sitedesign:legend_soil_sample_depth.png" class="media" alt="" width="150" /></a>
</p>

<p>
Once we have loaded the text data as a vector file in Qgis, we use the <a href="/dokuwiki/lib/exe/detail.php?id=sitedesign%3Asite_fieldsample&amp;media=sitedesign:select_features_option.png" class="media" title="sitedesign:select_features_option.png"><img src="/dokuwiki/lib/exe/fetch.php?w=20&amp;tok=3ae1c1&amp;media=sitedesign:select_features_option.png" class="media" alt="" width="20" /></a> <strong>Select feature</strong> tool in Qgis to select only features sampled in the farm site and save those features into a new .shp vector file. Use
</p>
<ul>
<li class="level1"><div class="li"> Select the soil vector file loaded from the text <em>csv</em> file</div>
</li>
<li class="level1"><div class="li"> Click on <strong>Layer</strong></div>
</li>
<li class="level1"><div class="li"> Select <strong>Save as</strong></div>
</li>
<li class="level1"><div class="li"> Seve as: soilsample.shp/home/user/ost4sem/siteplan/data/vector/soilsample.shp</div>
</li>
<li class="level1"><div class="li"> Check the <em>Save only selected features</em> option</div>
</li>
<li class="level1"><div class="li"> Define Spatial Reference System as <em>EPSG:26915</em></div>
</li>
<li class="level1"><div class="li"> Click on OK</div>
</li>
</ul>

</div>

<h4 id="from_point_to_surface_maps">From point to surface maps</h4>
<div class="level4">

<p>
To convert point to surface map we need some approximation algorithms to provide a surface map from sparse point location samples. The interpolation of sparse point to continuous surface can be done using different techniques. GRASS gis and QGIS have different modules to perform this task. <a href="http://grasswiki.osgeo.org/wiki/Interpolation" class="urlextern" target="blanc" title="http://grasswiki.osgeo.org/wiki/Interpolation" rel="nofollow noopener"> Here</a> a good review of GRASS modules for point surface interpolation / resampling methods, and <a href="https://docs.qgis.org/2.2/en/docs/gentle_gis_introduction/spatial_analysis_interpolation.html" class="urlextern" target="blanc" title="https://docs.qgis.org/2.2/en/docs/gentle_gis_introduction/spatial_analysis_interpolation.html" rel="nofollow noopener">here</a> a guide to the interpolation module in Qgis.<br/>

</p>

<p>
<a href="/dokuwiki/lib/exe/detail.php?id=sitedesign%3Asite_fieldsample&amp;media=sitedesign:point2surface.png" class="media" title="sitedesign:point2surface.png"><img src="/dokuwiki/lib/exe/fetch.php?w=600&amp;tok=cf6dfc&amp;media=sitedesign:point2surface.png" class="mediacenter" alt="" width="600" /></a>
Between the different options we are going to use an <a href="https://en.wikipedia.org/wiki/Inverse_distance_weighting" class="urlextern" target="blanc" title="https://en.wikipedia.org/wiki/Inverse_distance_weighting" rel="nofollow noopener">Inverse Distance Weighted</a> algorithm for the point surface interpolation.
In grass we can process this map typing three lines in a terminal:
</p>
<ol>
<li class="level1"><div class="li"> Open grass in command line mode</div>
</li>
<li class="level1"><div class="li"> Import the previously created vector map from .shp file to grass vector format</div>
</li>
<li class="level1"><div class="li"> Process IDW algorithm and produce the output map</div>
</li>
</ol>

<p>
More info on the options available for the <a href="http://grass.osgeo.org/grass70/manuals/v.surf.idw.html" class="urlextern" target="blanc" title="http://grass.osgeo.org/grass70/manuals/v.surf.idw.html" rel="nofollow noopener">GRASS IDW module</a>.<br/>

</p>
<pre class="code bash">grass <span class="re5">-text</span> ost4sem<span class="sy0">/</span>grassdb<span class="sy0">/</span>Missouri<span class="sy0">/</span>PERMANENT<span class="sy0">/</span>
v.in.ogr <span class="re5">-r</span> <span class="re2">dsn</span>=<span class="sy0">/</span>home<span class="sy0">/</span>user<span class="sy0">/</span>ost4sem<span class="sy0">/</span>siteplan<span class="sy0">/</span>data<span class="sy0">/</span>vector<span class="sy0">/</span>soilsample.shp <span class="re2">output</span>=soilsamples
v.surf.idw <span class="re2">input</span>=soilsamples  <span class="re2">output</span>=soilmapIDW <span class="re2">column</span>=soil_depth <span class="re5">--overwrite</span></pre>

<p>
Topsoil depth map from soil samples interpolated using an Inverse Distance Weighted algorithm.<br/>

<a href="/dokuwiki/lib/exe/detail.php?id=sitedesign%3Asite_fieldsample&amp;media=sitedesign:topsoil_iwd_legend.png" class="media" title="sitedesign:topsoil_iwd_legend.png"><img src="/dokuwiki/lib/exe/fetch.php?w=150&amp;tok=4189f2&amp;media=sitedesign:topsoil_iwd_legend.png" class="media" alt="" width="150" /></a><a href="/dokuwiki/lib/exe/detail.php?id=sitedesign%3Asite_fieldsample&amp;media=sitedesign:soilmap_idw.png" class="media" title="sitedesign:soilmap_idw.png"><img src="/dokuwiki/lib/exe/fetch.php?w=150&amp;tok=9a152c&amp;media=sitedesign:soilmap_idw.png" class="media" alt="" width="150" /></a>
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Mapping&quot;,&quot;hid&quot;:&quot;mapping&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:4,&quot;range&quot;:&quot;2339-&quot;} -->