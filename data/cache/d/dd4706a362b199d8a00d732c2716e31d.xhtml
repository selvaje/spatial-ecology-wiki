
<p>
<a href="/dokuwiki/lib/exe/fetch.php?tok=e5ac2c&amp;media=http%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2Fthumb%2Farchive%2F0%2F02%2F20060803005220%21P_mail.svg%2F120px-P_mail.svg.png" class="media" title="http://upload.wikimedia.org/wikipedia/commons/thumb/archive/0/02/20060803005220!P_mail.svg/120px-P_mail.svg.png"><img src="/dokuwiki/lib/exe/fetch.php?tok=e5ac2c&amp;media=http%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2Fthumb%2Farchive%2F0%2F02%2F20060803005220%21P_mail.svg%2F120px-P_mail.svg.png" class="mediaright" alt="" /></a>
</p>

<h1 class="sectionedit1" id="envelope_models">Envelope Models</h1>
<div class="level1">
<pre class="code">Open Source Tools for Spatial Ecological Modelling (ost4sem)
Copenhagen June-July 2010
Alistair Auffret, Dag Endresen, Torben Wittwer, Zhenlin Yang</pre>

<p>
<br/>

<br/>

</p>

</div>
<!-- EDIT1 SECTION "Envelope Models" [118-308] -->
<h2 class="sectionedit2" id="introduction">INTRODUCTION</h2>
<div class="level2">

</div>
<!-- EDIT2 SECTION "INTRODUCTION" [309-334] -->
<h3 class="sectionedit3" id="project_objectives">Project objectives</h3>
<div class="level3">

<p>
We wanted to download freely available spatial data on climate, land-use and observations of study species, and process them for modeling current and future distributions. We chose to model two butterfly and three plant species.
</p>

<p>
<br/>

</p>

</div>
<!-- EDIT3 SECTION "Project objectives" [335-599] -->
<h3 class="sectionedit4" id="general_framework_of_this_analysis">General framework of this analysis</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li">Ubuntu Linux system in a VmWare virtual machine</div>
</li>
<li class="level1"><div class="li">BASH scripting</div>
</li>
<li class="level1"><div class="li">GDAL libraries</div>
</li>
<li class="level1"><div class="li">GRASS</div>
</li>
<li class="level1"><div class="li">R</div>
</li>
</ul>

<p>
<br/>

</p>

</div>
<!-- EDIT4 SECTION "General framework of this analysis" [600-758] -->
<h2 class="sectionedit5" id="metadata">METADATA</h2>
<div class="level2">

</div>
<!-- EDIT5 SECTION "METADATA" [759-779] -->
<h3 class="sectionedit6" id="raster_data">Raster data</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li">Climate data from WorldClim <a href="http://www.worldclim.org/download" class="urlextern" target="blanc" title="http://www.worldclim.org/download" rel="nofollow noopener">URL</a></div>
</li>
<li class="level1"><div class="li">Land use data from EEA Corine <a href="http://www.eea.europa.eu/data-and-maps" class="urlextern" target="blanc" title="http://www.eea.europa.eu/data-and-maps" rel="nofollow noopener">URL</a>
<br/>
</div>
</li>
</ul>

</div>
<!-- EDIT6 SECTION "Raster data" [780-961] -->
<h3 class="sectionedit7" id="vector_data">Vector Data</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li">Country borders (shapefile from ESRI, etc)</div>
</li>
<li class="level1"><div class="li">Eg. GADM database of Global Administrative Areas <a href="http://www.gadm.org/" class="urlextern" target="blanc" title="http://www.gadm.org/" rel="nofollow noopener">GADM</a>
<br/>
</div>
</li>
</ul>

</div>
<!-- EDIT7 SECTION "Vector Data" [962-1118] -->
<h3 class="sectionedit8" id="text_files_and_tables">Text files and tables</h3>
<div class="level3">

<p>
We will use presence only data downloaded from <a href="http://data.gbif.org" class="urlextern" target="blanc" title="http://data.gbif.org" rel="nofollow noopener">GBIF</a>.
</p>

<p>
Example getting butterfly data from GBIF (wget)
</p>
<ul>
<li class="level1"><div class="li"> <a href="http://data.gbif.org/ws/rest/occurrence/count?originisocountrycode=SE&amp;scientificname=pyrgus+armoricanus&amp;georeferencedonly=true" class="urlextern" target="blanc" title="http://data.gbif.org/ws/rest/occurrence/count?originisocountrycode=SE&amp;scientificname=pyrgus+armoricanus&amp;georeferencedonly=true" rel="nofollow noopener">http://data.gbif.org/ws/rest/occurrence/count?originisocountrycode=SE&amp;scientificname=pyrgus+armoricanus&amp;georeferencedonly=true</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://data.gbif.org/ws/rest/occurrence/list?originisocountrycode=SE&amp;scientificname=pyrgus+armoricanus&amp;georeferencedonly=true" class="urlextern" target="blanc" title="http://data.gbif.org/ws/rest/occurrence/list?originisocountrycode=SE&amp;scientificname=pyrgus+armoricanus&amp;georeferencedonly=true" rel="nofollow noopener">http://data.gbif.org/ws/rest/occurrence/list?originisocountrycode=SE&amp;scientificname=pyrgus+armoricanus&amp;georeferencedonly=true</a></div>
</li>
</ul>

<p>
<br/>

</p>

</div>

<h5 id="plant_data">Plant data</h5>
<div class="level5">

<p>
<a href="/dokuwiki/lib/exe/fetch.php?tok=dce5d2&amp;media=http%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2Fthumb%2Fe%2Feb%2FHopfen3.jpg%2F120px-Hopfen3.jpg" class="media" title="http://upload.wikimedia.org/wikipedia/commons/thumb/e/eb/Hopfen3.jpg/120px-Hopfen3.jpg"><img src="/dokuwiki/lib/exe/fetch.php?tok=dce5d2&amp;media=http%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2Fthumb%2Fe%2Feb%2FHopfen3.jpg%2F120px-Hopfen3.jpg" class="mediaright" title="Hops" alt="Hops" /></a>
</p>
<ul>
<li class="level1"><div class="li"> <em>Crambe maritima</em> L. (sea kale) <a href="http://example.comhttp://en.wikipedia.org/wiki/Crambe_maritima" class="urlextern" target="blanc" title="http://example.comhttp://en.wikipedia.org/wiki/Crambe_maritima" rel="nofollow noopener">Wikipedia</a> <a href="http://data.gbif.org/search/Crambe+maritima" class="urlextern" target="blanc" title="http://data.gbif.org/search/Crambe+maritima" rel="nofollow noopener">GBIF</a></div>
</li>
<li class="level1"><div class="li"> <em>Humulus lupulus</em> L. (hops) <a href="http://en.wikipedia.org/wiki/Humulus" class="urlextern" target="blanc" title="http://en.wikipedia.org/wiki/Humulus" rel="nofollow noopener">Wikipedia</a> <a href="http://data.gbif.org/search/Humulus+lupulus" class="urlextern" target="blanc" title="http://data.gbif.org/search/Humulus+lupulus" rel="nofollow noopener">GBIF</a></div>
</li>
<li class="level1"><div class="li"> <em>Sedum acre</em> L. (Biting Stonecrop) <a href="http://en.wikipedia.org/wiki/Sedum_acre" class="urlextern" target="blanc" title="http://en.wikipedia.org/wiki/Sedum_acre" rel="nofollow noopener">Wikipedia</a> <a href="http://data.gbif.org/search/Sedum+acre" class="urlextern" target="blanc" title="http://data.gbif.org/search/Sedum+acre" rel="nofollow noopener">GBIF</a></div>
</li>
</ul>

<p>
<br/>

</p>

</div>

<h5 id="butterfly_data">Butterfly data</h5>
<div class="level5">

<p>
<a href="/dokuwiki/lib/exe/fetch.php?tok=db546b&amp;media=http%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2Fthumb%2F3%2F39%2FVanessa_January_2008-2.jpg%2F120px-Vanessa_January_2008-2.jpg" class="media" title="http://upload.wikimedia.org/wikipedia/commons/thumb/3/39/Vanessa_January_2008-2.jpg/120px-Vanessa_January_2008-2.jpg"><img src="/dokuwiki/lib/exe/fetch.php?tok=db546b&amp;media=http%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2Fthumb%2F3%2F39%2FVanessa_January_2008-2.jpg%2F120px-Vanessa_January_2008-2.jpg" class="mediaright" title="Red Admiral" alt="Red Admiral" /></a>
</p>
<ul>
<li class="level1"><div class="li"> <em>Scolitantides orion</em> Hübner (Chequered Blue Butterfly) <a href="http://en.wikipedia.org/wiki/Scolitantides_orion" class="urlextern" target="blanc" title="http://en.wikipedia.org/wiki/Scolitantides_orion" rel="nofollow noopener">Wikipedia</a> <a href="http://data.gbif.org/search/Scolitantides+orion" class="urlextern" target="blanc" title="http://data.gbif.org/search/Scolitantides+orion" rel="nofollow noopener">GBIF</a></div>
</li>
<li class="level1"><div class="li"> <em>Vanessa atalanta</em> L. (Red Admiral) <a href="http://en.wikipedia.org/wiki/Vanessa_atalanta" class="urlextern" target="blanc" title="http://en.wikipedia.org/wiki/Vanessa_atalanta" rel="nofollow noopener">Wikipedia</a> <a href="http://data.gbif.org/search/Vanessa+atalanta" class="urlextern" target="blanc" title="http://data.gbif.org/search/Vanessa+atalanta" rel="nofollow noopener">GBIF</a></div>
</li>
</ul>

<p>
<br/>

</p>

</div>
<!-- EDIT8 SECTION "Text files and tables" [1119-2613] -->
<h2 class="sectionedit9" id="method">METHOD</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> Step 1 :: Species occurrence data (point, longitude, latitude input)</div>
</li>
<li class="level1"><div class="li"> Step 1a: Get species occurrence point data (from GBIF and other sources) with WGET (<a href="http://data.gbif.org" class="urlextern" target="blanc" title="http://data.gbif.org" rel="nofollow noopener">http://data.gbif.org</a>)</div>
</li>
<li class="level1"><div class="li"> Step 1b: Convert XML species data to text with xmlstarlet (<a href="http://dave.ecoforge.net/wiki/HowTo/GbifRest" class="urlextern" target="blanc" title="http://dave.ecoforge.net/wiki/HowTo/GbifRest" rel="nofollow noopener">http://dave.ecoforge.net/wiki/HowTo/GbifRest</a>)</div>
</li>
<li class="level1"><div class="li"> Step 1b: Prepare source point data with AWK</div>
</li>
<li class="level1"><div class="li"> Step 1c: Import occurrence data to GRASS</div>
</li>
</ul>

<p>
–
</p>
<ul>
<li class="level1"><div class="li"> Step 2 :: Grid data (raster)</div>
</li>
<li class="level1"><div class="li"> Step 2a: Get grid data, climate data, land use, etc</div>
</li>
<li class="level1"><div class="li"> Step 2b: Prepare grid data with AWK (?)</div>
</li>
<li class="level1"><div class="li"> Step 2c: Import grid data to GRASS</div>
</li>
</ul>

<p>
–
</p>
<ul>
<li class="level1"><div class="li"> Step 3 :: Envelope modeling, randomForest, maxent, glm, gam, etc…(?) with R (GRASS?)</div>
</li>
<li class="level1"><div class="li"> Step 3a: calibrate envelope model (area Europe) from the input points (for each species)</div>
</li>
<li class="level1"><div class="li"> Step 3b: apply the model (in Sweden) to generate a species distribution prediction</div>
</li>
</ul>

<p>
–
</p>

<p>
<br/>

<br/>

</p>

</div>
<!-- EDIT9 SECTION "METHOD" [2614-3484] -->
<h2 class="sectionedit10" id="data_import">DATA IMPORT</h2>
<div class="level2">
<pre class="code bash"><span class="co0">#!/bin/bash</span>
<span class="co0">#</span>
<span class="co0"># Copenhagen June 2010, ost4sem, unidk2010</span>
<span class="co0">#</span>
<span class="co0"># Title: Envelope models</span>
<span class="co0"># Authors: Alistair Auffret, Dag Endresen, Torben Wittwer, Zhenlin Yang</span>
<span class="co0"># Script: envmod_data.sh</span>
<span class="co0"># Description: Species distribution data for envelope modeling</span>
<span class="co0"># Step 1 :: Species occurrence data (point, lon, lat input)</span>
<span class="co0">#</span>
&nbsp;
&nbsp;
<span class="co0">#######################</span>
<span class="co0"># Home directory folder</span>
<span class="re2">home_dir</span>=<span class="st0">&quot;~/ost4sem/project/unidk2010/envmod/&quot;</span>
<span class="kw3">cd</span> ~<span class="sy0">/</span>ost4sem<span class="sy0">/</span>project<span class="sy0">/</span>unidk2010<span class="sy0">/</span>envmod<span class="sy0">/</span>
&nbsp;
&nbsp;
<span class="co0">###################################################</span>
<span class="co0"># Install tofrodos for import of windows text files</span>
<span class="kw2">sudo</span> <span class="kw2">apt-get install</span> tofrodos
&nbsp;
&nbsp;
<span class="co0">###################################</span>
<span class="co0"># Create directory folder structure</span>
<span class="co0"># -a file exists, -f file exists, -f file exists and is regular file, -d directory exists</span>
<span class="co0">#</span>
<span class="kw1">for</span> folder_name <span class="kw1">in</span> input output sh_script grassdb input<span class="sy0">/</span>species input<span class="sy0">/</span>worldclim input<span class="sy0">/</span>corine input<span class="sy0">/</span>sjv; <span class="kw1">do</span>
 <span class="kw1">if</span> <span class="br0">&#91;</span> <span class="re5">-d</span> <span class="re1">$folder_name</span> <span class="br0">&#93;</span>; <span class="kw1">then</span> <span class="br0">&#123;</span> <span class="kw3">echo</span> <span class="st0">&quot;folder <span class="es2">$folder_name</span> exists&quot;</span>; <span class="br0">&#125;</span> <span class="kw1">else</span> <span class="br0">&#123;</span> <span class="kw3">echo</span> <span class="st0">&quot;folder <span class="es2">$folder_name</span> does NOT exists&quot;</span>; <span class="kw2">mkdir</span> <span class="re1">$folder_name</span>; <span class="br0">&#125;</span> <span class="kw1">fi</span>
<span class="kw1">done</span>
<span class="co0">#</span>
<span class="kw2">ls</span> <span class="re5">-lR</span>
<span class="kw2">ls</span> <span class="re5">-l</span> input
&nbsp;
&nbsp;
<span class="co0">#####################################################</span>
<span class="co0"># Species list (we will use one of the options below)</span>
<span class="co0">#</span>
<span class="co0"># Species list in a variable</span>
<span class="re2">species_list</span>=<span class="st0">&quot;vanessa+atalanta humulus+lupulus scolitantides+orion sedum+acre crambe+maritima&quot;</span>
<span class="co0">#</span>
<span class="co0"># Species list in a text file</span>
<span class="kw3">echo</span> <span class="st0">&quot;pyrgus+armoricanus&quot;</span> <span class="st0">&quot;crambe+maritima&quot;</span> <span class="sy0">&gt;</span> <span class="st0">&quot;input/species/species_list.txt&quot;</span>
<span class="kw2">cat</span> input<span class="sy0">/</span>species<span class="sy0">/</span>species_list.txt
<span class="co0">#</span>
<span class="co0"># Read species list from text file to variable</span>
<span class="re2">species_list</span>=<span class="sy0">`</span><span class="kw2">cat</span> input<span class="sy0">/</span>species<span class="sy0">/</span>species_list.txt<span class="sy0">`</span>
<span class="kw3">echo</span> <span class="re1">$species_list</span>
<span class="co0">#</span>
<span class="co0"># Test loop of species list</span>
<span class="kw1">for</span> species <span class="kw1">in</span> <span class="re1">$species_list</span>; <span class="kw1">do</span> <span class="kw3">echo</span> <span class="re5">-e</span> <span class="st0">&quot;Species :: &quot;</span><span class="re1">$species</span><span class="st0">&quot; <span class="es1">\n</span>&quot;</span>; <span class="kw1">done</span>
&nbsp;
<span class="co0"># download European country iso list</span>
<span class="kw2">wget</span> <span class="re5">-O</span> .<span class="sy0">/</span>input<span class="sy0">/</span>isocountry.txt <span class="st0">&quot;http://www.maxmind.com/eu_country_list.txt&quot;</span>
&nbsp;
&nbsp;
<span class="co0">######################################################</span>
<span class="co0"># Download species occurrence data from GBIF with wget</span>
<span class="co0"># http://data.gbif.org/ws/rest/occurrence</span>
<span class="co0"># http://wiki.gbif.org/dadiwiki/wikka.php?wakka=DeveloperAPIs</span>
<span class="co0"># http://wwwdev.ngb.se/portal/files/cwr/CWR-Portal-Technical-Description.pdf</span>
<span class="co0">#</span>
<span class="co0"># originregioncode=EEU,NEU,SEU,WEU // EEU-Eastern Europe,NEU-Northern Europe,SEU-Southern Europe,WEU-Western Europe</span>
<span class="co0"># originisocountrycode=SE // Occurrences from Sweden</span>
<span class="co0">#</span>
<span class="co0"># wget -O outputfile; file to print some file information</span>
<span class="co0"># lynx http://data.gbif.org/ws/rest/occurrence/count?originisocountrycode=SE&amp;scientificname=pyrgus+armoricanus&amp;georeferencedonly=false</span>
<span class="co0"># wget -O ./input/species/test.xml &quot;http://data.gbif.org/ws/rest/occurrence/list?originisocountrycode=SE&amp;scientificname=pyrgus+armoricanus&amp;georeferencedonly=true&quot;</span>
<span class="co0">#</span>
<span class="co0"># loop species</span>
&nbsp;
&nbsp;
<span class="co0">#########################</span>
<span class="co0"># download species for each european country</span>
<span class="co0"># xmlstarlet to read XML</span>
<span class="co0"># sudo apt-get install xmlstarlet # to install xmlstarlet on Ubuntu</span>
<span class="co0"># Convert XML to text with xmlstarlet see: http://dave.ecoforge.net/wiki/HowTo/GbifRest</span>
<span class="co0">#</span>
<span class="kw1">for</span> country <span class="kw1">in</span> <span class="sy0">`</span><span class="kw2">awk</span> <span class="st_h">'{if (NR&gt;3) print $1}'</span> .<span class="sy0">/</span>input<span class="sy0">/</span>isocountry.txt<span class="sy0">`</span>; <span class="kw1">do</span>
  <span class="kw1">for</span> species <span class="kw1">in</span> <span class="re1">$species_list</span>; <span class="kw1">do</span>
    <span class="kw3">echo</span> <span class="re5">-e</span> <span class="st0">&quot;Species :: &quot;</span><span class="re1">$species</span><span class="st0">&quot;<span class="es1">\n</span>&quot;</span>;
    <span class="kw2">wget</span> <span class="re5">-O</span> <span class="st0">&quot;./input/species/&quot;</span><span class="re1">$species</span><span class="st0">&quot;_&quot;</span><span class="re1">$country</span><span class="st0">&quot;.xml&quot;</span> <span class="st0">&quot;http://data.gbif.org/ws/rest/occurrence/list?originisocountrycode=<span class="es2">$country</span>&amp;scientificname=&quot;</span><span class="re1">$species</span><span class="st0">&quot;&amp;georeferencedonly=true&amp;mode=processed&quot;</span>
    <span class="co0"># NB! for species occurrences per country above 1 000 hits we need to make paging</span>
    <span class="co0"># Check the XML response if there are more than the maximum returned 1 000 records</span>
    <span class="co0"># Check if the XML element gbif:summary have the attribute next=1000</span>
    <span class="co0"># http://data.gbif.org/ws/rest/occurrence/list?startindex=1000&amp;... (for page two)</span>
    <span class="co0"># while loop until no more next page would be a solution</span>
  xmlstarlet sel <span class="re5">-T</span> \
    <span class="re5">-N</span> <span class="re2">tn</span>=<span class="st0">&quot;http://rs.tdwg.org/ontology/voc/TaxonName#&quot;</span> \
    <span class="re5">-N</span> <span class="re2">to</span>=<span class="st0">&quot;http://rs.tdwg.org/ontology/voc/TaxonOccurrence#&quot;</span> \
    <span class="re5">-t</span> <span class="re5">-m</span> <span class="st0">&quot;//to:TaxonOccurrence&quot;</span> \
    <span class="re5">-v</span> <span class="st0">&quot;concat(.//tn:nameComplete,';',to:decimalLongitude,';',to:decimalLatitude)&quot;</span> \
    <span class="re5">-n</span> \
    .<span class="sy0">/</span>input<span class="sy0">/</span>species<span class="sy0">/</span><span class="st0">&quot;<span class="es2">$species</span>&quot;</span>_<span class="st0">&quot;<span class="es2">$country</span>&quot;</span>.xml <span class="sy0">&gt;</span> .<span class="sy0">/</span>input<span class="sy0">/</span>species<span class="sy0">/</span><span class="st0">&quot;<span class="es2">$species</span>&quot;</span>_<span class="st0">&quot;<span class="es2">$country</span>&quot;</span>.txt
  <span class="kw1">done</span>
<span class="kw1">done</span>
&nbsp;
<span class="co0">#concatenate species occurrence data from all countries</span>
<span class="kw1">for</span> species <span class="kw1">in</span> <span class="re1">$species_list</span>; <span class="kw1">do</span>
  <span class="kw2">cat</span> .<span class="sy0">/</span>input<span class="sy0">/</span>species<span class="sy0">/</span><span class="st0">&quot;<span class="es2">$species</span>&quot;</span>_<span class="sy0">*</span>.txt <span class="sy0">&gt;</span> .<span class="sy0">/</span>input<span class="sy0">/</span>species<span class="sy0">/</span><span class="st0">&quot;<span class="es2">$species</span>&quot;</span>.txt
<span class="kw1">done</span>
&nbsp;
<span class="co0">#make nicer species list</span>
<span class="kw1">for</span> species <span class="kw1">in</span> <span class="re1">$species_list</span>; <span class="kw1">do</span>
  <span class="re2">specname</span>=<span class="sy0">`</span><span class="kw3">echo</span> <span class="st0">&quot;<span class="es2">$species</span>&quot;</span><span class="sy0">`</span>
  <span class="kw2">cat</span> .<span class="sy0">/</span>input<span class="sy0">/</span>species<span class="sy0">/</span><span class="st0">&quot;<span class="es2">$species</span>&quot;</span>.txt <span class="sy0">|</span> <span class="kw2">tr</span> <span class="br0">&#91;</span>,<span class="br0">&#93;</span> <span class="br0">&#91;</span>.<span class="br0">&#93;</span> <span class="sy0">|</span> <span class="kw2">awk</span> <span class="re5">-v</span> <span class="re2">i</span>=<span class="st0">&quot;<span class="es2">$specname</span>&quot;</span> <span class="st_h">'BEGIN{FS=&quot;;&quot;};{print i, &quot;,&quot;, $2,&quot;,&quot;,$3}'</span> <span class="sy0">|</span> <span class="kw2">tr</span> <span class="re5">-d</span> <span class="br0">&#91;</span>:blank:<span class="br0">&#93;</span> <span class="sy0">|</span> <span class="kw2">tr</span> <span class="st0">&quot;+&quot;</span> <span class="st0">&quot; &quot;</span> <span class="sy0">&gt;</span> .<span class="sy0">/</span>input<span class="sy0">/</span>species<span class="sy0">/</span>temp.txt
  <span class="kw2">cat</span> .<span class="sy0">/</span>input<span class="sy0">/</span>species<span class="sy0">/</span>temp.txt <span class="sy0">&gt;</span> .<span class="sy0">/</span>input<span class="sy0">/</span>species<span class="sy0">/</span><span class="st0">&quot;<span class="es2">$species</span>&quot;</span>.txt
<span class="kw1">done</span>
<span class="kw2">rm</span> .<span class="sy0">/</span>input<span class="sy0">/</span>species<span class="sy0">/</span>temp.txt
&nbsp;
<span class="co0"># make some nice col names for each species distribution file</span>
<span class="kw1">for</span> spec <span class="kw1">in</span> <span class="re1">$species_list</span>; <span class="kw1">do</span>
  <span class="kw2">awk</span> <span class="st_h">'BEGIN { print &quot;species,long,lat&quot;}'</span> <span class="sy0">&gt;</span> .<span class="sy0">/</span>input<span class="sy0">/</span>species<span class="sy0">/</span>temp.txt
  <span class="kw2">awk</span> <span class="st_h">'{print $0}'</span> .<span class="sy0">/</span>input<span class="sy0">/</span>species<span class="sy0">/</span><span class="re1">$spec</span>.txt <span class="sy0">&gt;&gt;</span> .<span class="sy0">/</span>input<span class="sy0">/</span>species<span class="sy0">/</span>temp.txt
  <span class="kw2">cat</span> .<span class="sy0">/</span>input<span class="sy0">/</span>species<span class="sy0">/</span>temp.txt <span class="sy0">&gt;</span> .<span class="sy0">/</span>input<span class="sy0">/</span>species<span class="sy0">/</span><span class="re1">$spec</span>.txt
<span class="kw1">done</span>
<span class="kw2">rm</span> .<span class="sy0">/</span>input<span class="sy0">/</span>species<span class="sy0">/</span>temp.txt
&nbsp;
<span class="co0">#</span>
<span class="kw2">ls</span> <span class="re5">-l</span> input<span class="sy0">/</span>species
<span class="kw2">head</span> <span class="re5">-40</span> .<span class="sy0">/</span>input<span class="sy0">/</span>species<span class="sy0">/</span><span class="re1">$species</span>.xml
<span class="kw2">head</span> <span class="re5">-10</span> .<span class="sy0">/</span>input<span class="sy0">/</span>species<span class="sy0">/</span><span class="re1">$species</span>.txt
&nbsp;
&nbsp;
<span class="co0">#########################</span>
<span class="co0"># Download WorldClim data</span>
<span class="co0"># http://www.worldclim.org/download</span>
<span class="co0"># Current climate (there is also future and some past climate)</span>
<span class="co0"># wget -P prefix directory save files to</span>
<span class="co0">#</span>
<span class="kw1">for</span> layer <span class="kw1">in</span> tmin tmax tmean prec bio alt; <span class="kw1">do</span> <span class="co0"># tmin tmax tmean prec bio alt</span>
 <span class="kw1">for</span> resolution <span class="kw1">in</span> 10m; <span class="kw1">do</span> <span class="co0"># 30s, 2-5m, 5m, 10m (NB! finer resolution files are LARGE)</span>
  <span class="kw2">wget</span> <span class="re5">-P</span> <span class="st0">&quot;./input/worldclim/current/wc_&quot;</span><span class="re1">$resolution</span> <span class="st0">&quot;http://r-gis.org/climate/worldclim1_4/grid/cur/&quot;</span><span class="re1">$layer</span><span class="st0">&quot;_&quot;</span><span class="re1">$resolution</span><span class="st0">&quot;_bil.zip&quot;</span>
  <span class="kw2">sleep</span> <span class="nu0">2</span> <span class="co0"># wait 5 seconds between wget sessions to avoid overloading worldclim</span>
 <span class="kw1">done</span>
<span class="kw1">done</span>
<span class="kw2">ls</span> <span class="re5">-l</span> input<span class="sy0">/</span>worldclim<span class="sy0">/</span>current
<span class="co0">#</span>
<span class="co0"># Future climate (do we plan to need this...?)</span>
<span class="kw1">for</span> layer <span class="kw1">in</span> tmin tmax; <span class="kw1">do</span> <span class="co0"># tmin tmax tmean prec bio alt</span>
 <span class="kw1">for</span> resolution <span class="kw1">in</span> 10m; <span class="kw1">do</span> <span class="co0"># 30s, 2-5m, 5m, 10m (NB! finer resolution files are LARGE)</span>
  <span class="kw1">for</span> model <span class="kw1">in</span> CCCMA; <span class="kw1">do</span> <span class="co0"># CCCMA, HADCM3, CSIRO</span>
   <span class="kw1">for</span> scenario <span class="kw1">in</span> A2a; <span class="kw1">do</span> <span class="co0"># A2a, B2a</span>
    <span class="kw1">for</span> year <span class="kw1">in</span> <span class="nu0">2020</span>; <span class="kw1">do</span> <span class="co0"># 2020, 2050, 2080</span>
     <span class="co0">#http://r-gis.org/climate/worldclim1_4/grid/fut/IPPC3/CCCMA/wc_10m_CCCMA_A2a_2020_tmin.zip</span>
     <span class="kw2">wget</span> <span class="re5">-P</span> .<span class="sy0">/</span>input<span class="sy0">/</span>worldclim<span class="sy0">/</span>future <span class="st0">&quot;http://r-gis.org/climate/worldclim1_4/grid/fut/IPPC3/&quot;</span><span class="re1">$model</span><span class="st0">&quot;/wc_&quot;</span><span class="re1">$resolution</span><span class="st0">&quot;_&quot;</span><span class="re1">$model</span><span class="st0">&quot;_&quot;</span><span class="re1">$scenario</span><span class="st0">&quot;_&quot;</span><span class="re1">$year</span><span class="st0">&quot;_&quot;</span><span class="re1">$layer</span><span class="st0">&quot;.zip&quot;</span>
     <span class="kw2">sleep</span> <span class="nu0">5</span> <span class="co0"># wait 5 seconds between wget sessions to avoid overloading worldclim</span>
    <span class="kw1">done</span>
   <span class="kw1">done</span>
  <span class="kw1">done</span>
 <span class="kw1">done</span>
<span class="kw1">done</span>
<span class="kw2">ls</span> <span class="re5">-l</span> .<span class="sy0">/</span>input<span class="sy0">/</span>worldclim<span class="sy0">/</span>future
&nbsp;
&nbsp;
<span class="co0">#####################################</span>
<span class="co0"># Download CORINE Land cover from EEA</span>
<span class="co0"># http://www.eea.europa.eu/data-and-maps/data</span>
<span class="co0"># Corine Land Cover (clc) 2006 raster data, resolution 250 m (g250_06.zip, ZIP archive 26.76 MB)</span>
<span class="co0"># /data-and-maps/data/ga-downloads/SH04UZP80M/corine-land-cover-2006-raster/g250_06.zip</span>
<span class="co0"># Legends :: clc_legend.csv (Plain Text  3.88 KB) </span>
<span class="co0"># /data-and-maps/data/ga-downloads/SH04UZP80M/corine-land-cover-2006-raster/clc_legend.csv</span>
<span class="co0">#</span>
<span class="kw2">wget</span> <span class="re5">-O</span> .<span class="sy0">/</span>input<span class="sy0">/</span>corine<span class="sy0">/</span>clc_g250_06.zip <span class="st0">&quot;http://www.eea.europa.eu/data-and-maps/data/corine-land-cover-2006-raster/clc-2006-v13-250m/g250_06.zip/at_download/file&quot;</span>
&nbsp;
<span class="co0"># unzip data</span>
<span class="kw2">unzip</span> <span class="re5">-d</span> .<span class="sy0">/</span>input<span class="sy0">/</span>corine<span class="sy0">/</span>clc .<span class="sy0">/</span>input<span class="sy0">/</span>corine<span class="sy0">/</span>clc_g250_06.zip
<span class="kw2">ls</span> <span class="re5">-l</span> .<span class="sy0">/</span>input<span class="sy0">/</span>corine
<span class="kw2">ls</span> <span class="re5">-l</span> .<span class="sy0">/</span>input<span class="sy0">/</span>corine<span class="sy0">/</span>clc</pre>

<p>
<br/>

</p>

<p>
<a href="/dokuwiki/lib/exe/fetch.php?tok=daba6c&amp;media=http%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2F0%2F06%2FServiceconf.png" class="media" title="http://upload.wikimedia.org/wikipedia/commons/0/06/Serviceconf.png"><img src="/dokuwiki/lib/exe/fetch.php?tok=daba6c&amp;media=http%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2F0%2F06%2FServiceconf.png" class="mediacenter" alt="" /></a>
<br/>

</p>

</div>
<!-- EDIT10 SECTION "DATA IMPORT" [3485-10595] -->
<h2 class="sectionedit11" id="data_processing_with_downloaded_worldclim_and_corine_data">DATA PROCESSING with downloaded WORLDCLIM and CORINE data</h2>
<div class="level2">

<p>
<br/>

</p>
<pre class="code bash"><span class="co0">#!/bin/bash</span>
<span class="co0">#</span>
<span class="co0"># Copenhagen June 2010, ost4sem, unidk2010</span>
<span class="co0">#</span>
<span class="co0"># Title: Envelope models</span>
<span class="co0"># Authors: Alistair Auffret, Dag Endresen, Torben Wittwer, Zhenlin Yang</span>
<span class="co0"># Description: Species distribution from envelope modeling</span>
<span class="co0"># Harmonize the projection and grid for the raster data (worldclim and corine)</span>
<span class="co0"># Use gdalinfo and gdalwarp for projection</span>
<span class="co0">#</span>
&nbsp;
<span class="co0">#######################</span>
<span class="co0"># Home directory folder</span>
<span class="re2">home_dir</span>=<span class="st0">&quot;~/ost4sem/project/unidk2010/envmod&quot;</span>
<span class="kw3">cd</span> ~<span class="sy0">/</span>ost4sem<span class="sy0">/</span>project<span class="sy0">/</span>unidk2010<span class="sy0">/</span>envmod
&nbsp;
&nbsp;
<span class="co0">################</span>
<span class="co0"># GDAL, gdalinfo</span>
<span class="co0">#gdalinfo $home_dir&quot;/input/worldclim/current/wc_5m_10km/alt.bil&quot;</span>
gdalinfo <span class="st0">&quot;./input/worldclim/current/wc_5m/alt.bil&quot;</span>
gdalinfo <span class="st0">&quot;./input/worldclim/current/wc_5m/bio1.bil&quot;</span>
gdalinfo <span class="re5">-stats</span> <span class="st0">&quot;./input/worldclim/current/wc_5m_10km_esri/alt/alt&quot;</span>
&nbsp;
&nbsp;
<span class="co0">###############################################</span>
<span class="co0"># Issues of importing the wc bil grids in GRASS</span>
<span class="co0">#</span>
<span class="co0"># ESRI software assumes that the data files (.bil) do not have negative values.</span>
<span class="co0"># These values (x) are replaced by (65535 + x); E.g., -10 becomes 65525</span>
<span class="co0"># Also the nodata value of -9999 is not recognized. (becomes 65535-999=55537)</span>
<span class="co0"># gdal, used by GRASS GIS to import the data, seems to make the same assumption</span>
<span class="co0"># 16-bit (2 byte) integer, unsigned representation, values between 0 and 65535</span>
<span class="co0"># Signed representation however, possible values range from −32768 to 32767</span>
<span class="co0"># Worldclim data is signed, but ESRI and gdal assume grid values are unsigned</span>
<span class="co0"># You need to do is to reclass all values &gt; 23767 as value-(66536)</span>
<span class="co0"># Eg: &gt; r.mapcalc &quot;tmin_corrected=if(tmin&gt;23767,tmin-66536,tmin)&quot;</span>
<span class="co0"># http://pvanb.wordpress.com/2010/02/06/importing-worldclim-climate-bil-datalayers-in-grass-gis/</span>
<span class="co0">#</span>
<span class="co0"># You can convert from bil to a different format like geotiff</span>
<span class="co0">#</span>
<span class="co0"># To import Worldclim data, the following line has to be added to each .hdr file:</span>
<span class="co0"># PIXELTYPE SIGNEDINT</span>
<span class="co0">#</span>
<span class="kw3">echo</span> <span class="re5">-e</span> <span class="st0">&quot;PIXELTYPE     SIGNEDINT<span class="es1">\r</span>&quot;</span> <span class="sy0">&gt;</span> .<span class="sy0">/</span>temp<span class="sy0">/</span>pixeltype.txt
<span class="kw1">for</span> hdr_file <span class="kw1">in</span> <span class="sy0">`</span><span class="kw2">ls</span> .<span class="sy0">/</span>input<span class="sy0">/</span>worldclim<span class="sy0">/</span>current<span class="sy0">/</span>wc_5m <span class="sy0">|</span> <span class="kw2">grep</span> .hdr<span class="sy0">`</span>; <span class="kw1">do</span>
 <span class="re2">hdr_pt</span>=<span class="co1">${hdr_file%.*}</span><span class="st0">&quot;_pt.hdr&quot;</span> <span class="co0">## cat two files together as concatenate cannot output to the same file</span>
 <span class="kw3">echo</span> <span class="st0">&quot;hdr_file :: &quot;</span><span class="re1">$hdr_file</span><span class="st0">&quot; :: hdr_pt :: &quot;</span><span class="re1">$hdr_pt</span>;
 <span class="kw2">cat</span> .<span class="sy0">/</span>temp<span class="sy0">/</span>pixeltype.txt .<span class="sy0">/</span>input<span class="sy0">/</span>worldclim<span class="sy0">/</span>current<span class="sy0">/</span>wc_5m<span class="sy0">/</span><span class="re1">$hdr_file</span> <span class="sy0">&gt;</span> .<span class="sy0">/</span>input<span class="sy0">/</span>worldclim<span class="sy0">/</span>current<span class="sy0">/</span>wc_5m<span class="sy0">/</span><span class="re1">$hdr_pt</span>;
 <span class="kw2">mv</span> .<span class="sy0">/</span>input<span class="sy0">/</span>worldclim<span class="sy0">/</span>current<span class="sy0">/</span>wc_5m<span class="sy0">/</span><span class="re1">$hdr_pt</span> .<span class="sy0">/</span>input<span class="sy0">/</span>worldclim<span class="sy0">/</span>current<span class="sy0">/</span>wc_5m<span class="sy0">/</span><span class="re1">$hdr_file</span>
<span class="co0"># head -3 ./input/worldclim/current/wc_5m/$hdr_file;</span>
<span class="kw1">done</span>
&nbsp;
&nbsp;
<span class="co0">###########################################</span>
<span class="co0">#change datum/projection of corine landcover to WGS84</span>
gdalwarp -t_srs EPSG:<span class="nu0">4326</span> g250_06.tif <span class="re1">$home</span><span class="sy0">/</span>input<span class="sy0">/</span>corine<span class="sy0">/</span>g250_06_WGS84.tif
<span class="kw2">cat</span> clc_legend_qgis.txt <span class="co0">#legends</span>
&nbsp;
<span class="co0">#compress tif-file</span>
gdal_translate <span class="re5">-co</span> <span class="st0">&quot;COMPRESS=LZW&quot;</span> g250_06_WGS84.tif temp.tif
<span class="kw2">mv</span> temp.tif g250_06_WGS84.tif
&nbsp;
&nbsp;
<span class="kw3">cd</span> ~<span class="sy0">/</span>ost4sem<span class="sy0">/</span>project<span class="sy0">/</span>unidk2010<span class="sy0">/</span>envmod<span class="sy0">/</span>
<span class="co0">#create Grass GIS DB, Location and Mapset</span>
<span class="kw2">mkdir</span> Grassdb
<span class="kw3">cd</span> ~<span class="sy0">/</span>ost4sem<span class="sy0">/</span>project<span class="sy0">/</span>unidk2010<span class="sy0">/</span>envmod<span class="sy0">/</span>Grassdb
<span class="kw2">ln</span> <span class="re5">-s</span>  <span class="sy0">/</span>home<span class="sy0">/</span>user<span class="sy0">/</span>ost4sem<span class="sy0">/</span>project<span class="sy0">/</span>unidk2010<span class="sy0">/</span>envmod<span class="sy0">/</span>input<span class="sy0">/</span>corine<span class="sy0">/</span>g250_06_WGS84.tif .
&nbsp;
<span class="co0"># use script to create a grass location for the project</span>
<span class="kw2">bash</span> ~<span class="sy0">/</span>ost4sem<span class="sy0">/</span>project<span class="sy0">/</span>unidk2010<span class="sy0">/</span>envmod<span class="sy0">/</span>sh_script<span class="sy0">/</span>create_location.sh g250_06_WGS84.tif europe ~<span class="sy0">/</span>ost4sem<span class="sy0">/</span>project<span class="sy0">/</span>unidk2010<span class="sy0">/</span>envmod<span class="sy0">/</span>Grassdb
&nbsp;
<span class="co0">#start working in GRASS GIS</span>
grass <span class="re5">-text</span> <span class="sy0">/</span>home<span class="sy0">/</span>user<span class="sy0">/</span>ost4sem<span class="sy0">/</span>project<span class="sy0">/</span>unidk2010<span class="sy0">/</span>envmod<span class="sy0">/</span>Grassdb<span class="sy0">/</span>europe<span class="sy0">/</span>PERMANENT
g.mapset <span class="re5">-c</span> <span class="re2">mapset</span>=env_mod_mapset
g.copy <span class="re2">rast</span>=g250_06_WGS84<span class="sy0">@</span>PERMANENT,g250_06_WGS84
&nbsp;
<span class="co0">#set region </span>
g.region <span class="re2">n</span>=<span class="nu0">72.8</span> <span class="re2">s</span>=<span class="nu0">33.55</span> <span class="re2">w</span>=-<span class="nu0">25.1</span> <span class="re2">e</span>=<span class="nu0">45.9</span> <span class="re2">res</span>=<span class="nu0">0</span>:05 <span class="re2">save</span>=eu <span class="re5">--overwrite</span>
&nbsp;
<span class="co0">#import map from folder</span>
r.in.gdal <span class="re5">-o</span> <span class="re2">input</span>=~<span class="sy0">/</span>ost4sem<span class="sy0">/</span>project<span class="sy0">/</span>unidk2010<span class="sy0">/</span>envmod<span class="sy0">/</span>input<span class="sy0">/</span>worldclim<span class="sy0">/</span>current<span class="sy0">/</span>wc_5m<span class="sy0">/</span>tmean7.bil <span class="re2">output</span>=tmeanJuly <span class="re5">--o</span>
<span class="co0">#cut extent of map to europe</span>
r.mapcalc tmeanJulyEU = tmeanJuly
&nbsp;
<span class="co0">#put it in a loop to load all months </span>
<span class="kw1">for</span> month <span class="kw1">in</span> <span class="sy0">*</span>.bil; <span class="kw1">do</span> <span class="co0">## where the extension is .bil</span>
r.in.gdal <span class="re5">-o</span> <span class="re2">input</span>=<span class="re1">$month</span> <span class="re2">output</span>=<span class="sy0">`</span><span class="kw2">basename</span> <span class="re1">$month</span> .bil<span class="sy0">`</span> <span class="re5">--o</span> <span class="co0">## open the file, using basename to lose the extension for the grass file</span>
r.mapcalc <span class="sy0">`</span><span class="kw2">basename</span> <span class="re1">$month</span> .bil<span class="sy0">`</span><span class="st0">&quot;EU&quot;</span> = <span class="sy0">`</span><span class="kw2">basename</span> <span class="re1">$month</span> .bil<span class="sy0">`</span> <span class="co0">## cut the map to europe</span>
<span class="kw1">done</span>
&nbsp;
<span class="co0">## cut corine data (and give it a better name)</span>
r.mapcalc corineEU = g250_06_WGS84</pre>

<p>
<br/>

</p>

</div>
<!-- EDIT11 SECTION "DATA PROCESSING with downloaded WORLDCLIM and CORINE data" [10596-14648] -->
<h1 class="sectionedit12" id="data_processing_with_predictor_data_from_stefano">Data Processing with Predictor data from Stefano</h1>
<div class="level1">

<p>
Due to time restrictions (one week student project) on downloading and processing the large 1 km (30 sec) environment grids from Worldclim, we received another fine resolution (1 km) environment dataset from Stefano Casalegno. This dataset includes processed data from Worldclim, as well as data environment data from other sources. A description of the many different layers are included below as a PNG image.
</p>

</div>
<!-- EDIT12 SECTION "Data Processing with Predictor data from Stefano" [14649-15124] -->
<h3 class="sectionedit13" id="predictor_variables">Predictor variables</h3>
<div class="level3">

<p>
<a href="/dokuwiki/lib/exe/detail.php?id=wikidk%3Adk10envelop&amp;media=wikidk:list_explaining_climate_data_codes.png" class="media" title="wikidk:list_explaining_climate_data_codes.png"><img src="/dokuwiki/lib/exe/fetch.php?w=600&amp;tok=015f5f&amp;media=wikidk:list_explaining_climate_data_codes.png" class="media" title="Predictor variables" alt="Predictor variables" width="600" /></a>
</p>

</div>
<!-- EDIT13 SECTION "Predictor variables" [15125-15230] -->
<h3 class="sectionedit14" id="grass">GRASS</h3>
<div class="level3">
<pre class="code bash"><span class="co0">#!/bin/bash</span>
<span class="co0">#</span>
<span class="co0"># Copenhagen June 2010, ost4sem, unidk2010</span>
<span class="co0">#</span>
<span class="co0"># Title: Envelope models</span>
<span class="co0"># Authors: Alistair Auffret, Dag Endresen, Torben Wittwer, Zhenlin Yang</span>
<span class="co0"># Description: Species distribution from envelope modeling</span>
<span class="co0"># Use gdalinfo and gdalwarp for projection</span>
<span class="co0">#</span>
&nbsp;
<span class="co0">#######################</span>
<span class="co0"># Home directory folder</span>
<span class="re2">home_dir</span>=<span class="st0">&quot;~/ost4sem/project/unidk2010/envmod&quot;</span>
<span class="kw3">cd</span> ~<span class="sy0">/</span>ost4sem<span class="sy0">/</span>project<span class="sy0">/</span>unidk2010<span class="sy0">/</span>envmod
&nbsp;
&nbsp;
&nbsp;
<span class="co0">###########################################</span>
<span class="co0"># use script to create a grass location for the project</span>
<span class="re2">inpr</span>=<span class="st0">&quot;/home/user/ost4sem/project/unidk2010/envmod/input&quot;</span>
&nbsp;
<span class="co0"># create a to LAEA transformed GEOtiff in the Grassdb folder</span>
gdalwarp   -t_srs EPSG:<span class="nu0">3035</span> -s_srs EPSG:<span class="nu0">4326</span>  <span class="re1">$inpr</span><span class="st0">&quot;/pr101europe&quot;</span>.tif  ~<span class="sy0">/</span>ost4sem<span class="sy0">/</span>project<span class="sy0">/</span>unidk2010<span class="sy0">/</span>envmod<span class="sy0">/</span>Grassdb<span class="sy0">/</span>pr101europeLAEA.tif
&nbsp;
<span class="co0"># go to Grassdb folder</span>
<span class="kw3">cd</span> ~<span class="sy0">/</span>ost4sem<span class="sy0">/</span>project<span class="sy0">/</span>unidk2010<span class="sy0">/</span>envmod<span class="sy0">/</span>Grassdb<span class="sy0">/</span>
&nbsp;
<span class="co0"># make a new location called euLAEA in the Grassdb from a GEOtiff</span>
<span class="co0"># it is important to migrate to the Grassdb folder since the create_location script expects you to and the tiff to be there</span>
<span class="kw2">bash</span> ~<span class="sy0">/</span>ost4sem<span class="sy0">/</span>project<span class="sy0">/</span>unidk2010<span class="sy0">/</span>envmod<span class="sy0">/</span>sh_script<span class="sy0">/</span>create_location.sh pr101europeLAEA.tif euLAEA ~<span class="sy0">/</span>ost4sem<span class="sy0">/</span>project<span class="sy0">/</span>unidk2010<span class="sy0">/</span>envmod<span class="sy0">/</span>Grassdb
&nbsp;
<span class="co0"># start working in GRASS GIS</span>
grass <span class="re5">-text</span> <span class="sy0">/</span>home<span class="sy0">/</span>user<span class="sy0">/</span>ost4sem<span class="sy0">/</span>project<span class="sy0">/</span>unidk2010<span class="sy0">/</span>envmod<span class="sy0">/</span>Grassdb<span class="sy0">/</span>euLAEA<span class="sy0">/</span>PERMANENT
g.mapset <span class="re5">-c</span> <span class="re2">mapset</span>=env_mod_mapset
<span class="co0"># after creating the new mapset it is possible to start GRASS with</span>
<span class="co0"># grass -text /home/user/ost4sem/project/unidk2010/envmod/Grassdb/euLAEA/env_mod_mapset</span>
&nbsp;
&nbsp;
<span class="co0"># set new region </span>
g.region <span class="re2">n</span>=<span class="nu0">72.8</span> <span class="re2">s</span>=<span class="nu0">33.55</span> <span class="re2">w</span>=-<span class="nu0">25.1</span> <span class="re2">e</span>=<span class="nu0">45.9</span> <span class="re2">res</span>=<span class="nu0">0</span>:05 <span class="re2">save</span>=eu <span class="re5">--overwrite</span>
&nbsp;
&nbsp;
<span class="co0">##################################</span>
<span class="co0"># import predictor layers to grass</span>
<span class="co0"># http://www.spatial-ecology.net/doku.php?id=wiki:itaveg_respred_table_sh</span>
<span class="re2">inpr</span>=<span class="st0">&quot;/home/user/ost4sem/project/unidk2010/envmod/input&quot;</span>
&nbsp;
<span class="kw1">for</span>  <span class="br0">&#40;</span><span class="br0">&#40;</span> <span class="re2">dir</span>=<span class="nu0">1</span> ; <span class="kw2">dir</span><span class="sy0">&lt;</span>=<span class="nu0">9</span> ; <span class="kw2">dir</span> ++ <span class="br0">&#41;</span><span class="br0">&#41;</span>  ; <span class="kw1">do</span>
<span class="re2">dir</span>=<span class="nu0">1</span>
    gdalwarp   -t_srs EPSG:<span class="nu0">3035</span> -s_srs EPSG:<span class="nu0">3035</span>  <span class="re1">$inpr</span><span class="st0">&quot;/PRESENT/pr10&quot;</span><span class="re1">$dir</span><span class="st0">&quot;/hdr.adf&quot;</span> <span class="re1">$inpr</span><span class="st0">&quot;/pr10&quot;</span><span class="re1">$dir</span><span class="st0">&quot;europe&quot;</span>.tif 
    <span class="co0">#rm -r $inpr&quot;/PRESENT/pr10&quot;$dir</span>
    r.in.gdal <span class="re5">-o</span> <span class="re5">-e</span> <span class="re2">input</span>=<span class="re1">$inpr</span><span class="st0">&quot;/pr10&quot;</span><span class="re1">$dir</span><span class="st0">&quot;europe&quot;</span>.tif  <span class="re2">output</span>=pr10<span class="re1">$dir</span><span class="st0">&quot;europe&quot;</span>  <span class="re5">--overwrite</span>
    <span class="co0">#rm  $inpr&quot;/pr10&quot;$dir&quot;europe&quot;.tif</span>
<span class="kw1">done</span>
&nbsp;
<span class="kw1">for</span>  <span class="br0">&#40;</span><span class="br0">&#40;</span> <span class="re2">dir</span>=<span class="nu0">10</span> ; <span class="kw2">dir</span><span class="sy0">&lt;</span>=<span class="nu0">39</span> ; <span class="kw2">dir</span> ++ <span class="br0">&#41;</span><span class="br0">&#41;</span>  ; <span class="kw1">do</span>
    gdalwarp   -t_srs EPSG:<span class="nu0">3035</span> -s_srs EPSG:<span class="nu0">3035</span>  <span class="re1">$inpr</span><span class="st0">&quot;/PRESENT/pr1&quot;</span><span class="re1">$dir</span><span class="st0">&quot;/hdr.adf&quot;</span> <span class="re1">$inpr</span><span class="st0">&quot;/pr1&quot;</span><span class="re1">$dir</span><span class="st0">&quot;europe&quot;</span>.tif 
    <span class="co0">#rm -r $inpr&quot;/PRESENT/pr1&quot;$dir</span>
    r.in.gdal <span class="re5">-o</span> <span class="re5">-e</span> <span class="re2">input</span>=<span class="re1">$inpr</span><span class="st0">&quot;/pr1&quot;</span><span class="re1">$dir</span><span class="st0">&quot;europe&quot;</span>.tif  <span class="re2">output</span>=pr1<span class="re1">$dir</span><span class="st0">&quot;europe&quot;</span>  <span class="re5">--overwrite</span>
<span class="co0">#    r.in.gdal -o input=$inpr&quot;pr1&quot;$dir&quot;europe&quot;.tif dir&quot;europe&quot;  --overwrite</span>
<span class="kw1">done</span>
&nbsp;
<span class="kw1">for</span>  <span class="kw2">dir</span> <span class="kw1">in</span>  <span class="nu0">198</span> <span class="nu0">199</span> <span class="nu0">200</span> <span class="nu0">201</span> <span class="nu0">202</span> <span class="nu0">203</span> <span class="nu0">204</span> <span class="nu0">205</span> <span class="nu0">250</span> <span class="nu0">254</span> <span class="nu0">255</span> <span class="nu0">257</span> <span class="nu0">258</span> <span class="nu0">259</span> <span class="nu0">262</span> <span class="nu0">264</span> <span class="nu0">265</span> <span class="nu0">292</span> <span class="nu0">293</span> <span class="nu0">294</span>  ; <span class="kw1">do</span>
    gdalwarp   -t_srs EPSG:<span class="nu0">4326</span> -s_srs EPSG:<span class="nu0">3035</span>  <span class="re1">$inpr</span><span class="st0">&quot;/PRESENT/pr&quot;</span><span class="re1">$dir</span><span class="st0">&quot;/hdr.adf&quot;</span> <span class="re1">$inpr</span><span class="st0">&quot;/pr&quot;</span><span class="re1">$dir</span><span class="st0">&quot;europe&quot;</span>.tif 
    <span class="co0">#rm -r $inpr&quot;/PRESENT/pr&quot;$dir</span>
    r.in.gdal <span class="re5">-o</span> <span class="re5">-e</span> <span class="re2">input</span>=<span class="re1">$inpr</span><span class="st0">&quot;/pr&quot;</span><span class="re1">$dir</span><span class="st0">&quot;europe&quot;</span>.tif  <span class="re2">output</span>=<span class="kw2">pr</span><span class="re1">$dir</span><span class="st0">&quot;europe&quot;</span>  <span class="re5">--overwrite</span>
    <span class="co0">#r.in.gdal -o input=$inpr&quot;/physic_pr/pr&quot;$dir&quot;/hdr.adf&quot;  output=pr$dir&quot;europe&quot;  --overwrite</span>
<span class="kw1">done</span>
&nbsp;
<span class="co0">##################################</span>
<span class="co0"># import response layers (selected species) to grass</span>
<span class="co0"># we have csv files with coordinates of localities where the species were found</span>
&nbsp;
<span class="re2">species_list</span>=<span class="st0">&quot;vanessa+atalanta humulus+lupulus scolitantides+orion sedum+acre crambe+maritima&quot;</span>
<span class="re2">inpr</span>=<span class="st0">&quot;/home/user/ost4sem/project/unidk2010/envmod/input&quot;</span>
&nbsp;
<span class="co0"># when you want to import csv files into GRASS you have to create a vrt file for each csv file that defines the data structure of the csv file</span>
&nbsp;
<span class="kw1">for</span> spec <span class="kw1">in</span> <span class="re1">$species_list</span>; <span class="kw1">do</span>
 <span class="re2">vrt_file</span>=<span class="re1">$inpr</span><span class="sy0">/</span>species<span class="sy0">/</span><span class="re1">$spec</span>.vrt
 <span class="kw3">echo</span> <span class="st0">&quot;&lt;OGRVRTDataSource&gt;&quot;</span> <span class="sy0">&gt;</span> <span class="re1">$vrt_file</span>
 <span class="kw3">echo</span> <span class="re5">-e</span> <span class="st0">&quot;<span class="es1">\t</span>&lt;OGRVRTLayer name=<span class="es1">\&quot;</span><span class="es2">$spec</span><span class="es1">\&quot;</span>&gt;&quot;</span> <span class="sy0">&gt;&gt;</span> <span class="re1">$vrt_file</span>
 <span class="kw3">echo</span> <span class="re5">-e</span> <span class="st0">&quot;<span class="es1">\t</span><span class="es1">\t</span>&lt;SrcDataSource&gt;<span class="es2">$spec</span>.csv&lt;/SrcDataSource&gt;&quot;</span> <span class="sy0">&gt;&gt;</span> <span class="re1">$vrt_file</span>
 <span class="kw3">echo</span> <span class="re5">-e</span> <span class="st0">&quot;<span class="es1">\t</span><span class="es1">\t</span>&lt;GeometryType&gt;wkbPoint&lt;/GeometryType&gt;&quot;</span> <span class="sy0">&gt;&gt;</span> <span class="re1">$vrt_file</span>
 <span class="kw3">echo</span> <span class="re5">-e</span> <span class="st0">&quot;<span class="es1">\t</span><span class="es1">\t</span>&lt;LayerSRS&gt;WGS84&lt;/LayerSRS&gt;&quot;</span> <span class="sy0">&gt;&gt;</span> <span class="re1">$vrt_file</span>
 <span class="kw3">echo</span> <span class="re5">-e</span> <span class="st0">&quot;<span class="es1">\t</span><span class="es1">\t</span>&lt;GeometryField encoding=<span class="es1">\&quot;</span>PointFromColumns<span class="es1">\&quot;</span> x=<span class="es1">\&quot;</span>long<span class="es1">\&quot;</span> y=<span class="es1">\&quot;</span>lat<span class="es1">\&quot;</span>/&gt;&quot;</span> <span class="sy0">&gt;&gt;</span> <span class="re1">$vrt_file</span> 
 <span class="kw3">echo</span> <span class="re5">-e</span> <span class="st0">&quot;<span class="es1">\t</span>&lt;/OGRVRTLayer&gt;&quot;</span> <span class="sy0">&gt;&gt;</span> <span class="re1">$vrt_file</span>
 <span class="kw3">echo</span> <span class="re5">-e</span> <span class="st0">&quot;&lt;/OGRVRTDataSource&gt;&quot;</span> <span class="sy0">&gt;&gt;</span> <span class="re1">$vrt_file</span>
 <span class="kw2">cat</span> <span class="re1">$vrt_file</span>
<span class="kw1">done</span>
&nbsp;
&nbsp;
<span class="kw1">for</span> spec <span class="kw1">in</span> <span class="sy0">`</span><span class="kw3">echo</span> <span class="re1">$species_list</span><span class="sy0">`</span> ; <span class="kw1">do</span>
  <span class="kw3">echo</span> <span class="re1">$spec</span>
  <span class="kw2">rm</span> <span class="re5">-r</span> <span class="re1">$inpr</span><span class="st0">&quot;/species/&quot;</span><span class="re1">$spec</span> 
  <span class="kw2">cp</span> <span class="re1">$inpr</span><span class="sy0">/</span>species<span class="sy0">/</span><span class="re1">$spec</span>.txt <span class="re1">$inpr</span><span class="st0">&quot;/species/&quot;</span><span class="re1">$spec</span>.csv
  ogr2ogr  -s_srs EPSG:<span class="nu0">4326</span> -t_srs EPSG:<span class="nu0">3035</span> <span class="re1">$inpr</span><span class="st0">&quot;/species/&quot;</span><span class="re1">$spec</span>   <span class="re1">$inpr</span><span class="st0">&quot;/species/&quot;</span><span class="re1">$spec</span><span class="st0">&quot;.csv&quot;</span>
  ogr2ogr  <span class="re5">-overwrite</span> -s_srs EPSG:<span class="nu0">4326</span> -t_srs EPSG:<span class="nu0">3035</span> <span class="re1">$inpr</span><span class="st0">&quot;/species/&quot;</span><span class="re1">$spec</span>   <span class="re1">$inpr</span><span class="st0">&quot;/species/&quot;</span><span class="re1">$spec</span><span class="st0">&quot;.vrt&quot;</span>
<span class="kw1">done</span>
&nbsp;
&nbsp;
<span class="co0">#########</span>
<span class="co0"># GRASS #</span>
<span class="co0">#########</span>
&nbsp;
<span class="co0"># start GRASS GIS</span>
grass <span class="re5">-text</span> <span class="sy0">/</span>home<span class="sy0">/</span>user<span class="sy0">/</span>ost4sem<span class="sy0">/</span>project<span class="sy0">/</span>unidk2010<span class="sy0">/</span>envmod<span class="sy0">/</span>Grassdb<span class="sy0">/</span>euLAEA<span class="sy0">/</span>env_mod_mapset<span class="sy0">/</span>
&nbsp;
&nbsp;
<span class="co0"># export $species_list</span>
<span class="re2">species_list</span>=<span class="st0">&quot;vanessa+atalanta humulus+lupulus scolitantides+orion sedum+acre crambe+maritima&quot;</span>
<span class="re2">inpr</span>=<span class="st0">&quot;/home/user/ost4sem/project/unidk2010/envmod/input&quot;</span>
&nbsp;
&nbsp;
<span class="co0"># import species in GRASS</span>
<span class="kw1">for</span> spec <span class="kw1">in</span> <span class="re1">$species_list</span>; <span class="kw1">do</span>
  <span class="re2">specname</span>=<span class="sy0">`</span><span class="kw3">echo</span> <span class="re1">$spec</span> <span class="sy0">|</span> <span class="kw2">tr</span> <span class="st0">&quot;+&quot;</span> <span class="st0">&quot;_&quot;</span><span class="sy0">`</span>
  v.in.ogr <span class="re2">dsn</span>=<span class="re1">$inpr</span><span class="sy0">/</span>species<span class="sy0">/</span><span class="re1">$spec</span> <span class="re2">output</span>=<span class="re1">$specname</span> <span class="re5">--overwrite</span>
<span class="kw1">done</span>
&nbsp;
<span class="co0"># as alternative use v.in.ascii</span>
<span class="co0"># for spec in $species_list; do</span>
<span class="co0">#  specname=`echo $spec | tr &quot;+&quot; &quot;_&quot;`</span>
<span class="co0">#  v.in.ascii input=$inpr/species/&quot;$spec&quot;.txt output=$specname fs=, skip=1 x=2 y=3 --o</span>
<span class="co0"># done</span>
&nbsp;
&nbsp;
<span class="co0">#v.info crambe_maritima</span>
&nbsp;
&nbsp;
<span class="kw1">for</span> spec <span class="kw1">in</span> <span class="re1">$species_list</span>; <span class="kw1">do</span>
  <span class="re2">specname</span>=<span class="sy0">`</span><span class="kw3">echo</span> <span class="re1">$spec</span> <span class="sy0">|</span> <span class="kw2">tr</span> <span class="st0">&quot;+&quot;</span> <span class="st0">&quot;_&quot;</span><span class="sy0">`</span>
  <span class="co0">#v.db.select $specname #print attribute table (if you want to see before you delete - in the next line)</span>
  v.db.droptable <span class="re2">map</span>=<span class="re1">$specname</span> <span class="re5">-f</span>
  v.db.addtable <span class="re2">map</span>=<span class="re1">$specname</span>  <span class="re2">columns</span>=<span class="st0">&quot;pr101 double,pr102 double,pr103 double,pr104 double,pr105 double,pr106 double,pr107 double,pr108 double,pr109 double,pr110 double,pr111 double,pr112 int,pr113 int,pr114 int,pr115 double,pr116 int,pr117 int,pr118 int,pr119 int,pr120 double,pr121 double,pr122 int,pr123 double,pr124 double,pr125 double,pr126 double,pr127 double,pr128 double,pr129 double,pr130 double,pr131 double,pr132 int,pr133 int,pr134 double,pr135 double,pr136 double,pr137 double,pr138 double,pr139 double,pr198 double,pr199 double,pr200 int,pr201 int,pr202 int,pr203 double,pr204 double,pr205 int,pr250 int,pr254 int,pr255 int,pr257 int,pr258 int,pr259 int,pr262 int,pr264 int,pr265 int,pr292 int,pr293 double,pr294 int,xcoor double,ycoor double&quot;</span>
<span class="kw1">done</span>
&nbsp;
<span class="co0"># Print column types and names of table linked to vector map </span>
<span class="co0"># v.db.connect -c map=vanessa_atalanta</span>
&nbsp;
<span class="co0"># Print database connection</span>
<span class="co0"># v.db.connect -p map=vanessa_atalanta</span>
&nbsp;
&nbsp;
&nbsp;
<span class="co0"># create a raster_list.txt file (space separated values) including a list of raster </span>
<span class="co0"># file names we want to sample  </span>
<span class="co0"># once you create the raster_list.txt, read the contents of raster_list.txt files with the &quot;cat&quot; command </span>
<span class="co0">#list=`cat /data/ost4sem/studycase/ITA_veg/grassdata/SPATIALDATA/raster_list.txt`</span>
<span class="re2">list</span>=<span class="st0">&quot;pr101europe  pr111europe  pr121europe  pr131europe  pr199europe  pr257europe pr102europe  pr112europe  pr122europe  pr132europe  pr200europe  pr258europe pr103europe  pr113europe  pr123europe  pr133europe  pr201europe  pr259europe pr104europe  pr114europe  pr124europe  pr134europe  pr202europe  pr262europe pr105europe  pr115europe  pr125europe  pr135europe  pr203europe  pr264europe pr106europe  pr116europe  pr126europe  pr136europe  pr204europe  pr265europe pr107europe  pr117europe  pr127europe  pr137europe  pr205europe  pr292europe pr108europe  pr118europe  pr128europe  pr138europe  pr250europe  pr293europe pr109europe  pr119europe  pr129europe  pr139europe  pr254europe  pr294europe pr110europe  pr120europe  pr130europe  pr198europe  pr255europe&quot;</span>
<span class="kw3">echo</span> <span class="re1">$list</span> <span class="sy0">&gt;</span> <span class="re1">$inpr</span><span class="sy0">/</span>raster_list.txt
&nbsp;
&nbsp;
<span class="co0"># Uploads predictor raster values at positions of vector points to the table </span>
<span class="co0"># In our case we sample for all raster files of the list</span>
<span class="co0"># their values in correspondence of the x y points locations corresponding to </span>
<span class="co0"># the vector point list for the species occurrence points downloaded from GBIF.</span>
<span class="co0"># NB! This step takes LONG time (approx 60 min++)</span>
<span class="co0">#</span>
<span class="kw1">for</span> spec <span class="kw1">in</span> <span class="re1">$species_list</span>; <span class="kw1">do</span>
  <span class="re2">specname</span>=<span class="sy0">`</span><span class="kw3">echo</span> <span class="re1">$spec</span> <span class="sy0">|</span> <span class="kw2">tr</span> <span class="st0">&quot;+&quot;</span> <span class="st0">&quot;_&quot;</span><span class="sy0">`</span>
  <span class="kw1">for</span> a <span class="kw1">in</span> <span class="re1">$list</span> ; <span class="kw1">do</span>
    <span class="re2">a</span>=<span class="co1">${a/europe/}</span>
    v.what.rast <span class="re2">vector</span>=<span class="re1">$specname</span> <span class="re2">raster</span>=<span class="re1">$a</span><span class="st0">&quot;europe&quot;</span> <span class="re2">column</span>=<span class="re1">$a</span>
  <span class="kw1">done</span>
<span class="kw1">done</span>
&nbsp;
<span class="co0"># Create new vector (points) from database table containing coordinates. </span>
<span class="co0"># v.to.db - Load values from vector to database. In uploaded/printed category values '-1' is used for 'no category' and 'null'/'-' if category cannot be found or multiple categories were found. </span>
<span class="kw1">for</span> spec <span class="kw1">in</span> <span class="re1">$species_list</span>; <span class="kw1">do</span>
  <span class="re2">specname</span>=<span class="sy0">`</span><span class="kw3">echo</span> <span class="re1">$spec</span> <span class="sy0">|</span> <span class="kw2">tr</span> <span class="st0">&quot;+&quot;</span> <span class="st0">&quot;_&quot;</span><span class="sy0">`</span>
  <span class="kw3">echo</span> <span class="re1">$specname</span>
  <span class="co0">#v.to.db -p map=$specname type=point layer=1 option=coor column=xcoor,ycoor # -p print only</span>
  v.to.db  <span class="re2">map</span>=<span class="re1">$specname</span> <span class="re2">type</span>=point <span class="re2">layer</span>=<span class="nu0">1</span> <span class="re2">option</span>=coor <span class="re2">column</span>=xcoor,ycoor
<span class="kw1">done</span>
&nbsp;
&nbsp;
&nbsp;
&nbsp;
<span class="co0">###################################################</span>
<span class="co0"># We need pseudo-absences for the model calibration</span>
<span class="co0"># Here we generate 2 000 random points</span>
<span class="co0"># The species classification is as present and absent</span>
<span class="co0"># The random forest model calibration need examples of both classes</span>
<span class="co0"># Pseudo-absences is a substitute for missing absence points</span>
<span class="co0"># Many species occurrence datasets include ONLY presence points</span>
<span class="co0"># In other words: the places the species was NOT observed, is not recorded</span>
<span class="co0">#</span>
<span class="co0">#</span>
&nbsp;
g.copy <span class="re2">input</span>=pr101europe <span class="re2">output</span>=land
r.null <span class="re2">map</span>=land <span class="re2">setnull</span>=<span class="nu0">0</span>
r.random <span class="re2">input</span>=land  <span class="re2">n</span>=<span class="nu0">2000</span> <span class="re2">vector_output</span>=random2000  <span class="re5">--overwrite</span>
d.mon <span class="re2">start</span>=x0
d.rast land
d.vect random2000
&nbsp;
&nbsp;
<span class="co0"># clean attribute table</span>
v.db.droptable <span class="re2">map</span>=random2000 <span class="re5">-f</span>
&nbsp;
<span class="co0"># populate attribute table, give column names</span>
v.db.addtable <span class="re2">map</span>=random2000  <span class="re2">columns</span>=<span class="st0">&quot;pr101 double,pr102 double,pr103 double,pr104 double,pr105 double,pr106 double,pr107 double,pr108 double,pr109 double,pr110 double,pr111 double,pr112 int,pr113 int,pr114 int,pr115 double,pr116 int,pr117 int,pr118 int,pr119 int,pr120 double,pr121 double,pr122 int,pr123 double,pr124 double,pr125 double,pr126 double,pr127 double,pr128 double,pr129 double,pr130 double,pr131 double,pr132 int,pr133 int,pr134 double,pr135 double,pr136 double,pr137 double,pr138 double,pr139 double,pr198 double,pr199 double,pr200 int,pr201 int,pr202 int,pr203 double,pr204 double,pr205 int,pr250 int,pr254 int,pr255 int,pr257 int,pr258 int,pr259 int,pr262 int,pr264 int,pr265 int,pr292 int,pr293 double,pr294 int,xcoor double,ycoor double&quot;</span>
<span class="co0">#fill columns</span>
<span class="kw1">for</span> a <span class="kw1">in</span> <span class="re1">$list</span> ; <span class="kw1">do</span>
  <span class="re2">a</span>=<span class="co1">${a/europe/}</span>
  v.what.rast <span class="re2">vector</span>=random2000 <span class="re2">raster</span>=<span class="re1">$a</span><span class="st0">&quot;europe&quot;</span> <span class="re2">column</span>=<span class="re1">$a</span>
<span class="kw1">done</span>
<span class="co0">#add coordinates to table</span>
v.to.db  <span class="re2">map</span>=random2000 <span class="re2">type</span>=point <span class="re2">layer</span>=<span class="nu0">1</span> <span class="re2">option</span>=coor <span class="re2">column</span>=xcoor,ycoor	
&nbsp;
&nbsp;
<span class="co0">########</span>
<span class="co0"># RESULT</span>
<span class="co0"># /home/user/ost4sem/project/unidk2010/envmod/Grassdb/euLAEA/env_mod_mapset/dbf</span>
<span class="co0"># Next step is top open the dbf file with R</span></pre>

<p>
<br/>

</p>

<p>
<a href="/dokuwiki/lib/exe/fetch.php?tok=407452&amp;media=http%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2Fthumb%2F6%2F69%2FWorld_map_blank_gmt.svg%2F120px-World_map_blank_gmt.svg.png" class="media" title="http://upload.wikimedia.org/wikipedia/commons/thumb/6/69/World_map_blank_gmt.svg/120px-World_map_blank_gmt.svg.png"><img src="/dokuwiki/lib/exe/fetch.php?tok=407452&amp;media=http%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2Fthumb%2F6%2F69%2FWorld_map_blank_gmt.svg%2F120px-World_map_blank_gmt.svg.png" class="mediacenter" alt="" /></a>
</p>

</div>
<!-- EDIT14 SECTION "GRASS" [15231-25529] -->
<h2 class="sectionedit15" id="distribution_models">DISTRIBUTION MODELS</h2>
<div class="level2">

<p>
Following the study case from the course wiki and the original scripts made by Stefano Casalegno and Guiseppe Amatulli.
<br/>

See: <a href="http://www.spatial-ecology.net/doku.php?id=wiki:forestmod#computational_implementation" class="urlextern" target="blanc" title="http://www.spatial-ecology.net/doku.php?id=wiki:forestmod#computational_implementation" rel="nofollow noopener">http://www.spatial-ecology.net/doku.php?id=wiki:forestmod#computational_implementation</a>
<br/>

</p>

</div>
<!-- EDIT15 SECTION "DISTRIBUTION MODELS" [25530-25780] -->
<h3 class="sectionedit16" id="calibrate_random_forest_model">Calibrate Random Forest Model</h3>
<div class="level3">

<p>
<br/>

</p>
<pre class="code bash"><span class="co0">#!/bin/bash</span>
<span class="co0">#</span>
<span class="co0"># Copenhagen June 2010, ost4sem, unidk2010</span>
<span class="co0">#</span>
<span class="co0"># Title: Envelope models</span>
<span class="co0"># Authors: Alistair Auffret, Dag Endresen, Torben Wittwer, Zhenlin Yang</span>
<span class="co0"># Description: Species distribution from envelope modeling</span>
<span class="co0"># Table data from GRASS --&gt; R</span>
<span class="co0"># Calibrate SDM models in R</span>
<span class="co0"># Deploy SDM models to calculate prediction of species distribution in Sweden</span>
<span class="co0">#</span>
&nbsp;
&nbsp;
<span class="co0">#######################</span>
<span class="co0"># Home directory folder</span>
<span class="re2">home_dir</span>=<span class="st0">&quot;~/ost4sem/project/unidk2010/envmod&quot;</span>
<span class="kw3">cd</span> ~<span class="sy0">/</span>ost4sem<span class="sy0">/</span>project<span class="sy0">/</span>unidk2010<span class="sy0">/</span>envmod
&nbsp;
&nbsp;
<span class="co0">#clean up workspace</span>
<span class="kw2">rm</span><span class="br0">&#40;</span><span class="re2">list</span>=<span class="kw2">ls</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
&nbsp;
<span class="co0"># load libraries</span>
library<span class="br0">&#40;</span>gdata<span class="br0">&#41;</span> <span class="co0"># used to drep.levels function</span>
library<span class="br0">&#40;</span>foreign<span class="br0">&#41;</span> <span class="co0"># used to read.dbf function</span>
library<span class="br0">&#40;</span>randomForest<span class="br0">&#41;</span> <span class="co0"># Modelling function</span>
library<span class="br0">&#40;</span>mda<span class="br0">&#41;</span> <span class="co0"># confusion</span>
<span class="co0"># library (vcd) # getting Kappa (if using Kappa for validation)</span>
&nbsp;
<span class="co0">#define working directories</span>
home_dir <span class="sy0">&lt;</span>- <span class="st0">&quot;/home/user/ost4sem/project/unidk2010/envmod&quot;</span>
dbf_dir <span class="sy0">&lt;</span>- <span class="st0">&quot;/home/user/ost4sem/project/unidk2010/envmod/Grassdb/euLAEA/env_mod_mapset/dbf&quot;</span>
&nbsp;
<span class="co0">#create output/R folder</span>
system<span class="br0">&#40;</span>paste<span class="br0">&#40;</span><span class="st0">&quot;mkdir &quot;</span>,home_dir,<span class="st0">&quot;/output/R&quot;</span>, <span class="re2">sep</span>=<span class="st0">&quot;&quot;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
setwd<span class="br0">&#40;</span>paste<span class="br0">&#40;</span>home_dir,<span class="st0">&quot;/output/R&quot;</span>,<span class="re2">sep</span>=<span class="st0">&quot;&quot;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
&nbsp;
species_list <span class="sy0">&lt;</span>- c<span class="br0">&#40;</span><span class="st0">&quot;vanessa_atalanta&quot;</span>, <span class="st0">&quot;crambe_maritima&quot;</span>, <span class="st0">&quot;humulus_lupulus&quot;</span>, <span class="st0">&quot;scolitantides_orion&quot;</span>, <span class="st0">&quot;sedum_acre&quot;</span><span class="br0">&#41;</span>
&nbsp;
<span class="co0"># load predictors DataFrame and clean it from the NA values</span>
<span class="co0"># define predictor types (numeric factors if needed</span>
vanessa_atalanta <span class="sy0">&lt;</span>- read.dbf<span class="br0">&#40;</span>paste<span class="br0">&#40;</span>dbf_dir,<span class="st0">&quot;/vanessa_atalanta.dbf&quot;</span>,<span class="re2">sep</span>=<span class="st0">&quot;&quot;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
crambe_maritima <span class="sy0">&lt;</span>- read.dbf<span class="br0">&#40;</span>paste<span class="br0">&#40;</span>dbf_dir,<span class="st0">&quot;/crambe_maritima.dbf&quot;</span>,<span class="re2">sep</span>=<span class="st0">&quot;&quot;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
humulus_lupulus <span class="sy0">&lt;</span>- read.dbf<span class="br0">&#40;</span>paste<span class="br0">&#40;</span>dbf_dir,<span class="st0">&quot;/humulus_lupulus.dbf&quot;</span>,<span class="re2">sep</span>=<span class="st0">&quot;&quot;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
scolitantides_orion <span class="sy0">&lt;</span>- read.dbf<span class="br0">&#40;</span>paste<span class="br0">&#40;</span>dbf_dir,<span class="st0">&quot;/scolitantides_orion.dbf&quot;</span>,<span class="re2">sep</span>=<span class="st0">&quot;&quot;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
sedum_acre <span class="sy0">&lt;</span>- read.dbf<span class="br0">&#40;</span>paste<span class="br0">&#40;</span>dbf_dir,<span class="st0">&quot;/sedum_acre.dbf&quot;</span>,<span class="re2">sep</span>=<span class="st0">&quot;&quot;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
&nbsp;
write.table<span class="br0">&#40;</span>vanessa_atalanta, <span class="re2">file</span>=<span class="st0">&quot;vanessa_atalanta.csv&quot;</span>, row.names=TRUE, <span class="re2">sep</span>=<span class="st0">&quot;,&quot;</span><span class="br0">&#41;</span>
write.table<span class="br0">&#40;</span>crambe_maritima, <span class="re2">file</span>=<span class="st0">&quot;crambe_maritima.csv&quot;</span>, row.names=TRUE, <span class="re2">sep</span>=<span class="st0">&quot;,&quot;</span><span class="br0">&#41;</span>
write.table<span class="br0">&#40;</span>humulus_lupulus, <span class="re2">file</span>=<span class="st0">&quot;humulus_lupulus.csv&quot;</span>, row.names=TRUE, <span class="re2">sep</span>=<span class="st0">&quot;,&quot;</span><span class="br0">&#41;</span>
write.table<span class="br0">&#40;</span>scolitantides_orion, <span class="re2">file</span>=<span class="st0">&quot;scolitantides_orion.csv&quot;</span>, row.names=TRUE, <span class="re2">sep</span>=<span class="st0">&quot;,&quot;</span><span class="br0">&#41;</span>
write.table<span class="br0">&#40;</span>sedum_acre, <span class="re2">file</span>=<span class="st0">&quot;sedum_acre.csv&quot;</span>, row.names=TRUE, <span class="re2">sep</span>=<span class="st0">&quot;,&quot;</span><span class="br0">&#41;</span>
&nbsp;
<span class="co0">#remove rows with NA</span>
<span class="co0"># some occurrences are outside our region (Europe)</span>
vanessa_atalanta = na.omit<span class="br0">&#40;</span>vanessa_atalanta<span class="br0">&#41;</span>
crambe_maritima = na.omit<span class="br0">&#40;</span>crambe_maritima<span class="br0">&#41;</span>
humulus_lupulus = na.omit<span class="br0">&#40;</span>humulus_lupulus<span class="br0">&#41;</span>
scolitantides_orion = na.omit<span class="br0">&#40;</span>scolitantides_orion<span class="br0">&#41;</span>
sedum_acre = na.omit<span class="br0">&#40;</span>sedum_acre<span class="br0">&#41;</span>
&nbsp;
<span class="co0"># define the factor variables (classes)</span>
<span class="co4">vanessa_atalanta$</span>pr205 = factor<span class="br0">&#40;</span>vanessa_atalanta<span class="re1">$pr205</span>, ordered = FALSE<span class="br0">&#41;</span>
<span class="co4">vanessa_atalanta$</span>pr250 = factor<span class="br0">&#40;</span>vanessa_atalanta<span class="re1">$pr250</span>, ordered = FALSE<span class="br0">&#41;</span>
<span class="co4">vanessa_atalanta$</span>pr254 = factor<span class="br0">&#40;</span>vanessa_atalanta<span class="re1">$pr254</span>, ordered = TRUE<span class="br0">&#41;</span>
<span class="co4">vanessa_atalanta$</span>pr255 = factor<span class="br0">&#40;</span>vanessa_atalanta<span class="re1">$pr255</span>, ordered = TRUE<span class="br0">&#41;</span>
<span class="co4">vanessa_atalanta$</span>pr257 = factor<span class="br0">&#40;</span>vanessa_atalanta<span class="re1">$pr257</span>, ordered = TRUE<span class="br0">&#41;</span>
<span class="co4">vanessa_atalanta$</span>pr258 = factor<span class="br0">&#40;</span>vanessa_atalanta<span class="re1">$pr258</span>, ordered = TRUE<span class="br0">&#41;</span>
<span class="co4">vanessa_atalanta$</span>pr259 = factor<span class="br0">&#40;</span>vanessa_atalanta<span class="re1">$pr259</span>, ordered = FALSE<span class="br0">&#41;</span>
<span class="co4">vanessa_atalanta$</span>pr262 = factor<span class="br0">&#40;</span>vanessa_atalanta<span class="re1">$pr262</span>, ordered = FALSE<span class="br0">&#41;</span>
<span class="co4">vanessa_atalanta$</span>pr264 = factor<span class="br0">&#40;</span>vanessa_atalanta<span class="re1">$pr264</span>, ordered = FALSE<span class="br0">&#41;</span>
<span class="co4">vanessa_atalanta$</span>pr265 = factor<span class="br0">&#40;</span>vanessa_atalanta<span class="re1">$pr265</span>, ordered = FALSE<span class="br0">&#41;</span>
<span class="co4">vanessa_atalanta$</span>pr292 = factor<span class="br0">&#40;</span>vanessa_atalanta<span class="re1">$pr292</span>, ordered = FALSE<span class="br0">&#41;</span>
<span class="co0">#drop unused levels</span>
vanessa_atalanta = drop.levels<span class="br0">&#40;</span>vanessa_atalanta<span class="br0">&#41;</span>
&nbsp;
<span class="co0"># define factor variables save way for other species ...</span>
<span class="co4">crambe_maritima$</span>pr205 = factor<span class="br0">&#40;</span>crambe_maritima<span class="re1">$pr205</span>, ordered = FALSE<span class="br0">&#41;</span>
<span class="co4">crambe_maritima$</span>pr250 = factor<span class="br0">&#40;</span>crambe_maritima<span class="re1">$pr250</span>, ordered = FALSE<span class="br0">&#41;</span>
<span class="co4">crambe_maritima$</span>pr254 = factor<span class="br0">&#40;</span>crambe_maritima<span class="re1">$pr254</span>, ordered = TRUE<span class="br0">&#41;</span>
<span class="co4">crambe_maritima$</span>pr255 = factor<span class="br0">&#40;</span>crambe_maritima<span class="re1">$pr255</span>, ordered = TRUE<span class="br0">&#41;</span>
<span class="co4">crambe_maritima$</span>pr257 = factor<span class="br0">&#40;</span>crambe_maritima<span class="re1">$pr257</span>, ordered = TRUE<span class="br0">&#41;</span>
<span class="co4">crambe_maritima$</span>pr258 = factor<span class="br0">&#40;</span>crambe_maritima<span class="re1">$pr258</span>, ordered = TRUE<span class="br0">&#41;</span>
<span class="co4">crambe_maritima$</span>pr259 = factor<span class="br0">&#40;</span>crambe_maritima<span class="re1">$pr259</span>, ordered = FALSE<span class="br0">&#41;</span>
<span class="co4">crambe_maritima$</span>pr262 = factor<span class="br0">&#40;</span>crambe_maritima<span class="re1">$pr262</span>, ordered = FALSE<span class="br0">&#41;</span>
<span class="co4">crambe_maritima$</span>pr264 = factor<span class="br0">&#40;</span>crambe_maritima<span class="re1">$pr264</span>, ordered = FALSE<span class="br0">&#41;</span>
<span class="co4">crambe_maritima$</span>pr265 = factor<span class="br0">&#40;</span>crambe_maritima<span class="re1">$pr265</span>, ordered = FALSE<span class="br0">&#41;</span>
<span class="co4">crambe_maritima$</span>pr292 = factor<span class="br0">&#40;</span>crambe_maritima<span class="re1">$pr292</span>, ordered = FALSE<span class="br0">&#41;</span>
<span class="co0">#drop unused levels</span>
crambe_maritima = drop.levels<span class="br0">&#40;</span>crambe_maritima<span class="br0">&#41;</span>
&nbsp;
<span class="co0">#</span>
<span class="co0"># the pseudo-absence points</span>
random2000 <span class="sy0">&lt;</span>- read.dbf<span class="br0">&#40;</span>paste<span class="br0">&#40;</span>dbf_dir,<span class="st0">&quot;/random2000.dbf&quot;</span>,<span class="re2">sep</span>=<span class="st0">&quot;&quot;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
write.table<span class="br0">&#40;</span>random2000, <span class="re2">file</span>=<span class="st0">&quot;random2000.csv&quot;</span>, row.names=TRUE, <span class="re2">sep</span>=<span class="st0">&quot;,&quot;</span><span class="br0">&#41;</span>
<span class="co0">#</span>
<span class="co0"># define factor variables</span>
<span class="co4">random2000$</span>pr205 = factor<span class="br0">&#40;</span>random2000<span class="re1">$pr205</span>, ordered = FALSE<span class="br0">&#41;</span>
<span class="co4">random2000$</span>pr250 = factor<span class="br0">&#40;</span>random2000<span class="re1">$pr250</span>, ordered = FALSE<span class="br0">&#41;</span>
<span class="co4">random2000$</span>pr254 = factor<span class="br0">&#40;</span>random2000<span class="re1">$pr254</span>, ordered = TRUE<span class="br0">&#41;</span>
<span class="co4">random2000$</span>pr255 = factor<span class="br0">&#40;</span>random2000<span class="re1">$pr255</span>, ordered = TRUE<span class="br0">&#41;</span>
<span class="co4">random2000$</span>pr257 = factor<span class="br0">&#40;</span>random2000<span class="re1">$pr257</span>, ordered = TRUE<span class="br0">&#41;</span>
<span class="co4">random2000$</span>pr258 = factor<span class="br0">&#40;</span>random2000<span class="re1">$pr258</span>, ordered = TRUE<span class="br0">&#41;</span>
<span class="co4">random2000$</span>pr259 = factor<span class="br0">&#40;</span>random2000<span class="re1">$pr259</span>, ordered = FALSE<span class="br0">&#41;</span>
<span class="co4">random2000$</span>pr262 = factor<span class="br0">&#40;</span>random2000<span class="re1">$pr262</span>, ordered = FALSE<span class="br0">&#41;</span>
<span class="co4">random2000$</span>pr264 = factor<span class="br0">&#40;</span>random2000<span class="re1">$pr264</span>, ordered = FALSE<span class="br0">&#41;</span>
<span class="co4">random2000$</span>pr265 = factor<span class="br0">&#40;</span>random2000<span class="re1">$pr265</span>, ordered = FALSE<span class="br0">&#41;</span>
<span class="co4">random2000$</span>pr292 = factor<span class="br0">&#40;</span>random2000<span class="re1">$pr292</span>, ordered = FALSE<span class="br0">&#41;</span>
<span class="co0">#drop unused levels</span>
random2000 = drop.levels<span class="br0">&#40;</span>random2000<span class="br0">&#41;</span>
&nbsp;
<span class="co0">#</span>
<span class="co0">#save all vars in workspace</span>
save.image<span class="br0">&#40;</span><span class="re2">file</span>=<span class="st0">&quot;workspace.RData&quot;</span><span class="br0">&#41;</span>
<span class="co0"># load(&quot;~/ost4sem/studycase/ITA_veg/R_script/results/RF47&quot;)</span>
&nbsp;
<span class="co0"># set the presence 1 and absence as 0</span>
<span class="co4">vanessa_atalanta$</span>pa <span class="sy0">&lt;</span>- <span class="nu0">1</span>
<span class="co4">random2000$</span>pa <span class="sy0">&lt;</span>- <span class="nu0">0</span>
&nbsp;
<span class="co0"># combine species occurrences with the random pseudo absences</span>
pred <span class="sy0">&lt;</span>- rbind<span class="br0">&#40;</span>vanessa_atalanta, random2000<span class="br0">&#41;</span>
<span class="co4">pred$</span><span class="re2">pa</span>=as.factor<span class="br0">&#40;</span>pred<span class="re1">$pa</span><span class="br0">&#41;</span>
&nbsp;
<span class="co0"># subset to 47 predictor variables</span>
<span class="co0"># to make the model calibration fasetr for optimizing operations</span>
pred47 = subset<span class="br0">&#40;</span>pred, <span class="kw1">select</span> = c<span class="br0">&#40;</span>pa, pr101,pr102,pr103,pr104,pr105,pr106,pr107,pr108,pr109,pr110,pr111,pr112,pr113,pr114,pr115,pr116,pr117,pr118,pr119,pr120,pr121,pr122,pr123,pr124,pr125,pr126,pr127,pr128,pr129,pr131,pr133,pr134,pr135,pr136,pr137,pr138,pr139,pr198,pr199,pr200,pr201,pr202,pr203,pr204,pr205,pr259,pr262<span class="br0">&#41;</span><span class="br0">&#41;</span>
&nbsp;
<span class="co0"># remove records with NA values</span>
pred = na.omit<span class="br0">&#40;</span>pred<span class="br0">&#41;</span>
pred = drop.levels<span class="br0">&#40;</span>pred<span class="br0">&#41;</span>
pred47 = na.omit<span class="br0">&#40;</span>pred47<span class="br0">&#41;</span>
pred47 = drop.levels<span class="br0">&#40;</span>pred47<span class="br0">&#41;</span>
&nbsp;
&nbsp;
<span class="co0">###########################</span>
<span class="co0">### MODEL BUILDING ########</span>
<span class="co0">###########################</span>
&nbsp;
<span class="co0">## run a randomForest model using 47 predictors</span>
RF47 = randomForest <span class="br0">&#40;</span>pred47<span class="re1">$pa</span> ~ pr101 + pr102 + pr103 + pr104 + pr105 + pr106 + pr107 + pr108 + pr109 + pr110 + pr111 + pr112 + pr113 + pr114 + pr115 + pr116 + pr117 + pr118 + pr119 + pr120 + pr121 + pr122 + pr123 + pr124 + pr125 + pr126 + pr127 + pr128 + pr129 + pr131 + pr133 + pr134 + pr135 + pr136 + pr137 + pr138 + pr139 + pr198 + pr199 + pr200 + pr201 + pr202 + pr203 + pr204 + pr205 + pr259 + pr262, data = pred47, <span class="re2">ntree</span>=<span class="nu0">1500</span> <span class="br0">&#41;</span> 
&nbsp;
save<span class="br0">&#40;</span>RF47,<span class="re2">file</span>=<span class="st0">&quot;RF47&quot;</span><span class="br0">&#41;</span>
<span class="co0"># load(&quot;RF47&quot;)</span>
<span class="co4">RF47$</span>confusion
&nbsp;
<span class="co0">## run a randomForest model using 11 predictors (the most important variables, GINI index)</span>
pred11 = subset<span class="br0">&#40;</span>pred47, <span class="kw1">select</span> = c<span class="br0">&#40;</span>pa,pr109,pr139,pr136,pr138,pr128,pr111,pr127,pr104,pr123,pr126,pr101<span class="br0">&#41;</span><span class="br0">&#41;</span>
RF11 = randomForest <span class="br0">&#40;</span>pred11<span class="re1">$pa</span> ~ pr109+pr139+pr136+pr138+pr128+pr111+pr127+pr104+pr123+pr126+pr101, data = pred11, <span class="re2">ntree</span>=<span class="nu0">1500</span> <span class="br0">&#41;</span> 
save<span class="br0">&#40;</span>RF11,<span class="re2">file</span>=<span class="st0">&quot;RF11&quot;</span><span class="br0">&#41;</span>
<span class="co0"># load(&quot;RF11&quot;)</span>
<span class="co4">RF11$</span>confusion</pre>

<p>
<br/>

</p>

</div>
<!-- EDIT16 SECTION "Calibrate Random Forest Model" [25781-32840] -->
<h3 class="sectionedit17" id="deploy_the_random_forest_model_for_scandinavia">Deploy the Random Forest Model for Scandinavia</h3>
<div class="level3">

<p>
<br/>

</p>
<pre class="code bash"><span class="co0">#!/bin/bash</span>
<span class="co0">#</span>
<span class="co0"># Copenhagen June 2010, ost4sem, unidk2010</span>
<span class="co0">#</span>
<span class="co0"># Title: Envelope models</span>
<span class="co0"># Authors: Alistair Auffret, Dag Endresen, Torben Wittwer, Zhenlin Yang</span>
<span class="co0"># Description: Species distribution from envelope modeling</span>
<span class="co0"># Table data from GRASS --&gt; R</span>
<span class="co0"># Calibrate SDM models in R</span>
<span class="co0"># Deploy SDM models to calculate prediction of species distribution in Sweden</span>
<span class="co0">#</span>
&nbsp;
&nbsp;
library<span class="br0">&#40;</span>rgdal<span class="br0">&#41;</span>
library<span class="br0">&#40;</span>maptools<span class="br0">&#41;</span>
library<span class="br0">&#40;</span>grid<span class="br0">&#41;</span>
library<span class="br0">&#40;</span>randomForest<span class="br0">&#41;</span> 
&nbsp;
&nbsp;
print<span class="br0">&#40;</span><span class="st0">&quot; ------------- NOW CREATE predictors grid stack  -------------&quot;</span><span class="br0">&#41;</span>
home_dir <span class="sy0">&lt;</span>- <span class="st0">&quot;/home/user/ost4sem/project/unidk2010/envmod&quot;</span>
<span class="co0"># set the output/R folder</span>
setwd<span class="br0">&#40;</span>paste<span class="br0">&#40;</span>home_dir,<span class="st0">&quot;/output/R&quot;</span>,<span class="re2">sep</span>=<span class="st0">&quot;&quot;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
<span class="co0">### Imoprt model RF</span>
load<span class="br0">&#40;</span><span class="st0">&quot;RF11&quot;</span><span class="br0">&#41;</span>
&nbsp;
<span class="kw2">gc</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="co0"># garbage collect to clean internal memory</span>
path.rasters = as.character<span class="br0">&#40;</span><span class="st0">&quot;/home/user/ost4sem/project/unidk2010/envmod/input&quot;</span><span class="br0">&#41;</span>
path.results = as.character<span class="br0">&#40;</span><span class="st0">&quot;/home/user/ost4sem/project/unidk2010/envmod/output/map/&quot;</span><span class="br0">&#41;</span>
&nbsp;
<span class="co0"># tile = c(20*0:114)</span>
<span class="co0"># for(t in 1:57){</span>
&nbsp;
tile = c<span class="br0">&#40;</span><span class="nu0">20</span><span class="sy0">*</span><span class="nu0">0</span>:<span class="nu0">3000</span><span class="br0">&#41;</span>
&nbsp;
<span class="kw1">for</span><span class="br0">&#40;</span>t <span class="kw1">in</span> <span class="nu0">75</span>:<span class="nu0">125</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
  datagrids = readGDAL<span class="br0">&#40;</span>paste<span class="br0">&#40;</span>path.rasters,<span class="st0">&quot;/pr101europe.tif&quot;</span>,<span class="re2">sep</span>=<span class="st0">&quot;&quot;</span><span class="br0">&#41;</span>, <span class="re2">offset</span>=c<span class="br0">&#40;</span><span class="nu0">0</span>,tile<span class="br0">&#91;</span>t<span class="br0">&#93;</span><span class="br0">&#41;</span>, region.dim=c<span class="br0">&#40;</span><span class="nu0">2100</span>,<span class="nu0">20</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
  datagrids<span class="re1">$pr101</span> = datagrids<span class="re1">$band1</span>
  datagrids<span class="re1">$pr123</span> = readGDAL<span class="br0">&#40;</span>paste<span class="br0">&#40;</span>path.rasters,<span class="st0">&quot;/pr123europe.tif&quot;</span>,<span class="re2">sep</span>=<span class="st0">&quot;&quot;</span><span class="br0">&#41;</span>, <span class="re2">offset</span>=c<span class="br0">&#40;</span><span class="nu0">0</span>,tile<span class="br0">&#91;</span>t<span class="br0">&#93;</span><span class="br0">&#41;</span>, region.dim=c<span class="br0">&#40;</span><span class="nu0">2100</span>,<span class="nu0">20</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="re1">$band1</span>
  <span class="kw2">gc</span><span class="br0">&#40;</span><span class="br0">&#41;</span>
  datagrids<span class="re1">$pr104</span> = readGDAL<span class="br0">&#40;</span>paste<span class="br0">&#40;</span>path.rasters,<span class="st0">&quot;/pr104europe.tif&quot;</span>,<span class="re2">sep</span>=<span class="st0">&quot;&quot;</span><span class="br0">&#41;</span>, <span class="re2">offset</span>=c<span class="br0">&#40;</span><span class="nu0">0</span>,tile<span class="br0">&#91;</span>t<span class="br0">&#93;</span><span class="br0">&#41;</span>, region.dim=c<span class="br0">&#40;</span><span class="nu0">2100</span>,<span class="nu0">20</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="re1">$band1</span>
  datagrids<span class="re1">$pr127</span> = readGDAL<span class="br0">&#40;</span>paste<span class="br0">&#40;</span>path.rasters,<span class="st0">&quot;/pr127europe.tif&quot;</span>,<span class="re2">sep</span>=<span class="st0">&quot;&quot;</span><span class="br0">&#41;</span>, <span class="re2">offset</span>=c<span class="br0">&#40;</span><span class="nu0">0</span>,tile<span class="br0">&#91;</span>t<span class="br0">&#93;</span><span class="br0">&#41;</span>, region.dim=c<span class="br0">&#40;</span><span class="nu0">2100</span>,<span class="nu0">20</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="re1">$band1</span>
  datagrids<span class="re1">$pr111</span> = readGDAL<span class="br0">&#40;</span>paste<span class="br0">&#40;</span>path.rasters,<span class="st0">&quot;/pr111europe.tif&quot;</span>,<span class="re2">sep</span>=<span class="st0">&quot;&quot;</span><span class="br0">&#41;</span>, <span class="re2">offset</span>=c<span class="br0">&#40;</span><span class="nu0">0</span>,tile<span class="br0">&#91;</span>t<span class="br0">&#93;</span><span class="br0">&#41;</span>, region.dim=c<span class="br0">&#40;</span><span class="nu0">2100</span>,<span class="nu0">20</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="re1">$band1</span>
  <span class="kw2">gc</span><span class="br0">&#40;</span><span class="br0">&#41;</span>
  datagrids<span class="re1">$pr109</span> = readGDAL<span class="br0">&#40;</span>paste<span class="br0">&#40;</span>path.rasters,<span class="st0">&quot;/pr109europe.tif&quot;</span>,<span class="re2">sep</span>=<span class="st0">&quot;&quot;</span><span class="br0">&#41;</span>, <span class="re2">offset</span>=c<span class="br0">&#40;</span><span class="nu0">0</span>,tile<span class="br0">&#91;</span>t<span class="br0">&#93;</span><span class="br0">&#41;</span>, region.dim=c<span class="br0">&#40;</span><span class="nu0">2100</span>,<span class="nu0">20</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="re1">$band1</span>
  datagrids<span class="re1">$pr139</span> = readGDAL<span class="br0">&#40;</span>paste<span class="br0">&#40;</span>path.rasters,<span class="st0">&quot;/pr139europe.tif&quot;</span>,<span class="re2">sep</span>=<span class="st0">&quot;&quot;</span><span class="br0">&#41;</span>, <span class="re2">offset</span>=c<span class="br0">&#40;</span><span class="nu0">0</span>,tile<span class="br0">&#91;</span>t<span class="br0">&#93;</span><span class="br0">&#41;</span>, region.dim=c<span class="br0">&#40;</span><span class="nu0">2100</span>,<span class="nu0">20</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="re1">$band1</span>
  datagrids<span class="re1">$pr136</span> = readGDAL<span class="br0">&#40;</span>paste<span class="br0">&#40;</span>path.rasters,<span class="st0">&quot;/pr136europe.tif&quot;</span>,<span class="re2">sep</span>=<span class="st0">&quot;&quot;</span><span class="br0">&#41;</span>, <span class="re2">offset</span>=c<span class="br0">&#40;</span><span class="nu0">0</span>,tile<span class="br0">&#91;</span>t<span class="br0">&#93;</span><span class="br0">&#41;</span>, region.dim=c<span class="br0">&#40;</span><span class="nu0">2100</span>,<span class="nu0">20</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="re1">$band1</span>
  <span class="kw2">gc</span><span class="br0">&#40;</span><span class="br0">&#41;</span>
  datagrids<span class="re1">$pr138</span> = readGDAL<span class="br0">&#40;</span>paste<span class="br0">&#40;</span>path.rasters,<span class="st0">&quot;/pr138europe.tif&quot;</span>,<span class="re2">sep</span>=<span class="st0">&quot;&quot;</span><span class="br0">&#41;</span>, <span class="re2">offset</span>=c<span class="br0">&#40;</span><span class="nu0">0</span>,tile<span class="br0">&#91;</span>t<span class="br0">&#93;</span><span class="br0">&#41;</span>, region.dim=c<span class="br0">&#40;</span><span class="nu0">2100</span>,<span class="nu0">20</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="re1">$band1</span>
  datagrids<span class="re1">$pr128</span> = readGDAL<span class="br0">&#40;</span>paste<span class="br0">&#40;</span>path.rasters,<span class="st0">&quot;/pr128europe.tif&quot;</span>,<span class="re2">sep</span>=<span class="st0">&quot;&quot;</span><span class="br0">&#41;</span>, <span class="re2">offset</span>=c<span class="br0">&#40;</span><span class="nu0">0</span>,tile<span class="br0">&#91;</span>t<span class="br0">&#93;</span><span class="br0">&#41;</span>, region.dim=c<span class="br0">&#40;</span><span class="nu0">2100</span>,<span class="nu0">20</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="re1">$band1</span>
  datagrids<span class="re1">$pr126</span> = readGDAL<span class="br0">&#40;</span>paste<span class="br0">&#40;</span>path.rasters,<span class="st0">&quot;/pr126europe.tif&quot;</span>,<span class="re2">sep</span>=<span class="st0">&quot;&quot;</span><span class="br0">&#41;</span>, <span class="re2">offset</span>=c<span class="br0">&#40;</span><span class="nu0">0</span>,tile<span class="br0">&#91;</span>t<span class="br0">&#93;</span><span class="br0">&#41;</span>, region.dim=c<span class="br0">&#40;</span><span class="nu0">2100</span>,<span class="nu0">20</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="re1">$band1</span>
  <span class="kw2">gc</span><span class="br0">&#40;</span><span class="br0">&#41;</span>
  <span class="co0"># datagrids$pr259 = readGDAL(paste(path.rasters,&quot;/pr259europe.tif&quot;,sep=&quot;&quot;), offset=c(0,tile[t]), region.dim=c(2100,20))$band1</span>
  <span class="co0"># datagrids$pr259 = factor(datagrids$pr259, ordered=FALSE)</span>
&nbsp;
  <span class="kw2">cat</span><span class="br0">&#40;</span><span class="st0">&quot; ---- 12 grids inported into datagrids file - now drawing the map------<span class="es1">\n</span>&quot;</span><span class="br0">&#41;</span>
&nbsp;
  <span class="co0">## predict function is used to calculate pixel values and index accordind to the random forest model and original rasters inported </span>
  pred.mapRF = predict <span class="br0">&#40;</span>RF11 , <span class="re2">newdata</span>=datagrids, <span class="re2">type</span>=<span class="st0">&quot;response&quot;</span><span class="br0">&#41;</span>
  <span class="kw2">cat</span><span class="br0">&#40;</span><span class="st0">&quot;---- class predicted ----<span class="es1">\n</span>&quot;</span><span class="br0">&#41;</span>
&nbsp;
  pred.mapRFindex = predict <span class="br0">&#40;</span>RF11 , <span class="re2">newdata</span>=datagrids, <span class="re2">type</span>=<span class="st0">&quot;vote&quot;</span><span class="br0">&#41;</span>
  <span class="kw2">cat</span><span class="br0">&#40;</span><span class="st0">&quot;---- class index recorded ----<span class="es1">\n</span>&quot;</span><span class="br0">&#41;</span>
&nbsp;
  <span class="kw2">cat</span><span class="br0">&#40;</span><span class="st0">&quot;---- map values for Forest Type calculated and added to predict map vector ----<span class="es1">\n</span>&quot;</span><span class="br0">&#41;</span>
  <span class="co0">## NOW create an empty tile with geographical coordinates to pixel values = 20</span>
  data2map = readGDAL<span class="br0">&#40;</span>paste<span class="br0">&#40;</span>path.rasters,<span class="st0">&quot;/pr104europe.tif&quot;</span>,<span class="re2">sep</span>=<span class="st0">&quot;&quot;</span><span class="br0">&#41;</span>, <span class="re2">offset</span>=c<span class="br0">&#40;</span><span class="nu0">0</span>,tile<span class="br0">&#91;</span>t<span class="br0">&#93;</span><span class="br0">&#41;</span>, region.dim=c<span class="br0">&#40;</span><span class="nu0">2100</span>,<span class="nu0">20</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
  <span class="kw2">cat</span><span class="br0">&#40;</span><span class="st0">&quot;---- geocoordinates inported ----<span class="es1">\n</span>&quot;</span><span class="br0">&#41;</span>
&nbsp;
  data2map<span class="re1">$band1</span> = <span class="nu0">20</span>
  <span class="kw2">cat</span><span class="br0">&#40;</span><span class="st0">&quot;---- no data value is now = 15 in this tile[t] ----<span class="es1">\n</span>&quot;</span><span class="br0">&#41;</span>
&nbsp;
  <span class="co0">## NOW adding predicted values to the empty tile[t] </span>
  data2map<span class="re1">$band1</span><span class="br0">&#91;</span>as.numeric<span class="br0">&#40;</span>dimnames<span class="br0">&#40;</span>pred.mapRFindex<span class="br0">&#41;</span><span class="br0">&#91;</span><span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="br0">&#93;</span> = as.numeric<span class="br0">&#40;</span>pred.mapRF<span class="br0">&#41;</span>
  <span class="kw2">cat</span><span class="br0">&#40;</span><span class="st0">&quot;---- class values added to tile[t] ----<span class="es1">\n</span>&quot;</span><span class="br0">&#41;</span>
&nbsp;
  <span class="co0">## NOW creating an asciii TILE file for modelled species </span>
  write.asciigrid<span class="br0">&#40;</span>data2map, paste<span class="br0">&#40;</span>path.results,t,<span class="st0">&quot;tile_vanessa_scan.asc&quot;</span>,<span class="re2">sep</span>=<span class="st0">&quot;&quot;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
&nbsp;
  <span class="kw2">cat</span><span class="br0">&#40;</span><span class="st0">&quot;-----------------------------------------Tile&quot;</span>, t,<span class="st0">&quot;created--------------------------<span class="es1">\n</span>&quot;</span><span class="br0">&#41;</span>
  <span class="co0">## cleaning up the memory </span>
  <span class="kw2">rm</span><span class="br0">&#40;</span>data2map<span class="br0">&#41;</span>
  <span class="kw2">rm</span><span class="br0">&#40;</span>datagrids<span class="br0">&#41;</span>
  <span class="kw2">rm</span><span class="br0">&#40;</span>pred.mapRF<span class="br0">&#41;</span>
  <span class="kw2">rm</span><span class="br0">&#40;</span>pred.mapRFindex<span class="br0">&#41;</span>
  <span class="kw2">gc</span><span class="br0">&#40;</span><span class="br0">&#41;</span>
<span class="br0">&#125;</span>
&nbsp;
system<span class="br0">&#40;</span><span class="st0">&quot;cd /home/user/ost4sem/project/unidk2010/envmod/output/map/&quot;</span><span class="br0">&#41;</span>
system<span class="br0">&#40;</span><span class="st0">&quot;gdalwarp  -srcnodata <span class="es1">\&quot;</span>-9999<span class="es1">\&quot;</span>  -dstnodata <span class="es1">\&quot;</span>-9999<span class="es1">\&quot;</span> -of GTiff -ot Int16 -wt Int16     *.asc   vanessa_scand.tif&quot;</span><span class="br0">&#41;</span> 
<span class="co0">#system(&quot;rm *tile_scand.asc&quot;)</span></pre>

<p>
<br/>

</p>

</div>
<!-- EDIT17 SECTION "Deploy the Random Forest Model for Scandinavia" [32841-37125] -->
<h3 class="sectionedit18" id="model_parametrization">Model parametrization</h3>
<div class="level3">

</div>
<!-- EDIT18 SECTION "Model parametrization" [37126-37157] -->
<h3 class="sectionedit19" id="model_prediction">Model prediction</h3>
<div class="level3">

</div>
<!-- EDIT19 SECTION "Model prediction" [37158-37184] -->
<h3 class="sectionedit20" id="validation">Validation</h3>
<div class="level3">

</div>
<!-- EDIT20 SECTION "Validation" [37185-37206] -->
<h2 class="sectionedit21" id="results_and_discussion">RESULTS and DISCUSSION</h2>
<div class="level2">

<p>
Insert a map and related table or graphics if available<br/>

Discuss the biological or geographical significance of results
<br/>

<a href="/dokuwiki/lib/exe/detail.php?id=wikidk%3Adk10envelop&amp;media=wikidk:gini_idx_47pred.jpeg" class="media" title="wikidk:gini_idx_47pred.jpeg"><img src="/dokuwiki/lib/exe/fetch.php?w=400&amp;tok=265dcb&amp;media=wikidk:gini_idx_47pred.jpeg" class="media" alt="" width="400" /></a>
The most important predictors, randomForest model for Vanessa atatlanta
<br/>

<a href="/dokuwiki/lib/exe/detail.php?id=wikidk%3Adk10envelop&amp;media=wikidk:vanessa_distrib.png" class="media" title="wikidk:vanessa_distrib.png"><img src="/dokuwiki/lib/exe/fetch.php?media=wikidk:vanessa_distrib.png" class="media" alt="" /></a>
Distribution of Vanessa atalanta with randomForest
<br/>

<a href="/dokuwiki/lib/exe/detail.php?id=wikidk%3Adk10envelop&amp;media=wikidk:vanessa_atalanta_maxent_wc25.png" class="media" title="wikidk:vanessa_atalanta_maxent_wc25.png"><img src="/dokuwiki/lib/exe/fetch.php?media=wikidk:vanessa_atalanta_maxent_wc25.png" class="media" alt="" /></a>
Distribution of Vanessa atalanta with MaxEnt
<br/>

<a href="/dokuwiki/lib/exe/detail.php?id=wikidk%3Adk10envelop&amp;media=wikidk:maxent_ost4sem_1_main_window_wc.png" class="media" title="wikidk:maxent_ost4sem_1_main_window_wc.png"><img src="/dokuwiki/lib/exe/fetch.php?w=600&amp;tok=6e3211&amp;media=wikidk:maxent_ost4sem_1_main_window_wc.png" class="media" alt="" width="600" /></a>
Screen-shot of the click and run MaxEnt Java application
</p>

</div>
<!-- EDIT21 SECTION "RESULTS and DISCUSSION" [37207-37767] -->
<h2 class="sectionedit22" id="section">\\</h2>
<div class="level2">
<hr />

<p>
<br/>

<a href="/dokuwiki/lib/exe/fetch.php?tok=ae4866&amp;media=http%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2Fthumb%2F9%2F98%2FHistory_of_West_Australia-THE_END.jpg%2F800px-History_of_West_Australia-THE_END.jpg" class="media" title="http://upload.wikimedia.org/wikipedia/commons/thumb/9/98/History_of_West_Australia-THE_END.jpg/800px-History_of_West_Australia-THE_END.jpg"><img src="/dokuwiki/lib/exe/fetch.php?tok=ae4866&amp;media=http%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2Fthumb%2F9%2F98%2FHistory_of_West_Australia-THE_END.jpg%2F800px-History_of_West_Australia-THE_END.jpg" class="mediacenter" title="upload.wikimedia.org_wikipedia_commons_thumb_9_98_history_of_west_australia-the_end.jpg_800px-history_of_west_australia-the_end.jpg" alt="upload.wikimedia.org_wikipedia_commons_thumb_9_98_history_of_west_australia-the_end.jpg_800px-history_of_west_australia-the_end.jpg" /></a>
</p>

</div>
<!-- EDIT22 SECTION "\\" [37768-37928] -->
<h2 class="sectionedit23" id="section1">\\</h2>
<div class="level2">
<hr />

<p>
<br/>

</p>

</div>
<!-- EDIT23 SECTION "\\" [37929-37946] -->
<h3 class="sectionedit24" id="the_end_or_not_quitea_last_alternative_model">THE END ...or not quite :: a last alternative model</h3>
<div class="level3">

<p>
The psychic octopus Paul has shown an impressive prediction rate for the football games these last weeks!
An alternative spatial ecology modeling approach would thus be to fill small cells in a physical grid with octopus food and submerge the frame into the aquarium. Paul would then eat octopus food from the small grid cells where the species habitat suitability is the highest…
<a href="/dokuwiki/lib/exe/detail.php?id=wikidk%3Adk10envelop&amp;media=wikidk:psychic_octopus_paul.jpg" class="media" title="wikidk:psychic_octopus_paul.jpg"><img src="/dokuwiki/lib/exe/fetch.php?media=wikidk:psychic_octopus_paul.jpg" class="media" alt="" /></a>
<br/>

</p>

</div>
<!-- EDIT24 SECTION "THE END ...or not quite :: a last alternative model" [37947-38431] -->
<h2 class="sectionedit25" id="work_in_progress_we_do_not_yet_have_the_first_prediction_grid_from_paul_but_expect_that_paul_will_no_less_than_revolutionize_the_spatial_ecology_modeling">Work in progress... We do not yet have the first prediction grid from Paul, but expect that Paul will no less than revolutionize the spatial ecology modeling...</h2>
<div class="level2">
<hr />

<p>
<br/>

<br/>

</p>

</div>
<!-- EDIT25 SECTION "Work in progress... We do not yet have the first prediction grid from Paul, but expect that Paul will no less than revolutionize the spatial ecology modeling..." [38432-] -->