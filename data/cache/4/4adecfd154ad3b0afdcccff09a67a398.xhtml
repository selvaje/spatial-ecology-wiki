
<h1 class="sectionedit1" id="detection_and_monitoring_of_flooded_areas">DETECTION AND MONITORING OF FLOODED AREAS</h1>
<div class="level1">

<p>
Use of high temporal resolution satellite data for flood analysis<br/>

<br/>

<em class="u">Mariapia Faruolo, Vito Imbrenda</em>
</p>

</div>
<!-- EDIT1 SECTION "DETECTION AND MONITORING OF FLOODED AREAS" [1-164] -->
<h2 class="sectionedit2" id="introduction">INTRODUCTION</h2>
<div class="level2">

</div>
<!-- EDIT2 SECTION "INTRODUCTION" [165-189] -->
<h3 class="sectionedit3" id="general_framework_of_research_activity">General framework of research activity</h3>
<div class="level3">

<p>
Development and implementation of advanced satellite
methodologies for flooded areas detection, monitoring
and mapping in near real-time<br/>

</p>

</div>
<!-- EDIT3 SECTION "General framework of research activity" [190-377] -->
<h3 class="sectionedit4" id="main_goal_of_research_activity">Main goal of research activity</h3>
<div class="level3">

<p>
To have a robust and automatic index able to detect and monitor in near real time flooded areas<br/>

</p>

</div>
<!-- EDIT4 SECTION "Main goal of research activity" [378-517] -->
<h3 class="sectionedit5" id="main_goals_of_this_project">Main goals of this project</h3>
<div class="level3">

<p>
Compare land use map with flooded areas maps to validate flood indexes
</p>

</div>
<!-- EDIT5 SECTION "Main goals of this project" [518-626] -->
<h2 class="sectionedit6" id="metadata">METADATA</h2>
<div class="level2">

<p>
<strong> RASTER DATA<strong><br/>

<br/>

<em class="u"><strong>MODIS Remote Sensed Data</strong></em><br/>

</strong>Driver<strong>: PCIDSK/PCIDSK Database File<br/>
<br/>
</strong>Files<strong>: Fondi.pix<br/>
<br/>
</strong>Size</strong> is 800, 850<br/>
<br/>
<strong>Coordinate System</strong> is:<br/>
GEOGCSBold Text[“Unknown datum based upon the Clarke 1866 ellipsoid”],
</p>
<ol>
<li class="level1"><div class="li"> DATUM[“Not specified (based on Clarke 1866 spheroid)”],<br/>
<pre class="code">- SPHEROID[&quot;Clarke 1866&quot;,6378206.4,294.9786982138982],                    
- AUTHORITY[&quot;EPSG&quot;,&quot;7008&quot;],                                        
- PRIMEM[&quot;Greenwich&quot;,0],                                                     
- UNIT[&quot;degree&quot;,0.0174532925199433]                                         </pre>

<p>
<strong>Origin</strong> = (11.500000000000004,53.125000000000014)<br/>
<br/>
<strong>Pixel Size</strong> = (0.002500000000000,-0.002500000000000)<br/>
<br/>
<br/>

</p>
</div>
</li>
</ol>

<p>
<em class="u"><strong>Corine Land Cover Map</strong></em><br/>

<strong>Driver</strong>: GTiff/GeoTIFF<br/>

<strong>Files</strong>: lceugr250<em>00.tif<br/>

<strong>Size</strong> is 26800, 23200<br/>

<strong>Coordinate System</strong> is:
PROJCS[“ETRS</em>1989<em>LAEA”, GEOGCS[“GCS</em>ETRS<em>1989”,
        - DATUM[“European</em>Terrestrial<em>Reference</em>System<em>1989”],
        - SPHEROID[“GRS</em>1980”,6378137.0,298.257222101],
</p>
<ol>
<li class="level1"><div class="li"> PRIMEM[“Greenwich”,0.0],</div>
</li>
<li class="level4"><div class="li"> UNIT[“Degree”,0.0174532925199433],</div>
</li>
<li class="level4"><div class="li"> PROJECTION[“Lambert<em>Azimuthal</em>Equal_Area”],</div>
</li>
<li class="level4"><div class="li"> UNIT[“Meter”,1.0]</div>
</li>
</ol>

<p>
<strong>Origin</strong> = (800000.000000000000000,6500000.000000000000000)<br/>

<strong>Pixel Size</strong> = (250.000000000000000,-250.000000000000000)<br/>

<br/>

<strong>VECTOR DATA</strong><br/>

</p>

<p>
Elbe river [<a href="http://rimmer.ngdc.noaa.gov/mgg/coast/getcoast.html]" class="urlextern" target="blanc" title="http://rimmer.ngdc.noaa.gov/mgg/coast/getcoast.html]" rel="nofollow noopener">http://rimmer.ngdc.noaa.gov/mgg/coast/getcoast.html]</a><br/>

<br/>

<strong>METHOD</strong>
</p>
<ol>
<li class="level1"><div class="li"> modify MODIS data format (original format: pix, final format: tif)<br/>
</div>
</li>
<li class="level1"><div class="li"> import MODIS data in GRASS<br/>
</div>
</li>
<li class="level1"><div class="li"> calculate flood indexes with GRASS [<em class="u">Bibliographic</em><em class="u"> Reference</em>: Lacava, T., Filizzola, C., Pergola, N., Sannazzaro, F. and Tramutoli, V., Improving flood  monitoring by the Robust AVHRR Technique (RAT) approach: the case of the April 2000 Hungary flood, /International Journal of Remote Sensing/, 31(8), 2043 - 2062]<br/>
</div>
</li>
<li class="level1"><div class="li"> change projection of Corine land use map<br/>
</div>
</li>
<li class="level1"><div class="li"> compare land use map with flooded areas maps to validate flood indexes</div>
</li>
</ol>

<p>
<br/>

</p>

<p>
<strong>DATA IMPORT</strong><br/>

</p>

<p>
<strong>Code Bash</strong><br/>

</p>
<pre class="code bash"><span class="co0"># manually entering in grass</span>
<span class="co0"># grass -text ~/ost4sem/grassdb/Germany/PERMANENT</span>
&nbsp;
<span class="co0"># change pix file in tif format to use Grass and Qgis.</span>
<span class="kw3">cd</span> ~<span class="sy0">/</span>ost4sem<span class="sy0">/</span>project<span class="sy0">/</span>input
gdal_translate <span class="re5">-b</span> <span class="nu0">7</span> Img_Germania.pix ch1_20ago.tif
gdal_translate <span class="re5">-b</span> <span class="nu0">8</span> Img_Germania.pix ch2_20ago.tif
gdal_translate <span class="re5">-b</span> <span class="nu0">3</span> Fondi.pix media_ch2-ch1.tif
gdal_translate <span class="re5">-b</span> <span class="nu0">4</span> Fondi.pix sigma_ch2-ch1.tif
gdal_translate <span class="re5">-b</span> <span class="nu0">5</span> Fondi.pix media_ch2<span class="sy0">/</span>ch1.tif
gdal_translate <span class="re5">-b</span> <span class="nu0">6</span> Fondi.pix sigma_ch2<span class="sy0">/</span>ch1.tif
&nbsp;
<span class="co0"># tif files conversion in Grass format</span>
r.in.gdal <span class="re2">input</span>=ch1_20ago.tif <span class="re2">output</span>=ch1_20agoGRASS <span class="re2">location</span>=Germany <span class="re5">--overwrite</span> 
r.in.gdal <span class="re2">input</span>=ch2_20ago.tif <span class="re2">output</span>=ch2_20agoGRASS <span class="re2">location</span>=Germany <span class="re5">--overwrite</span>
r.in.gdal <span class="re2">input</span>=media_ch2-ch1.tif <span class="re2">output</span>=media_ch2-ch1GRASS <span class="re2">location</span>=Germany <span class="re5">--overwrite</span>
r.in.gdal <span class="re2">input</span>=sigma_ch2-ch1.tif <span class="re2">output</span>=sigma_ch2-ch1GRASS <span class="re2">location</span>=Germany <span class="re5">--overwrite</span>
r.in.gdal <span class="re2">input</span>=media_ch2<span class="sy0">/</span>ch1.tif <span class="re2">output</span>=media_ch2<span class="sy0">/</span>ch1GRASS <span class="re2">location</span>=Germany <span class="re5">--overwrite</span>
r.in.gdal <span class="re2">input</span>=sigma_ch2<span class="sy0">/</span>ch1.tif <span class="re2">output</span>=sigma_ch2<span class="sy0">/</span>ch1GRASS <span class="re2">location</span>=Germany <span class="re5">--overwrite</span></pre>

<p>
<strong>DATA PROCESSING</strong><br/>

</p>

<p>
<strong>Code Bash</strong>
</p>
<pre class="code bash"><span class="co0"># flood indexes calculation</span>
r.mapcalculator <span class="re2">amap</span>=ch2_20agoGRASS<span class="sy0">@</span>PERMANENT <span class="re2">bmap</span>=ch1_20agoGRASS<span class="sy0">@</span>PERMANENT <span class="re2">formula</span>=A-B <span class="re2">outfile</span>=diff.tif <span class="re2">help</span>=- <span class="re5">--overwrite</span> 
r.mapcalculator <span class="re2">amap</span>=diff.tif<span class="sy0">@</span>PERMANENT <span class="re2">bmap</span>=media_ch2-ch1GRASS<span class="sy0">@</span>PERMANENT <span class="re2">cmap</span>=sigma_ch2-ch1GRASS<span class="sy0">@</span>PERMANENT <span class="re2">formula</span>=<span class="st0">&quot;(A-B)/C&quot;</span> <span class="re2">outfile</span>=alice_diff <span class="re2">help</span>=- <span class="re5">--overwrite</span> 
&nbsp;
r.mapcalculator <span class="re2">amap</span>=ch2_20agoGRASS<span class="sy0">@</span>PERMANENT <span class="re2">bmap</span>=ch1_20agoGRASS<span class="sy0">@</span>PERMANENT <span class="re2">formula</span>=A<span class="sy0">/</span>B <span class="re2">outfile</span>=rapp.tif <span class="re2">help</span>=- <span class="re5">--overwrite</span> 
r.mapcalculator <span class="re2">amap</span>=rapp.tif<span class="sy0">@</span>PERMANENT <span class="re2">bmap</span>=media_ch2<span class="sy0">/</span>ch1GRASS<span class="sy0">@</span>PERMANENT <span class="re2">cmap</span>=sigma_ch2<span class="sy0">/</span>ch1GRASS<span class="sy0">@</span>PERMANENT <span class="re2">formula</span>=<span class="st0">&quot;(A-B)/C&quot;</span> <span class="re2">outfile</span>=alice_rapp <span class="re2">help</span>=- <span class="re5">--overwrite</span> 
&nbsp;
<span class="co0"># threshold application to display flooded pixels </span>
r.mapcalc <span class="st0">&quot;inondati_diff = if((alice_diff&gt;-3 &amp;&amp; alice_diff&lt;-2),50,if(alice_diff&lt;-3,100,0))&quot;</span>
r.mapcalc <span class="st0">&quot;inondati_rapp = if((alice_rapp&gt;-3 &amp;&amp; alice_rapp&lt;-2),50,if(alice_rapp&lt;-3,100,0))&quot;</span>
r.colors <span class="re2">map</span>=inondati_diff <span class="re2">color</span>=ryb
r.colors <span class="re2">map</span>=inondati_rapp <span class="re2">color</span>=ryb
&nbsp;
<span class="co0"># creation of a map to show flooded pixels identified by both indexes</span>
r.mapcalc <span class="st0">&quot;inondati_tot = if((inondati_diff==50 &amp;&amp; inondati_rapp==50),1,if(inondati_diff==100 &amp;&amp; inondati_rapp==100,2,0))&quot;</span>
r.colors <span class="re2">map</span>=inondati_tot <span class="re2">color</span>=gyr
&nbsp;
<span class="co0"># creation of maps to show flooded pixels identified by both indexes for S/N level</span>
r.mapcalc <span class="st0">&quot;inondati_inters2 = if(( alice_rapp &gt; -3 &amp;&amp; alice_rapp &lt; -2  &amp;&amp; alice_diff &gt; -3 &amp;&amp; alice_diff &lt; -2),50,0)&quot;</span>
r.mapcalc <span class="st0">&quot;inondati_inters3 = if((alice_rapp &lt; -3 &amp;&amp; alice_diff &lt; -3),100,0)&quot;</span>
r.colors <span class="re2">map</span>=inondati_inters2 <span class="re2">color</span>=ryg
r.colors <span class="re2">map</span>=inondati_inters3 <span class="re2">color</span>=sepia
&nbsp;
<span class="co0"># Download and import Corine in Grass (the original file is lceugr250_00.tif): change projection, creation of a new location with r.in.gdal, move the file from the location temporary to my reference location with r.proj</span>
&nbsp;
<span class="kw1">if</span> <span class="br0">&#91;</span> <span class="re5">-f</span> <span class="sy0">/</span>home<span class="sy0">/</span>user<span class="sy0">/</span>ost4sem<span class="sy0">/</span>project<span class="sy0">/</span>input<span class="sy0">/</span>lceugr_250_00<span class="sy0">/</span>lceugr250_00.tif <span class="br0">&#93;</span> ; <span class="kw1">then</span> 
  <span class="kw3">echo</span> the <span class="sy0">/</span>home<span class="sy0">/</span>user<span class="sy0">/</span>ost4sem<span class="sy0">/</span>project<span class="sy0">/</span>input<span class="sy0">/</span>lceugr_250_00<span class="sy0">/</span>lceugr250_00.tif exist
<span class="kw1">else</span>
  <span class="kw3">cd</span> <span class="sy0">/</span>home<span class="sy0">/</span>user<span class="sy0">/</span>ost4sem<span class="sy0">/</span>project<span class="sy0">/</span>input<span class="sy0">/</span>lceugr_250_00<span class="sy0">/</span>
  <span class="kw2">wget</span> http:<span class="sy0">//</span>www.eea.europa.eu<span class="sy0">/</span>data-and-maps<span class="sy0">/</span>data<span class="sy0">/</span>corine-land-cover-clc2000-<span class="nu0">250</span>-m-version-<span class="nu0">12</span>-<span class="nu0">2009</span><span class="sy0">/</span>lceugr250_00.zip 
  <span class="kw3">cd</span> -
<span class="kw1">fi</span>
r.in.gdal <span class="re5">-o</span> <span class="re5">-e</span> <span class="re2">input</span>=<span class="sy0">/</span>home<span class="sy0">/</span>user<span class="sy0">/</span>ost4sem<span class="sy0">/</span>project<span class="sy0">/</span>input<span class="sy0">/</span>lceugr_250_00<span class="sy0">/</span>lceugr250_00.tif <span class="re2">output</span>=corine  <span class="re2">location</span>=tmp
r.proj <span class="re2">input</span>=corine  <span class="re2">location</span>=tmp <span class="re2">mapset</span>=PERMANENT <span class="re2">output</span>=corine <span class="re5">--overwrite</span>
&nbsp;
<span class="co0"># association of flooded pixels by both indices (alice_diff and alice_rapp) to the Corine Land Cover class </span>
r.mapcalc <span class="st0">&quot;associa_diff = if(inondati_diff==50 || inondati_diff==100,corine,null())&quot;</span>
r.colors <span class="re2">map</span>=associa_diff <span class="re2">color</span>=byg
r.mapcalc <span class="st0">&quot;associa_rapp = if(inondati_rapp==50 || inondati_rapp==100,corine,null())&quot;</span>
r.colors <span class="re2">map</span>=associa_rapp <span class="re2">color</span>=byg
&nbsp;
<span class="co0"># text file creation to show for flooded pixels lat/lon coordinates</span>
r.stats <span class="re5">-acpnl</span> <span class="re2">input</span>=associa_diff<span class="sy0">@</span>PERMANENT <span class="re2">output</span>=conta_diff_tot
r.stats <span class="re5">-acpnl</span> <span class="re2">input</span>=associa_rapp<span class="sy0">@</span>PERMANENT <span class="re2">output</span>=conta_rapp_tot
r.stats <span class="re5">-gln</span> <span class="re2">input</span>=associa_diff<span class="sy0">@</span>PERMANENT <span class="re2">output</span>=conta_diff_pixel
r.stats <span class="re5">-gln</span> <span class="re2">input</span>=associa_rapp<span class="sy0">@</span>PERMANENT <span class="re2">output</span>=conta_rapp_pixel
&nbsp;
<span class="co0"># text file creation to attribute land cover classes to flooded pixels</span>
<span class="kw2">sort</span> <span class="re5">-k</span> <span class="nu0">3</span>,<span class="nu0">3</span> conta_diff_pixel <span class="sy0">&gt;</span> conta_diff_pixel.txt
<span class="kw2">sort</span> <span class="re5">-k</span> <span class="nu0">3</span>,<span class="nu0">3</span> conta_rapp_pixel <span class="sy0">&gt;</span> conta_rapp_pixel.txt
<span class="kw2">awk</span> <span class="re5">-F</span> <span class="st0">&quot;,&quot;</span> <span class="st_h">'{if (NR&gt;1) print $1 , $2 , $5  }'</span>   corine_legend.csv  <span class="sy0">&gt;</span> corine_lev3.txt
<span class="kw2">sort</span> <span class="re5">-k</span> <span class="nu0">1</span>,<span class="nu0">1</span> corine_lev3.txt <span class="sy0">&gt;</span> corine_lev3_sort.txt
<span class="kw2">join</span> <span class="re5">-1</span> <span class="nu0">3</span> <span class="re5">-2</span> <span class="nu0">1</span> conta_diff_pixel.txt  corine_lev3_sort.txt  <span class="sy0">&gt;</span> confronto_diff.txt
<span class="kw2">join</span> <span class="re5">-1</span> <span class="nu0">3</span> <span class="re5">-2</span> <span class="nu0">1</span> conta_rapp_pixel.txt  corine_lev3_sort.txt  <span class="sy0">&gt;</span> confronto_rapp.txt
&nbsp;
<span class="co0"># text file creation to attribute flood indexes values to flooded pixels </span>
r.stats <span class="re5">-1nlg</span> <span class="re2">input</span>=alice_diff<span class="sy0">@</span>PERMANENT <span class="re2">output</span>=alice_diff.txt
<span class="kw2">awk</span>  <span class="st_h">'{if ($3&lt;-2) print $1 &quot;cor&quot; $2 , $3 }'</span>   alice_diff.txt  <span class="sy0">|</span> <span class="kw2">sort</span> <span class="re5">-k</span> <span class="nu0">1</span>,<span class="nu0">1</span>  <span class="sy0">&gt;</span> alice_diff2.txt
<span class="kw2">awk</span>  <span class="st_h">'{  print $1 , $2&quot;cor&quot; $3 , $4, $5 , $6 ,$7,$8,$9,$10,$11  }'</span>   confronto_diff.txt <span class="sy0">|</span> <span class="kw2">sort</span> <span class="re5">-k</span> <span class="nu0">2</span>,<span class="nu0">2</span>   <span class="sy0">&gt;</span> confronto_diff2.txt
<span class="kw2">join</span> <span class="re5">-1</span> <span class="nu0">1</span> <span class="re5">-2</span> <span class="nu0">2</span> alice_diff2.txt confronto_diff2.txt  <span class="sy0">|</span> <span class="kw2">awk</span>  <span class="st_h">'BEGIN { print &quot;Long Lat Alice_Diff Id_Cor CLC_Code Class &quot; } { gsub(&quot;cor&quot;,&quot; &quot;) ; if( $41!=40 || $4!=41) print }'</span> <span class="sy0">&gt;</span> finale_diff.txt
&nbsp;
r.stats <span class="re5">-1nlg</span> <span class="re2">input</span>=alice_rapp<span class="sy0">@</span>PERMANENT <span class="re2">output</span>=alice_rapp.txt
<span class="kw2">awk</span>  <span class="st_h">'{if ($3&lt;-2) print $1 &quot;cor&quot; $2 , $3 }'</span>   alice_rapp.txt  <span class="sy0">|</span> <span class="kw2">sort</span> <span class="re5">-k</span> <span class="nu0">1</span>,<span class="nu0">1</span>  <span class="sy0">&gt;</span> alice_rapp2.txt
<span class="kw2">awk</span>  <span class="st_h">'{  print $1 , $2&quot;cor&quot; $3 , $4, $5 , $6 ,$7,$8,$9,$10,$11  }'</span>   confronto_rapp.txt <span class="sy0">|</span> <span class="kw2">sort</span> <span class="re5">-k</span> <span class="nu0">2</span>,<span class="nu0">2</span>   <span class="sy0">&gt;</span> confronto_rapp2.txt
<span class="kw2">join</span> <span class="re5">-1</span> <span class="nu0">1</span> <span class="re5">-2</span> <span class="nu0">2</span> alice_rapp2.txt confronto_rapp2.txt  <span class="sy0">|</span> <span class="kw2">awk</span>  <span class="st_h">'BEGIN { print &quot;Long Lat Alice_Diff Id_Cor CLC_Code Class &quot; } { gsub(&quot;cor&quot;,&quot; &quot;) ; if( $4!=40 &amp;&amp; $4!=41 ) print }'</span> <span class="sy0">&gt;</span> finale_rapp.txt
&nbsp;
<span class="co0"># export elbe rivers text file as vector</span>
dos2unix fiumiGermania.txt
<span class="kw2">grep</span> <span class="re5">-v</span> Line fiumiGermania.txt  <span class="sy0">|</span>   <span class="kw2">awk</span> <span class="st_h">' {  print $1&quot;|&quot;$2}'</span>  <span class="sy0">&gt;</span> fiumiGermania4grass.txt
v.edit <span class="re2">tool</span>=create <span class="re2">map</span>=elba <span class="re2">input</span>=fiumiGermania4grass.txt</pre>

<p>
<strong>RESULTS</strong><br/>

- 3 flooded areas maps:
</p>
<ol>
<li class="level1"><div class="li"> for the difference based index (for 2 different levels of S/N)<br/>
</div>
</li>
<li class="level1"><div class="li"> for the ratio based index (for 2 different levels of S/N)<br/>
</div>
</li>
<li class="level1"><div class="li"> for the intersection between two flood indexes<br/>
</div>
</li>
</ol>

<p>
- 1 map on relation between flooded pixels and corine type<br/>

- 1 text file for flooded pixels characterization (lat/lon, corine type description, alice indexes value)<br/>

</p>

<p>
<a href="/dokuwiki/lib/exe/detail.php?id=wikibas10%3Abas10mtaland&amp;media=wiki:alice_diffa.png" class="media" title="wiki:alice_diffa.png"><img src="/dokuwiki/lib/exe/fetch.php?media=wiki:alice_diffa.png" class="media" alt="" /></a>
</p>

<p>
<a href="/dokuwiki/lib/exe/detail.php?id=wikibas10%3Abas10mtaland&amp;media=wiki:alice_rappa.png" class="media" title="wiki:alice_rappa.png"><img src="/dokuwiki/lib/exe/fetch.php?media=wiki:alice_rappa.png" class="media" alt="" /></a>
</p>

</div>
<!-- EDIT6 SECTION "METADATA" [627-] -->