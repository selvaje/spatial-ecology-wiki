
<h1 class="sectionedit1" id="preparation">Preparation</h1>
<div class="level1">

<p>
<strong>Data</strong>
</p>

<p>
Use the following link in Firefox <a href="https://wetransfer.com/downloads/a7e90b26a8b840801788f7541f7c771920180607185110/ebc04cabb9e22b790f0fd180515086a220180607185110/71ea65" class="urlextern" target="blanc" title="https://wetransfer.com/downloads/a7e90b26a8b840801788f7541f7c771920180607185110/ebc04cabb9e22b790f0fd180515086a220180607185110/71ea65" rel="nofollow noopener">External data</a>
</p>

<p>
Open a terminal to prepare the data folder.
</p>
<pre class="code"> ls /home/user/Downloads/ss_se2018_d5.zip
 
 cd /home/user/
 mv /home/user/Downloads/ss_se2018_d5.zip .
 unzip ss_se2018_d5.zip
 
 ls /home/user/ss_se2018_d5/
 
 cd /home/user/ss_se2018_d5/
 pwd</pre>

<p>
<strong>Jupyther Notebook</strong>
</p>

<p>
In a new terminal, execute
</p>
<pre class="code"> jupyter-notebook </pre>

<p>
Firefox should open automatically.
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Preparation&quot;,&quot;hid&quot;:&quot;preparation&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:1,&quot;range&quot;:&quot;0-581&quot;} -->
<h1 class="sectionedit2" id="geopandas">Geopandas</h1>
<div class="level1">

<p>
Introduction to Geopandas library.
</p>

<p>
In the Jupyther Notebook (Firefox) open:
</p>
<pre class="code"> ss_se2018_d5/ex1_intro.ipynb</pre>

<p>
<em>Ex1.A1</em>
</p>

<p>
Alternative to Geopandas for quick reprojecting of a SHP. 
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Geopandas&quot;,&quot;hid&quot;:&quot;geopandas&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:2,&quot;range&quot;:&quot;582-791&quot;} -->
<h1 class="sectionedit3" id="urban_centres_application">Urban centres application</h1>
<div class="level1">

<p>
Land efficiency for selected urban centres of the Northen Italy. 
</p>

<p>
Most of datasets are already prepared. 
</p>

<p>
Downloaded from <a href="http://ghsl.jrc.ec.europa.eu/datasets.php" class="urlextern" target="blanc" title="http://ghsl.jrc.ec.europa.eu/datasets.php" rel="nofollow noopener">GHSL page</a>:
</p>
<ul>
<li class="level1"><div class="li"> Built-up area grids 1990 and 2014 (1-km) from GHS BUILT-UP GRID (LDS)</div>
</li>
<li class="level1"><div class="li"> Population grids 1990 and 2014 (1-km) from GHS POPULATION GRID (LDS)</div>
</li>
<li class="level1"><div class="li"> A grid with unique IDs for urban centres from GHS SETTLEMENT GRID (LDS)</div>
</li>
</ul>

<p>
and, clipped to the area of the Northen Italy. The BBOX from the previous exercise. 
</p>
<pre class="code"> gdal_translate -projwin_srs &quot;EPSG:3035&quot; -projwin 4045461.3772923313 2675342.7008133745 4636823.940878151 2286230.217545237 src/GHS_BUILT_LDS1990_GLOBE_R2016A_54009_1k_v1_0.tif input/B1990.tif</pre>
<pre class="code"> gdal_translate -projwin_srs &quot;EPSG:3035&quot; -projwin 4045461.3772923313 2675342.7008133745 4636823.940878151 2286230.217545237 src/GHS_BUILT_LDS2014_GLOBE_R2016A_54009_1k_v1_0.tif input/B2014.tif</pre>
<pre class="code"> gdal_translate -projwin_srs &quot;EPSG:3035&quot; -projwin 4045461.3772923313 2675342.7008133745 4636823.940878151 2286230.217545237 src/GHS_POP_GPW42015_GLOBE_R2015A_54009_1k_v1_0.tif input/P2015.tif</pre>
<pre class="code"> gdal_translate -projwin_srs &quot;EPSG:3035&quot; -projwin 4045461.3772923313 2675342.7008133745 4636823.940878151 2286230.217545237 src/GHS_POP_GPW41990_GLOBE_R2015A_54009_1k_v1_0.tif input/P1990.tif</pre>
<pre class="code"> gdal_translate -projwin_srs &quot;EPSG:3035&quot; -projwin 4045461.3772923313 2675342.7008133745 4636823.940878151 2286230.217545237 src/GHS_SMOD_POP2015HDC_GLOBE_R2016A_54009_1k_v1_0.tif input/HDC2015.tif</pre>

<p>
In the Jupyther Notebook (Firefox) open:
</p>
<pre class="code"> ss_se2018_d5/ex2_lue.ipynb</pre>

<p>
<em>Ex2.A1</em>
</p>

<p>
Generate a polygon per each urban centre of the Northen Italy.
</p>

<p>
<em>Ex2.A2</em>
</p>

<p>
We want only values for the area of the selected urban centre. We should exclude the values that are outside the HDC polygon. 
</p>

<p>
<em>Ex2.A3</em>
</p>

<p>
Generate a SHP with the LUE stats for this urban centre. 
</p>

<p>
<em>Ex2.A4</em>
</p>

<p>
Generate a file with LUE stats for all urban centres of the Northen Italy. 
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Urban centres application&quot;,&quot;hid&quot;:&quot;urban_centres_application&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:3,&quot;range&quot;:&quot;792-2762&quot;} -->
<h1 class="sectionedit4" id="opencv">openCV</h1>
<div class="level1">

<p>
<a href="https://docs.opencv.org/3.0-beta/doc/py_tutorials/py_imgproc/py_morphological_ops/py_morphological_ops.html" class="urlextern" target="blanc" title="https://docs.opencv.org/3.0-beta/doc/py_tutorials/py_imgproc/py_morphological_ops/py_morphological_ops.html" rel="nofollow noopener">Quick tutorial</a>
</p>

<p>
First, we need to add it. From terminal:
</p>
<pre class="code"> sudo apt-get install python-opencv</pre>

<p>
Flood areas from <a href="https://data.jrc.ec.europa.eu/collection/id-0054" class="urlextern" target="blanc" title="https://data.jrc.ec.europa.eu/collection/id-0054" rel="nofollow noopener">GloFAS</a>
</p>

<p>
The flood hazard map Flood Dataset is prepared already as follows: 
</p>
<div class="plugin_note noteclassic">It is only for demonstration purposes!
</div><pre class="code"> gdal_translate -projwin 4045461.3772923313 2675342.7008133745 4636823.940878151 2286230.217545237 floodMapEU_rp10y.tif floodMapEU_rp10y_nIT.tif</pre>
<pre class="code"> gdal_calc.py --calc=&quot;(A&gt;0)*1+(A&lt;=0)*0&quot; -A floodMapEU_rp10y_nIT.tif --type=Byte --co=&quot;COMPRESS=LZW&quot; --NoDataValue=0 --outfile=input/floodMapEU_rp10y_nIT_msk.tif
 
 </pre>

<p>
<em>Ex3.A1</em>
</p>

<p>
Mollweide, 1-km ? EPSG:54009
</p>
<pre class="code"> gdalwarp -t_srs &#039;+proj=moll +lon_0=0 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m&#039; -s_srs EPSG:3035 -tr 1000 1000  input/floodMapEU_rp10y_nIT_msk.tif output/flood_msk.tif
 
 </pre>

<p>
In the Jupyther Notebook (Firefox) open:
</p>
<pre class="code"> ss_se2018_d5/ex3_cv2.ipynb</pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;openCV&quot;,&quot;hid&quot;:&quot;opencv&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:4,&quot;range&quot;:&quot;2763-3831&quot;} -->
<h1 class="sectionedit5" id="help">Help</h1>
<div class="level1">

<p>
<strong>Ex1.A1</strong>
</p>

<p>
<em class="u">Hint:</em> use terminal
</p>
<pre class="code"> ogr2ogr -clipsrc 6.503202 43.663531 14.046604 47.170673 -t_srs EPSG:3035 -s_srs EPSG:4326 output/WDPA_June2018_ITA-shapefile-polygons_nIT_LAEAL.shp input/WDPA_June2018_ITA-shapefile-polygons.shp</pre>

<p>
<strong>Ex2.A1</strong>
</p>

<p>
<em class="u">Hint:</em> use terminal
</p>
<pre class="code"> gdal_polygonize.py -f &quot;ESRI Shapefile&quot; input/HDC2015.tif output/HDC2015.shp</pre>

<p>
Visualise in QGIS. Is it correct??
</p>
<pre class="code"> gdal_calc.py --calc=&quot;(A&gt;0)*1+(A&lt;=0)*0&quot; -A input/HDC2015.tif --type=Byte --co=&quot;COMPRESS=LZW&quot; --outfile=output/HDC2015_msk.tif
 
 gdal_polygonize.py -mask output/HDC2015_msk.tif -f &quot;ESRI Shapefile&quot; input/HDC2015.tif output/HDC2015.shp</pre>

<p>
<strong>Ex2.A2</strong>
</p>

<p>
<em class="u">Hint:</em> we need to apply a mask. We could create one using polygon … but <img src="/dokuwiki/lib/images/smileys/icon_cool.gif" class="icon" alt="8-)" /><br/>

</p>

<p>
<strong>Ex2.A3</strong>
</p>

<p>
<em class="u">Hint:</em> First create a GeoDataFramework. Then, look into documentation…
</p>
<pre class="code"> hdc_lue = gpd.GeoDataFrame(pd.DataFrame( data={&#039;LUE_GHS_MEAN&#039;: [np.mean(lue)],&#039;LCPGR&#039;: [lcrpgr], } ), crs={&#039;init&#039;: &#039;epsg:54009&#039;}, geometry=[hdc.geometry.values[0]])
 hdc_lue.to_file(os.path.join(odir,&#039;hdc_lue.shp&#039;))
                        
                        </pre>

<p>
<strong>Ex2.A4</strong>
</p>

<p>
Generate a file with LUE stats for all urban centres of the Northen Italy.
</p>

<p>
<em class="u">Hint:</em> Loop
</p>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Help&quot;,&quot;hid&quot;:&quot;help&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:5,&quot;range&quot;:&quot;3832-5041&quot;} -->
<h1 class="sectionedit6" id="comments">Comments</h1>
<div class="level1">

<p>
The recent version:
</p>
<ul>
<li class="level1"><div class="li"> better integration with <em>shapely</em>,</div>
</li>
<li class="level1"><div class="li"> better integration with <em>matplotlib</em></div>
</li>
</ul>

<p>
Examples:
</p>
<pre class="code"> aoi_geom = shapely.ops.unary_union(north_it.geometry).buffer(10000)
 
 aoi_geom = north_it.unary_union.buffer(10000) 
 
 # you do not need 
 %matplotlib inline
 
 # colors, labels, etc
 ax = portsIT.buffer(25000).plot(axes=ax)
 
 ax = portsIT.buffer(10000).plot(ax=ax, color=&#039;green&#039;)
 </pre>

</div>
<!-- EDIT{&quot;target&quot;:&quot;section&quot;,&quot;name&quot;:&quot;Comments&quot;,&quot;hid&quot;:&quot;comments&quot;,&quot;codeblockOffset&quot;:0,&quot;secid&quot;:6,&quot;range&quot;:&quot;5042-&quot;} -->